<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LaundryGo ‚Äì Online Laundry Pickup & Delivery</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Base styles + background + font size -->
  <style>
    html {
      font-size: 17px;
    }
    @media (min-width: 1024px) {
      html {
        font-size: 18px;
      }
    }

    :root {
      --bg-gradient: radial-gradient(circle at 0% 0%, #e0f2fe 0, transparent 50%),
                     radial-gradient(circle at 100% 0%, #bfdbfe 0, transparent 55%),
                     radial-gradient(circle at 0% 100%, #bae6fd 0, transparent 55%),
                     radial-gradient(circle at 100% 100%, #7dd3fc 0, transparent 55%);
    }

    body {
      font-family: "Prompt", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: linear-gradient(to bottom, #0f172a 0%, #0b1120 40%, #020617 100%);
      color: #0f172a;
    }

    .app-shell {
      min-height: 100vh;
      background-image: var(--bg-gradient);
      background-size: cover;
      background-attachment: fixed;
      backdrop-filter: blur(12px);
    }

    .bg-pattern {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.18;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.5) 0, transparent 50%),
        radial-gradient(circle at 90% 10%, rgba(59, 130, 246, 0.4) 0, transparent 50%),
        radial-gradient(circle at 0% 100%, rgba(96, 165, 250, 0.5) 0, transparent 55%);
      mix-blend-mode: screen;
      z-index: -1;
    }

    .glass-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.96), rgba(248,250,252,0.96));
      backdrop-filter: blur(16px);
    }

    .float-slow {
      animation: float-slow 8s ease-in-out infinite;
    }
    .float-slower {
      animation: float-slow 14s ease-in-out infinite;
    }
    @keyframes float-slow {
      0%, 100% { transform: translateY(0px); }
      50%      { transform: translateY(-10px); }
    }

    .fade-in {
      opacity: 0;
      animation: fade-in 0.8s ease-out forwards;
    }
    .fade-in-delay {
      opacity: 0;
      animation: fade-in 0.9s ease-out 0.2s forwards;
    }
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }

    .detergent-pill-active {
      background-color: #0ea5e9;
      border-color: #0284c7;
      color: #f9fafb;
      box-shadow: 0 8px 18px rgba(14, 165, 233, 0.4);
    }

    /* ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô pill */
    .promo-pill {
      position: relative;
      overflow: hidden;
    }
    .promo-pill::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.6), transparent 55%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .promo-pill:hover::before {
      opacity: 1;
    }

    /* Floating chat button */
    .floating-chat {
      animation: float-slow 6s ease-in-out infinite;
    }

    /* Timeline line (How it works) */
    /* Form baseline */
    input, select, textarea {
      -webkit-tap-highlight-color: transparent;
    }

    /* Subtle border default for inputs (keeps Tailwind classes working) */
    input[type="text"], input[type="password"], input[type="tel"], input[type="datetime-local"], input[type="number"], textarea, select {
      border-color: rgba(148, 163, 184, 0.45);
    }

    .timeline-dot {
      box-shadow: 0 0 0 4px rgba(56, 189, 248, 0.25);
    }


    /* Utilities (custom) */
    .rounded-4xl { border-radius: 2rem; } /* Tailwind CDN ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™‡∏ô‡∏µ‡πâ: ‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ */

    /* Better focus for keyboard users */
    :focus-visible {
      outline: 2px solid rgba(14, 165, 233, 0.55);
      outline-offset: 2px;
    }

    /* Reduce motion accessibility */
    @media (prefers-reduced-motion: reduce) {
      .float-slow, .float-slower, .floating-chat, .fade-in, .fade-in-delay {
        animation: none !important;
        opacity: 1 !important;
        transform: none !important;
      }
    }

    /* Mobile performance: avoid fixed background */
    @media (max-width: 768px) {
      .app-shell { background-attachment: scroll; }
    }

  
    /* ---------------------------
       Login skins (A/B/C)
       --------------------------- */
    #view-login.login-skins {
      transition: background 250ms ease, filter 250ms ease;
      border-radius: 2rem;
    }
    #view-login .skinBtn.active {
      background: linear-gradient(135deg, rgba(14,165,233,1), rgba(34,211,238,1));
      color: #fff;
      box-shadow: 0 10px 24px rgba(14,165,233,0.25);
    }

    /* A: Glass Split (default) */
    #view-login.skin-a .login-card {
      border-color: rgba(14,165,233,0.20);
      box-shadow: 0 26px 64px rgba(2,132,199,0.18), 0 10px 26px rgba(15,23,42,0.10);
      position: relative;
      overflow: hidden;
    }
    #view-login.skin-a .login-card::after {
      content: "";
      position: absolute;
      inset: -40px -60px auto auto;
      width: 220px;
      height: 220px;
      background: radial-gradient(circle at 30% 30%, rgba(34,211,238,0.55), transparent 60%);
      filter: blur(8px);
      opacity: 0.9;
      pointer-events: none;
    }
    #view-login.skin-a .login-hero {
      border-color: rgba(125,211,252,0.42);
      box-shadow: 0 20px 56px rgba(2,132,199,0.12), 0 10px 26px rgba(15,23,42,0.08);
    }

    /* B: Minimal (centered card) */
    #view-login.skin-b {
      background: linear-gradient(180deg, rgba(255,255,255,0.75), rgba(248,250,252,0.55));
      padding: 1.25rem 0 2.25rem;
    }
    #view-login.skin-b .login-grid {
      grid-template-columns: 1fr !important;
      max-width: 480px;
      margin: 0 auto;
      gap: 1rem !important;
    }
    #view-login.skin-b .login-hero {
      display: none;
    }
    #view-login.skin-b .login-card {
      background: rgba(255,255,255,0.92);
      border-color: rgba(226,232,240,0.95);
      box-shadow: 0 22px 54px rgba(15,23,42,0.12);
    }
    #view-login.skin-b .login-faq {
      max-width: 480px !important;
      margin-left: auto !important;
      margin-right: auto !important;
      background: rgba(255,255,255,0.88);
      border-color: rgba(226,232,240,0.95);
    }

    /* C: Dark Glow (login-only dark) */
    #view-login.skin-c {
      background:
        radial-gradient(circle at 10% 20%, rgba(56,189,248,0.22), transparent 55%),
        radial-gradient(circle at 90% 10%, rgba(99,102,241,0.20), transparent 55%),
        linear-gradient(180deg, rgba(2,6,23,0.65), rgba(2,6,23,0.45));
      padding: 1.25rem 0 2.25rem;
      border: 1px solid rgba(148,163,184,0.18);
    }
    #view-login.skin-c .login-card,
    #view-login.skin-c .login-hero,
    #view-login.skin-c .login-faq {
      background: rgba(2,6,23,0.62) !important;
      border-color: rgba(56,189,248,0.20) !important;
      box-shadow: 0 28px 78px rgba(0,0,0,0.35);
    }

    /* Override text colors inside login when dark */
    #view-login.skin-c h1,
    #view-login.skin-c h2,
    #view-login.skin-c h3,
    #view-login.skin-c .text-slate-900 { color: #f8fafc !important; }
    #view-login.skin-c p,
    #view-login.skin-c label,
    #view-login.skin-c summary,
    #view-login.skin-c .text-slate-600,
    #view-login.skin-c .text-slate-500,
    #view-login.skin-c .text-slate-400 { color: rgba(226,232,240,0.92) !important; }

    #view-login.skin-c input,
    #view-login.skin-c textarea,
    #view-login.skin-c select {
      background: rgba(15,23,42,0.72) !important;
      color: #f8fafc !important;
      border-color: rgba(148,163,184,0.30) !important;
    }
    #view-login.skin-c input::placeholder,
    #view-login.skin-c textarea::placeholder {
      color: rgba(148,163,184,0.85) !important;
    }
    #view-login.skin-c .bg-sky-50,
    #view-login.skin-c .bg-sky-50\/80,
    #view-login.skin-c .bg-slate-50\/60,
    #view-login.skin-c .bg-white\/80 {
      background: rgba(15,23,42,0.55) !important;
      border-color: rgba(148,163,184,0.20) !important;
    }
    #view-login.skin-c .detergent-pill-active {
      box-shadow: 0 10px 28px rgba(34,211,238,0.22);
    }

  
    /* ===========================
       Login Promo Slider (above form)
       - Replace background images by setting data-bg="/path/to.jpg" on .lg-slide
       =========================== */
    .lg-slider { position: relative; }
    .lg-slider .lg-track { display: flex; transition: transform 520ms cubic-bezier(.2,.8,.2,1); will-change: transform; }
    .lg-slider .lg-slide { flex: 0 0 100%; position: relative; min-height: 210px; }
    @media (min-width: 768px){ .lg-slider .lg-slide{ min-height: 280px; } }
    .lg-slider .lg-bg {
      position:absolute; inset:0;
      background: var(--slide-fallback, radial-gradient(circle at 18% 22%, rgba(56,189,248,.45), transparent 55%),
        radial-gradient(circle at 78% 18%, rgba(34,211,238,.32), transparent 55%),
        radial-gradient(circle at 30% 85%, rgba(59,130,246,.28), transparent 55%),
        linear-gradient(120deg, rgba(15,23,42,.92), rgba(2,132,199,.18)));
      background-size: cover;
      background-position: center;
      transform: scale(1.02);
    }
    .lg-slider[data-has-image="1"] .lg-bg{ filter: saturate(1.05) contrast(1.02); }
    .lg-slider .lg-sheen{
      position:absolute; inset:-1px;
      background: linear-gradient(120deg, rgba(255,255,255,.18), rgba(255,255,255,0) 30%, rgba(255,255,255,.08) 60%, rgba(255,255,255,0));
      mix-blend-mode: overlay;
      pointer-events:none;
    }
    .lg-slider .lg-overlay{
      position:absolute; inset:0;
      background: linear-gradient(90deg, rgba(15,23,42,.72) 0%, rgba(15,23,42,.45) 42%, rgba(15,23,42,.10) 70%, rgba(15,23,42,0) 100%);
    }
    .lg-slider .lg-caption{ position:relative; z-index:1; }
    .lg-slider .lg-arrow{
      position:absolute; top:50%; transform:translateY(-50%);
      width:44px; height:44px; border-radius:999px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255,255,255,.75);
      box-shadow: 0 10px 30px rgba(2,6,23,.18);
      backdrop-filter: blur(10px);
    }
    .lg-slider .lg-arrow:hover{ background: rgba(255,255,255,.92); }
    .lg-slider .lg-arrow:focus-visible{ outline: 3px solid rgba(56,189,248,.75); outline-offset: 2px; }
    .lg-slider .lg-arrow.prev{ left: 12px; }
    .lg-slider .lg-arrow.next{ right: 12px; }
    .lg-slider .lg-dots{ position:absolute; left:0; right:0; bottom: 12px; display:flex; gap:10px; justify-content:center; z-index:2; }
    .lg-slider .lg-dot{
      width: 9px; height: 9px; border-radius: 999px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(255,255,255,.55);
      transition: transform .2s ease, background .2s ease, width .2s ease;
    }
    .lg-slider .lg-dot[aria-current="true"]{
      background: rgba(255,255,255,.92);
      width: 22px;
    }
    .lg-kbdhint{
      display:none;
    }
    @media (min-width: 768px){
      .lg-kbdhint{ display:inline-flex; }
    }

    /* ---------- Micro interactions + Loading + Toast (A set) ---------- */
    .lg-icon{ transition: transform .18s ease, color .18s ease, opacity .18s ease; }
    .lg-field{ transition: transform .18s ease, filter .18s ease; }
    .lg-field:focus-within{ transform: translateY(-1px); }
    .lg-field:focus-within .lg-icon{ color: rgb(2 132 199 / 1); transform: translateY(-50%) scale(1.06); opacity: .95; }
    .lg-input{ transition: box-shadow .18s ease, border-color .18s ease, background-color .18s ease; }
    .lg-input.lg-invalid{
      border-color: rgba(244,63,94,.55) !important;
      box-shadow: 0 0 0 4px rgba(244,63,94,.14);
    }

    @keyframes lg-shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
    }
    .lg-shake{ animation: lg-shake .38s ease-in-out; }

    /* Button loading */
    .lg-btn.is-loading{ cursor: progress; }
    .lg-btn .btnSpinner{ display:none; }
    .lg-btn.is-loading .btnSpinner{ display:inline-flex; }
    .lg-btn.is-loading{ opacity: .92; }

    /* Toast */
    @keyframes lg-toast-in {
      from { opacity: 0; transform: translateY(-10px) scale(.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes lg-toast-out {
      from { opacity: 1; transform: translateY(0) scale(1); }
      to   { opacity: 0; transform: translateY(-10px) scale(.98); }
    }
    .lg-toast{ animation: lg-toast-in .22s ease-out both; }
    .lg-toast.leaving{ animation: lg-toast-out .18s ease-in both; }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .lg-toast{ animation: none !important; }
      .lg-shake{ animation: none !important; }
      .lg-field, .lg-icon, .lg-input{ transition: none !important; }
    }


    /* ===========================
       Mobile-first enhancements
       =========================== */
    body { overflow-x: hidden; }
    /* Prevent accidental horizontal scrolling from wide elements */
    .no-x-scroll { overflow-x: hidden; }

    /* Better touch targets + faster taps */
    button, a, input, select, textarea { touch-action: manipulation; }
    input, select, textarea { font-size: 16px; } /* avoid iOS zoom on focus */

    /* Utility: safe-area padding (iOS) */
    .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom) + 12px); }
    .pt-safe { padding-top: calc(env(safe-area-inset-top) + 12px); }

    /* Make media scale down on small screens */
    img, video, canvas, svg { max-width: 100%; height: auto; }

    /* Modal sheet layout helper */
    .modal-sheet { max-height: 92vh; display: flex; flex-direction: column; }
    .modal-sheet-body { min-height: 0; overflow-y: auto; -webkit-overflow-scrolling: touch; }

</style>
</head>
<body>

<div class="bg-pattern"></div>

<div class="app-shell flex flex-col min-h-screen text-base md:text-[17px] overflow-x-hidden">

  <!-- TOP DEMO BANNER -->
  <div class="bg-sky-900/90 text-sky-50 border-b border-sky-700/70">
    <div class="max-w-6xl mx-auto px-4 py-2 flex flex-col sm:flex-row items-center justify-between gap-2 text-[11px] sm:text-xs">
      <div class="flex items-center gap-2">
        <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-sky-500 text-[10px] uppercase tracking-[0.18em] shadow-sm">
          DEMO
        </span>
        <span>
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô <span class="font-semibold">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á</span> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‚Äì ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô, ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà, ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
        </span>
      </div>
      <div class="flex items-center gap-2 text-sky-200/90">
        <span class="hidden sm:inline">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÇ‡∏î‡πÄ‡∏°‡∏ô .com ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</span>
        <span class="inline-flex items-center gap-1">
          <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_0_3px_rgba(52,211,153,0.35)]"></span>
          Environment: <span class="font-semibold text-emerald-200">Production-like</span>
        </span>
      </div>
    </div>
  </div>

  <!-- NAVBAR -->
  <header class="sticky top-0 z-30 bg-white/90 backdrop-blur-xl border-b border-sky-100/80 shadow-[0_8px_24px_rgba(15,23,42,0.08)]">
    <div class="max-w-6xl mx-auto px-4 py-2.5 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <!-- Logo block -->
        <div class="relative float-slow">
          <div class="absolute -inset-1 bg-gradient-to-tr from-sky-400 via-cyan-300 to-blue-500 rounded-3xl blur-md opacity-80"></div>
          <div class="relative rounded-3xl overflow-hidden bg-white shadow-lg border border-sky-100 w-[170px] sm:w-[230px] h-[56px] sm:h-[72px] flex items-center">
            <!-- LOGO SVG -->
            <svg viewBox="0 0 320 120" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
              <rect x="0" y="0" width="320" height="120" rx="24" fill="#FFFFFF"/>
              <rect x="16" y="16" width="88" height="88" rx="24" fill="#E0F2FE"/>
              <circle cx="60" cy="60" r="26" fill="#1D9BF0"/>
              <circle cx="45" cy="40" r="8" fill="#1D9BF0"/>
              <circle cx="75" cy="40" r="8" fill="#1D9BF0"/>
              <circle cx="45" cy="40" r="4" fill="#E0F2FE"/>
              <circle cx="75" cy="40" r="4" fill="#E0F2FE"/>
              <ellipse cx="60" cy="66" rx="18" ry="14" fill="#F9FAFB"/>
              <path d="M52 46 L48 42 L50 48" stroke="#0F172A" stroke-width="2" stroke-linecap="round" fill="none"/>
              <path d="M68 46 L72 42 L70 48" stroke="#0F172A" stroke-width="2" stroke-linecap="round" fill="none"/>
              <circle cx="52" cy="60" r="2.2" fill="#0F172A"/>
              <circle cx="68" cy="60" r="2.2" fill="#0F172A"/>
              <path d="M58 63 Q60 65 62 63 Q60 64 58 63" fill="#FDBA74"/>
              <path d="M60 65 Q57 69 54 71" stroke="#0F172A" stroke-width="1.6" stroke-linecap="round" fill="none"/>
              <path d="M60 65 Q63 69 66 71" stroke="#0F172A" stroke-width="1.6" stroke-linecap="round" fill="none"/>
              <circle cx="50" cy="67" r="3" fill="#FDE68A" opacity="0.9"/>
              <circle cx="70" cy="67" r="3" fill="#FDE68A" opacity="0.9"/>
              <circle cx="34" cy="86" r="6" fill="#BFDBFE" opacity="0.8"/>
              <circle cx="44" cy="94" r="4" fill="#DBEAFE" opacity="0.9"/>
              <circle cx="80" cy="86" r="5" fill="#BFDBFE" opacity="0.85"/>
              <text x="116" y="56"
                    font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                    font-size="28"
                    font-weight="700"
                    fill="#0F172A">
                Laundry<tspan fill="#1D9BF0">Go</tspan>
              </text>
              <text x="116" y="82"
                    font-family="system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
                    font-size="13"
                    fill="#64748B">
                Online Laundry Pickup & Delivery
              </text>
            </svg>
          </div>
        </div>
        <div class="hidden sm:flex flex-col gap-0.5 text-[11px] text-slate-500">
          <span class="font-semibold text-slate-700">LaundryGo Platform</span>
          <span>‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á</span>
        </div>
      </div>

      <nav class="flex items-center flex-wrap justify-end gap-2 text-xs">
        <button id="navLoginBtn" type="button"
                onclick="showLogin()"
                class="px-3 py-2 sm:px-3.5 rounded-full border border-sky-200 text-sky-700 bg-sky-50/70 hover:bg-sky-100 hover:border-sky-300 transition font-medium">
          ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>
        <button id="navRegisterBtn" type="button"
                onclick="showRegister()"
                class="px-3 py-2 sm:px-3.5 rounded-full bg-gradient-to-r from-sky-500 to-cyan-500 text-white hover:from-sky-600 hover:to-cyan-600 shadow-md font-semibold">
          ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        </button>
        <button id="navAdminBtn" type="button"
                onclick="showAdminLogin()"
                class="hidden md:inline-flex px-3.5 py-2 rounded-full border border-amber-300/90 text-amber-800 bg-amber-50/80 hover:bg-amber-100 text-[11px] font-medium">
          ‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
        </button>
        <button id="logoutBtn" type="button"
                onclick="logout()"
                class="hidden px-3 py-2 sm:px-3.5 rounded-full bg-slate-900 text-white hover:bg-black shadow-sm text-[11px]">
          ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1">
    <div class="max-w-6xl mx-auto px-4 py-6 sm:py-8 md:py-10">

      <!-- LOGIN ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
      <section id="view-login" class="py-6 md:py-10">
        <div class="max-w-5xl mx-auto">

          <!-- Promo / How-to Slider (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ) -->
          <div class="mb-6 md:mb-8">
            <div id="loginPromoSlider"
                 class="lg-slider relative overflow-hidden rounded-[2rem] border border-white/70 bg-white/60 shadow-xl backdrop-blur-xl"
                 role="region" aria-label="‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
              <div class="lg-track">
                <!-- Slide 1 -->
                <article class="lg-slide" data-bg="" aria-label="‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
                  <div class="lg-bg"></div>
                  <div class="lg-sheen"></div>
                  <div class="lg-overlay"></div>

                  <div class="lg-caption p-6 md:p-8">
                    <div class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">
                      <span class="h-2 w-2 rounded-full bg-sky-300"></span>
                      ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
                      <span class="lg-kbdhint ml-2 rounded-full bg-white/10 px-2 py-0.5 text-[11px] text-white/80">‚Üê ‚Üí</span>
                    </div>

                    <h2 class="mt-3 text-2xl md:text-3xl font-semibold text-white leading-snug">
                      ‡∏Å‡∏î ‚Äú‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‚Äù ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‚Üí ‡∏£‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏ñ‡∏∂‡∏á‡∏ó‡∏µ‡πà
                    </h2>
                    <p class="mt-2 max-w-2xl text-sm md:text-base text-white/80">
                      ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏≠/‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î: ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¥‡πâ‡∏ß‡∏ú‡πâ‡∏≤ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                      ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ + ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                    </p>

                    <div class="mt-4 flex flex-wrap gap-2">
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô</span>
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                    </div>
                  </div>
                </article>

                <!-- Slide 2 -->
                <article class="lg-slide" data-bg="" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ï‡∏≤‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå">
                  <div class="lg-bg" style="--slide-fallback: radial-gradient(circle at 15% 25%, rgba(251,191,36,.28), transparent 55%),
                                                     radial-gradient(circle at 75% 18%, rgba(34,211,238,.28), transparent 55%),
                                                     radial-gradient(circle at 25% 85%, rgba(59,130,246,.25), transparent 55%),
                                                     linear-gradient(120deg, rgba(15,23,42,.92), rgba(2,132,199,.18));"></div>
                  <div class="lg-sheen"></div>
                  <div class="lg-overlay"></div>

                  <div class="lg-caption p-6 md:p-8">
                    <div class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">
                      <span class="h-2 w-2 rounded-full bg-amber-300"></span>
                      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‚Äù ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ú‡πâ‡∏≤
                    </div>

                    <h2 class="mt-3 text-2xl md:text-3xl font-semibold text-white leading-snug">
                      ‡∏´‡∏≠‡∏°‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô / ‡∏ô‡∏∏‡πà‡∏°‡∏ü‡∏π / ‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢
                    </h2>
                    <p class="mt-2 max-w-2xl text-sm md:text-base text-white/80">
                      ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏´‡πâ)
                      ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ä‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô
                    </p>

                    <div class="mt-4 flex flex-wrap gap-2">
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">Fresh</span>
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">Cozy</span>
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">Sensitive</span>
                    </div>
                  </div>
                </article>

                <!-- Slide 3 -->
                <article class="lg-slide" data-bg="" aria-label="‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢">
                  <div class="lg-bg" style="--slide-fallback: radial-gradient(circle at 20% 20%, rgba(16,185,129,.26), transparent 55%),
                                                     radial-gradient(circle at 85% 25%, rgba(59,130,246,.26), transparent 55%),
                                                     radial-gradient(circle at 30% 85%, rgba(34,211,238,.22), transparent 55%),
                                                     linear-gradient(120deg, rgba(15,23,42,.92), rgba(2,132,199,.18));"></div>
                  <div class="lg-sheen"></div>
                  <div class="lg-overlay"></div>

                  <div class="lg-caption p-6 md:p-8">
                    <div class="inline-flex items-center gap-2 rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">
                      <span class="h-2 w-2 rounded-full bg-emerald-300"></span>
                      ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏á‡πà‡∏≤‡∏¢ & ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
                    </div>

                    <h2 class="mt-3 text-2xl md:text-3xl font-semibold text-white leading-snug">
                      ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏≥‡∏£‡∏∞‡∏ú‡πà‡∏≤‡∏ô QR/‡πÇ‡∏≠‡∏ô/‡πÄ‡∏î‡∏ö‡∏¥‡∏ï
                    </h2>
                    <p class="mt-2 max-w-2xl text-sm md:text-base text-white/80">
                      ‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå + ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                      ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö
                    </p>

                    <div class="mt-4 flex flex-wrap gap-2">
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">QR Payment</span>
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</span>
                      <span class="rounded-full bg-white/15 px-3 py-1 text-xs text-white/90 ring-1 ring-white/20">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</span>
                    </div>
                  </div>
                </article>
              </div>

              <!-- arrows -->
              <button type="button" class="lg-arrow prev" aria-label="‡∏™‡πÑ‡∏•‡∏î‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </button>
              <button type="button" class="lg-arrow next" aria-label="‡∏™‡πÑ‡∏•‡∏î‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
              </button>

              <!-- dots -->
              <div class="lg-dots" aria-label="‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πÑ‡∏•‡∏î‡πå">
                <button class="lg-dot" type="button" aria-label="‡πÑ‡∏õ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà 1" aria-current="true"></button>
                <button class="lg-dot" type="button" aria-label="‡πÑ‡∏õ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà 2" aria-current="false"></button>
                <button class="lg-dot" type="button" aria-label="‡πÑ‡∏õ‡∏™‡πÑ‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà 3" aria-current="false"></button>
              </div>
            </div>

            <p class="mt-3 text-xs text-slate-600">
              * ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏™‡πÑ‡∏•‡∏î‡πå‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÉ‡∏™‡πà path ‡∏£‡∏π‡∏õ‡∏•‡∏á‡πÉ‡∏ô <span class="font-mono">data-bg</span> ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πÑ‡∏•‡∏î‡πå (‡πÄ‡∏ä‡πà‡∏ô <span class="font-mono">data-bg="assets/slide1.jpg"</span>)
            </p>
          </div>

          <!-- LOGIN (Mr.Kevin-ish style: split card + icon inputs) -->
          <div id="loginCard" class="relative overflow-hidden rounded-[2.5rem] border border-white/70 bg-white/70 shadow-2xl backdrop-blur-xl">
            <!-- Decorative blobs -->
            <div class="pointer-events-none absolute -top-24 -left-24 h-72 w-72 rounded-full bg-sky-300/40 blur-3xl"></div>
            <div class="pointer-events-none absolute -bottom-28 -right-28 h-80 w-80 rounded-full bg-cyan-300/35 blur-3xl"></div>

            <div class="grid md:grid-cols-2">
              <!-- LEFT: brand panel -->
              <div class="relative p-7 md:p-10 bg-gradient-to-br from-slate-900/95 via-slate-900/92 to-slate-950/95 text-white">
                <div class="absolute inset-0 opacity-25"
                     style="background-image: radial-gradient(circle at 20% 10%, rgba(56,189,248,0.55), transparent 55%),
                                            radial-gradient(circle at 80% 20%, rgba(34,211,238,0.35), transparent 55%),
                                            radial-gradient(circle at 30% 90%, rgba(59,130,246,0.30), transparent 55%);">
                </div>

                <div class="relative">
                  <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-2xl bg-white/10 border border-white/15 flex items-center justify-center">
                      <!-- Tiny mascot logo -->
                      <svg viewBox="0 0 320 120" xmlns="http://www.w3.org/2000/svg" class="w-10 h-10">
                        <rect x="0" y="0" width="320" height="120" rx="24" fill="rgba(255,255,255,0.92)"/>
                        <rect x="16" y="16" width="88" height="88" rx="24" fill="#E0F2FE"/>
                        <circle cx="60" cy="60" r="26" fill="#1D9BF0"/>
                        <circle cx="45" cy="40" r="8" fill="#1D9BF0"/>
                        <circle cx="75" cy="40" r="8" fill="#1D9BF0"/>
                        <circle cx="45" cy="40" r="4" fill="#E0F2FE"/>
                        <circle cx="75" cy="40" r="4" fill="#E0F2FE"/>
                        <ellipse cx="60" cy="66" rx="18" ry="14" fill="#F9FAFB"/>
                        <path d="M52 46 L48 42 L50 48" stroke="#0F172A" stroke-width="2" stroke-linecap="round" fill="none"/>
                        <path d="M68 46 L72 42 L70 48" stroke="#0F172A" stroke-width="2" stroke-linecap="round" fill="none"/>
                        <circle cx="52" cy="60" r="2.2" fill="#0F172A"/>
                        <circle cx="68" cy="60" r="2.2" fill="#0F172A"/>
                        <path d="M58 63 Q60 65 62 63 Q60 64 58 63" fill="#FDBA74"/>
                        <path d="M60 65 Q57 69 54 71" stroke="#0F172A" stroke-width="1.6" stroke-linecap="round" fill="none"/>
                        <path d="M60 65 Q63 69 66 71" stroke="#0F172A" stroke-width="1.6" stroke-linecap="round" fill="none"/>
                        <circle cx="50" cy="67" r="3" fill="#FDE68A" opacity="0.9"/>
                        <circle cx="70" cy="67" r="3" fill="#FDE68A" opacity="0.9"/>
                      </svg>
                    </div>
                    <div class="leading-tight">
                      <div class="text-sm font-semibold">LaundryGo Platform</div>
                      <div class="text-xs text-white/70">Online Laundry Pickup & Delivery</div>
                    </div>
                  </div>

                  <h1 class="mt-7 text-2xl md:text-3xl font-semibold leading-snug">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô<br class="hidden sm:block" />
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏±‡∏Å-‡∏≠‡∏ö-‡∏û‡∏±‡∏ö‡πÄ‡∏î‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡∏µ‡πà
                  </h1>
                  <p class="mt-3 text-sm text-white/70 max-w-md">
                    ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                    (‡πÄ‡∏î‡πÇ‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° <span class="font-semibold text-sky-200">Supabase</span>)
                  </p>

                  <div class="mt-6 grid gap-3 text-sm">
                    <div class="flex items-start gap-3">
                      <span class="mt-0.5 inline-flex h-8 w-8 items-center justify-center rounded-xl bg-white/10 border border-white/10">üß∫</span>
                      <div>
                        <div class="font-medium">‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</div>
                        <div class="text-xs text-white/65">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ + ‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ + ‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á</div>
                      </div>
                    </div>
                    <div class="flex items-start gap-3">
                      <span class="mt-0.5 inline-flex h-8 w-8 items-center justify-center rounded-xl bg-white/10 border border-white/10">üìç</span>
                      <div>
                        <div class="font-medium">‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</div>
                        <div class="text-xs text-white/65">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Google Maps (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î)</div>
                      </div>
                    </div>
                    <div class="flex items-start gap-3">
                      <span class="mt-0.5 inline-flex h-8 w-8 items-center justify-center rounded-xl bg-white/10 border border-white/10">üí≥</span>
                      <div>
                        <div class="font-medium">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô/QR</div>
                        <div class="text-xs text-white/65">‡∏°‡∏µ Flow ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Payment</div>
                      </div>
                    </div>
                  </div>

                  <div class="mt-8 flex flex-wrap items-center gap-2 text-[11px] text-white/70">
                    <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/10">
                      <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                      System Online
                    </span>
                    <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/10">
                      üîí HTTPS Ready
                    </span>
                    <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/10">
                      ‚ö° Fast UI
                    </span>
                  </div>
                </div>
              </div>

              <!-- RIGHT: login form -->
              <div class="p-7 md:p-10">
                <div class="flex items-center justify-between gap-3">
                  <div>
                    <h2 class="text-2xl font-semibold text-slate-900">Sign In</h2>
                    <p class="mt-1 text-sm text-slate-500">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                  </div>
                  <span class="hidden sm:inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100 text-[11px]">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                    Supabase Connected
                  </span>
                </div>

                <form id="loginForm" class="mt-6 space-y-4">
                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">Username</label>
                    <div class="relative lg-field">
                      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 lg-icon">
                        <!-- mail icon (similar vibe) -->
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M4 6.5C4 5.67 4.67 5 5.5 5H18.5C19.33 5 20 5.67 20 6.5V17.5C20 18.33 19.33 19 18.5 19H5.5C4.67 19 4 18.33 4 17.5V6.5Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                          <path d="M5 7L12 12L19 7" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <input id="loginUsername"
                             class="w-full rounded-xl border border-slate-200/80 bg-white/80 pl-10 pr-3 py-3 text-base text-slate-900 placeholder:text-slate-400 shadow-sm lg-input focus:outline-none focus:ring-2 focus:ring-sky-400 focus:border-sky-300"
                             placeholder="‡πÄ‡∏ä‡πà‡∏ô walker_laundry"
                             required autocomplete="username" inputmode="text" />
                    </div>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1.5">Password</label>
                    <div class="relative lg-field">
                      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 lg-icon">
                        <!-- lock icon (similar vibe) -->
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M7.5 11V8.5C7.5 6.015 9.515 4 12 4C14.485 4 16.5 6.015 16.5 8.5V11" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                          <path d="M6.5 11H17.5C18.328 11 19 11.672 19 12.5V18C19 18.828 18.328 19.5 17.5 19.5H6.5C5.672 19.5 5 18.828 5 18V12.5C5 11.672 5.672 11 6.5 11Z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <input id="loginPassword" type="password"
                             class="w-full rounded-xl border border-slate-200/80 bg-white/80 pl-10 pr-3 py-3 text-base text-slate-900 placeholder:text-slate-400 shadow-sm lg-input focus:outline-none focus:ring-2 focus:ring-sky-400 focus:border-sky-300"
                             placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
                             required autocomplete="current-password" />
                    </div>
                  </div>

                  <div class="flex items-center justify-between text-xs">
                    <button type="button"
                            onclick="alert('‡πÄ‡∏î‡πÇ‡∏°‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° flow ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)')"
                            class="text-slate-500 hover:text-slate-700 hover:underline">
                      ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?
                    </button>
                    <button type="button" onclick="showAdminLogin()"
                            class="text-amber-700 hover:text-amber-800 hover:underline">
                      ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
                    </button>
                  </div>

                  <button id="loginSubmitBtn" type="submit"
                          class="lg-btn w-full py-3 rounded-xl bg-slate-900 text-white text-base font-semibold hover:bg-black shadow-md transition disabled:opacity-60 disabled:cursor-not-allowed">
                    <span class="inline-flex items-center justify-center gap-2">
                      <span class="btnText">Sign In</span>
                      <span class="btnSpinner" aria-hidden="true">
                        <svg class="h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M12 3a9 9 0 1 0 9 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </span>
                    </span>
                  </button>

                  <div class="pt-1 text-sm text-slate-600">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?
                    <button type="button" onclick="showRegister()" class="text-sky-600 hover:underline font-semibold">
                      ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                    </button>
                  </div>

                  <div class="mt-5 rounded-2xl border border-slate-100 bg-slate-50/70 px-4 py-3 text-[11px] text-slate-500">
                    ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ‡∏Å‡∏î ‚Äú‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
                  </div>
                </form>
              </div>
            </div>
          </div>

          <p class="mt-4 text-center text-[11px] text-slate-500">
            ¬© <span class="font-semibold">LaundryGo</span> ‚Äì Demo UI inspired by modern split-login layouts
          </p>
        </div>

      <!-- MODAL: ‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
      <div id="ordersModal" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="absolute inset-0 flex items-end md:items-center justify-center p-3">
          <div class="w-full max-w-3xl rounded-[2rem] bg-white shadow-2xl border border-slate-200 overflow-hidden modal-sheet pb-safe">
            <div class="p-4 md:p-5 border-b border-slate-100 flex items-start justify-between gap-3">
              <div>
                <p class="text-xs text-slate-500">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                <h3 class="text-lg font-semibold text-slate-900">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
              </div>
              <button type="button" id="btnCloseOrdersModal"
                      class="rounded-xl px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700">
                ‡∏õ‡∏¥‡∏î
              </button>
            </div>

            <div class="p-4 md:p-5 space-y-4 modal-sheet-body">
              <div class="grid md:grid-cols-3 gap-3">
                <div class="md:col-span-2">
                  <label class="block text-xs text-slate-600 mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏)</label>
                  <input id="ordersSearch"
                         class="w-full border rounded-xl px-3.5 py-2.5 bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400"
                         placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
                </div>
                <div>
                  <label class="block text-xs text-slate-600 mb-1">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö</label>
                  <select id="ordersSort"
                          class="w-full border rounded-xl px-3.5 py-2.5 bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400">
                    <option value="newest" selected>‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤</option>
                    <option value="oldest">‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà</option>
                  </select>
                </div>
              </div>

              <div>
                <p class="text-xs text-slate-600 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
                <div id="ordersStatusChips" class="flex flex-wrap gap-2"></div>
              </div>

              <div class="rounded-2xl border border-slate-200 bg-slate-50/60 p-3">
                <p id="ordersModalHint" class="text-xs text-slate-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                <div id="ordersAllList" class="mt-3 space-y-2 text-sm text-slate-700"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL: ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà -->
      <div id="addressHelpModal" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="absolute inset-0 flex items-end md:items-center justify-center p-3">
          <div class="w-full max-w-xl rounded-[2rem] bg-white shadow-2xl border border-slate-200 overflow-hidden modal-sheet pb-safe">
            <div class="p-4 md:p-5 border-b border-slate-100 flex items-start justify-between gap-3">
              <div>
                <p class="text-xs text-slate-500">‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                <h3 class="text-lg font-semibold text-slate-900">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥</h3>
              </div>
              <button type="button" id="btnCloseAddressHelp"
                      class="rounded-xl px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700">
                ‡∏õ‡∏¥‡∏î
              </button>
            </div>
            <div class="p-4 md:p-5 text-sm text-slate-700 space-y-2 modal-sheet-body">
              <ol class="list-decimal pl-5 space-y-1">
                <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‚Äù</li>
                <li>‡∏Å‡∏î ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å/‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤</li>
                <li>‡∏Å‡∏£‡∏≠‡∏Å ‚Äú‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å/‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‚Äù</li>
                <li>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏≤‡∏Å ‚Äú‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‚Äù ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
              </ol>
              <p class="text-xs text-slate-500">* ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer_addresses ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏î‡∏π SQL ‡∏ó‡∏µ‡πà‡∏ú‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ô‡πÅ‡∏ä‡∏ï)</p>
            </div>
          </div>
        </div>
      </div>
      </section>

      <!-- REGISTER ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
      <section id="view-register"
               class="hidden max-w-md mx-auto glass-card rounded-[2rem] shadow-xl p-7 border border-sky-100/90">
        <h2 class="text-2xl font-semibold text-slate-900 mb-1.5">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2>
        <p class="text-sm text-slate-500 mb-4">
          ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡πÇ‡∏°‡πà ‚Äì ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á
        </p>
        <form id="registerForm" class="space-y-4">
          <div>
            <label class="block text-base text-slate-700 mb-1.5">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input id="regFullName"
                   class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-sky-400 bg-slate-50/80"
                   required autocomplete="name">
          </div>
          <div>
            <label class="block text-base text-slate-700 mb-1.5">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)</label>
            <input id="regUsername"
                   class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-sky-400 bg-slate-50/80"
                   required autocomplete="username" inputmode="text">
          </div>
          <div>
            <label class="block text-base text-slate-700 mb-1.5">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
            <input id="regPhone" type="tel"
                   class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-sky-400 bg-slate-50/80"
                   required autocomplete="tel" inputmode="tel">
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="block text-base text-slate-700 mb-1.5">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input id="regPassword" type="password"
                     class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-sky-400 bg-slate-50/80"
                     required autocomplete="new-password">
            </div>
            <div>
              <label class="block text-base text-slate-700 mb-1.5">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <input id="regPassword2" type="password"
                     class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-sky-400 bg-slate-50/80"
                     required autocomplete="new-password">
            </div>
          </div>
          <button type="submit"
                  class="w-full py-3 rounded-xl bg-gradient-to-r from-sky-500 to-cyan-500 text-white text-base font-semibold hover:from-sky-600 hover:to-cyan-600 shadow-md">
            ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
          </button>
          <p class="text-xs text-slate-500 text-center mt-2">
            ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß?
            <button type="button" onclick="showLogin()" class="text-sky-500 underline font-semibold">
              ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>
          </p>
        </form>
      </section>

      <!-- ADMIN LOGIN -->
      <section id="view-admin-login"
               class="hidden max-w-md mx-auto rounded-[2rem] p-7 bg-slate-900/95 text-slate-50 border border-amber-300/70 shadow-[0_22px_60px_rgba(15,23,42,0.85)]">
        <h2 class="text-2xl font-semibold mb-1 flex items-center gap-2">
          <span class="text-3xl">üõ†Ô∏è</span>
          <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</span>
        </h2>
        <p class="text-sm text-slate-300 mb-4">
          ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π <span class="font-semibold text-amber-200">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö 5 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span> ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô
          ‚Äì ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå/‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô
        </p>
        <form id="adminLoginForm" class="space-y-4">
          <div>
            <label class="block text-base mb-1.5">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</label>
            <input id="adminUsername"
                   class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-amber-400 bg-slate-800/90 border-slate-700"
                   placeholder="‡πÄ‡∏ä‡πà‡∏ô admin"
                   required autocomplete="username" inputmode="text">
          </div>
          <div>
            <label class="block text-base mb-1.5">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input id="adminPassword" type="password"
                   class="w-full border rounded-xl px-3.5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-amber-400 bg-slate-800/90 border-slate-700"
                   placeholder="‡πÄ‡∏ä‡πà‡∏ô 123456"
                   required autocomplete="current-password">
          </div>
          <button type="submit"
                  class="w-full py-3 rounded-xl bg-gradient-to-r from-amber-400 to-orange-500 text-slate-900 text-sm font-semibold hover:from-amber-500 hover:to-orange-600 shadow-md">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
          </button>
          <p class="text-[11px] text-slate-300 text-center mt-2">
            ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:
            <span class="font-mono">admin / 123456</span> (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÉ‡∏ô Supabase) ‚Äì
            ‡πÇ‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ <span class="font-semibold text-amber-200">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
          </p>
        </form>
      </section>

      <!-- ADMIN DASHBOARD -->
      <section id="view-admin-dashboard" class="hidden space-y-5 py-4">
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
<div>
<h2 class="text-2xl font-semibold text-slate-50 flex items-center gap-2">
<span class="text-3xl">üìã</span>
<span>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</span>
</h2>
<p class="text-sm text-slate-200 mt-1">
              ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì <span class="font-semibold text-amber-300" id="adminName"></span>
              ‚Äì ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
            </p>
</div>
<div class="flex flex-wrap items-center gap-2 text-xs">
<span class="inline-flex items-center gap-1 rounded-full bg-amber-50/10 px-3 py-1 border border-amber-200/60 text-amber-100">
<span class="w-1.5 h-1.5 rounded-full bg-emerald-300"></span>
              ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÇ‡∏´‡∏°‡∏î (Demo)
            </span>
<button class="px-3.5 py-2 rounded-full border border-sky-200 text-sky-100 bg-slate-900/70 hover:bg-sky-900/80 text-[11px]" onclick="backToServices()" type="button">
              ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
            </button>
</div>
</div>

        <div class="flex items-center gap-2 mt-4 overflow-x-auto flex-nowrap whitespace-nowrap md:flex-wrap md:overflow-visible">
          <button id="adminTabBtnOverview" data-admin-tab="overview"
                  class="px-3.5 py-2 rounded-full text-[12px] font-semibold border border-slate-600 bg-slate-900/70 text-slate-100 hover:bg-slate-800/80">
            üìà ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
          </button>
          <button id="adminTabBtnOrders" data-admin-tab="orders"
                  class="px-3.5 py-2 rounded-full text-[12px] font-semibold border border-slate-600 bg-slate-900/40 text-slate-200 hover:bg-slate-800/80">
            üßæ ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
          </button>
          <button id="adminTabBtnCustomers" data-admin-tab="customers"
                  class="px-3.5 py-2 rounded-full text-[12px] font-semibold border border-slate-600 bg-slate-900/40 text-slate-200 hover:bg-slate-800/80">
            üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
          </button>
                    <button id="adminTabBtnServices" data-admin-tab="services"
                  class="px-3.5 py-2 rounded-full text-[12px] font-semibold border border-slate-600 bg-slate-900/40 text-slate-200 hover:bg-slate-800/80">
            üõ†Ô∏è ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£/‡∏£‡∏≤‡∏Ñ‡∏≤
          </button>
<span id="adminChartsUpdatedAt" class="ml-auto text-[11px] text-slate-400"></span>
        </div>


        <div id="adminTabOverview" class="space-y-4">
<div class="bg-slate-900/95 border border-slate-700 rounded-[2rem] p-4 md:p-5 text-slate-50 space-y-3 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
<div>
<h3 class="text-lg font-semibold flex items-center gap-2">
<span class="text-2xl">üìä</span>
                ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö &amp; ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏±‡∏ô
              </h3>
<p class="text-sm text-slate-300">
                ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠ <span class="font-semibold text-emerald-300">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span> ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡πÑ‡∏õ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î Business ‡∏à‡∏£‡∏¥‡∏á
              </p>
<p class="text-[11px] text-slate-400 mt-1" id="summaryUpdatedAt"></p>
</div>
<div class="flex flex-col items-end gap-2 text-sm">
<p class="text-slate-300">
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
                <span class="font-semibold text-emerald-300" id="summarySelectedDateLabel">-</span>
</p>
<div class="flex flex-wrap gap-3 text-xs">
<div class="px-3 py-2 rounded-2xl bg-slate-800 border border-slate-700 min-w-[120px]">
<p class="text-slate-400 text-[11px]">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏ß‡∏°</p>
<p class="text-lg font-semibold text-slate-50">
<span id="summaryOrderCount">0</span> ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå
                  </p>
</div>
<div class="px-3 py-2 rounded-2xl bg-slate-800 border border-slate-700 min-w-[130px]">
<p class="text-slate-400 text-[11px]">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏î‡πÇ‡∏°‡πà)</p>
<p class="text-lg font-semibold text-emerald-300">
                    ‡∏ø<span id="summaryPaidRevenue">0</span>
</p>
</div>
<div class="px-3 py-2 rounded-2xl bg-slate-800 border border-slate-700 min-w-[130px]">
<p class="text-slate-400 text-[11px]">‡∏¢‡∏≠‡∏î‡∏ó‡∏∏‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
<p class="text-lg font-semibold text-sky-300">
                    ‡∏ø<span id="summaryAllRevenue">0</span>
</p>
</div>
</div>
</div>
</div>
<div class="mt-3">
<p class="text-xs text-slate-300 mb-2">
              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á <span class="font-semibold text-amber-200">orders</span> ‡πÉ‡∏ô Supabase
            </p>
<div class="flex flex-wrap gap-2 text-xs" id="summaryDayButtons"></div>
</div>
</div>

        <div class="grid md:grid-cols-2 gap-4">
          <div class="bg-slate-900/95 border border-slate-700 rounded-2xl p-5 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
            <div class="flex items-center justify-between gap-3">
              <h3 class="text-base font-semibold text-slate-50 flex items-center gap-2">
                <span class="text-xl">ü•á</span> ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (30 ‡∏ß‡∏±‡∏ô)
              </h3>
              <button id="adminRefreshChartsBtn"
                      class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-sky-600 text-white hover:bg-sky-700 text-[11px]">
                üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
              </button>
            </div>
            <p class="text-[11px] text-slate-400 mt-1">‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÇ‡∏õ‡∏£/‡∏à‡∏±‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏ô</p>
            <div class="mt-3">
              <canvas id="chartTopServices" height="140"></canvas>
            </div>
          </div>

          <div class="bg-slate-900/95 border border-slate-700 rounded-2xl p-5 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
            <h3 class="text-base font-semibold text-slate-50 flex items-center gap-2">
              <span class="text-xl">üìÜ</span> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (30 ‡∏ß‡∏±‡∏ô)
            </h3>
            <p class="text-[11px] text-slate-400 mt-1">‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏ß‡∏±‡∏ô‡∏û‡∏µ‡∏Ñ/‡∏ß‡∏±‡∏ô‡πÄ‡∏á‡∏µ‡∏¢‡∏ö</p>
            <div class="mt-3">
              <canvas id="chartOrdersTrend" height="140"></canvas>
            </div>
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div class="bg-slate-900/95 border border-slate-700 rounded-2xl p-5 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
            <h3 class="text-base font-semibold text-slate-50 flex items-center gap-2">
              <span class="text-xl">üí≥</span> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (30 ‡∏ß‡∏±‡∏ô)
            </h3>
            <p class="text-[11px] text-slate-400 mt-1">‡πÉ‡∏ä‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô ‚Äú‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞/‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß‚Äù</p>
            <div class="mt-3">
              <canvas id="chartPaymentStatus" height="140"></canvas>
            </div>
          </div>

          <div class="bg-slate-900/95 border border-slate-700 rounded-2xl p-5 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
            <h3 class="text-base font-semibold text-slate-50 flex items-center gap-2">
              <span class="text-xl">üß†</span> ‡∏≠‡∏¥‡∏ô‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
            </h3>
            <ul id="adminInsightsList" class="mt-3 space-y-2 text-sm text-slate-200"></ul>
            <p class="text-[11px] text-slate-400 mt-3">* ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ô‡∏µ‡πâ</p>
          </div>
        </div>

        </div>


        <div id="adminTabOrders" class="hidden space-y-4">
<div class="glass-card rounded-[2rem] shadow-xl border border-amber-100 p-4 space-y-3">
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
<div class="text-sm text-slate-800">
              ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
              <span class="text-[11px] text-amber-500 ml-1">(‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á)</span>
</div>
<div class="flex flex-wrap items-center gap-2 text-xs">
<select class="border rounded-xl px-3.5 py-2 bg-amber-50/80 border-amber-200 text-amber-800 focus:outline-none focus:ring-2 focus:ring-amber-300" id="adminStatusFilter">
<option value="all">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
<option value="‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤">‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤</option>
<option value="‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß">‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß</option>
<option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏±‡∏Å">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏±‡∏Å</option>
<option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏ö">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏ö</option>
<option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏ö">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏ö</option>
<option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</option>
<option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
<option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
</select>
<select class="border rounded-xl px-3.5 py-2 bg-emerald-50/80 border-emerald-200 text-emerald-800 focus:outline-none focus:ring-2 focus:ring-emerald-300" id="adminPaymentFilter">
<option value="all">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
<option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</option>
<option value="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</option>
<option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</option>
</select>
              <input id="adminSearchInput" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ username/‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå"
                     class="w-full md:w-[280px] border rounded-xl px-3.5 py-2 bg-slate-950/30 border-slate-600 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400" />

<button class="inline-flex items-center gap-1 px-3.5 py-2 rounded-full bg-amber-500 text-white hover:bg-amber-600 text-[11px]" id="adminReloadBtn" type="button">
                üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
              </button>
</div>
</div>
<p class="text-[11px] text-slate-500" id="adminSummary">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå...
          </p>
<p class="text-[11px] text-slate-400">
            * ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà <span class="font-semibold text-emerald-700">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô + ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ß‡∏±‡∏ô</span> ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
            ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πà‡∏≠
          </p>
<div class="mt-1 space-y-2 text-sm max-h-[480px] overflow-y-auto pr-1" id="adminOrdersList"></div>
</div>
          <div class="flex flex-wrap items-center gap-2">
            <button id="adminExportCsvBtn"
                    class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 text-[11px]">
              ‚¨áÔ∏è Export CSV
            </button>
            <span class="text-[11px] text-slate-400">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‚Äú‡∏ï‡∏≤‡∏°‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‚Äù ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV</span>
          </div>
        </div>


        <div id="adminTabCustomers" class="hidden space-y-4">
          <div class="bg-slate-900/95 border border-slate-700 rounded-2xl p-5 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
              <div>
                <h3 class="text-lg font-semibold text-slate-50 flex items-center gap-2">
                  <span class="text-2xl">üë§</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                </h3>
                <p class="text-sm text-slate-300 mt-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ï‡πâ‡∏°/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ + ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ</p>
              </div>
              <div class="flex items-center gap-2">
                <button id="adminCustomersReloadBtn"
                        class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-amber-500 text-white hover:bg-amber-600 text-[11px]">
                  üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                </button>
              </div>
            </div>

            <div class="mt-4 grid md:grid-cols-3 gap-2">
              <input id="adminCustomerSearch" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏ä‡∏∑‡πà‡∏≠ / username / ‡πÄ‡∏ö‡∏≠‡∏£‡πå"
                     class="md:col-span-2 px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-400" />
              <select id="adminCustomerSort"
                      class="px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400">
                <option value="newest">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î</option>
                <option value="points">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡πÅ‡∏ï‡πâ‡∏°‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î</option>
                <option value="spend">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î (30 ‡∏ß‡∏±‡∏ô)</option>
              </select>
            </div>

            <p id="adminCustomersSummary" class="text-[11px] text-slate-400 mt-3">‚Äî</p>

            <div class="mt-3 overflow-auto max-h-[520px] border border-slate-700 rounded-2xl">
              <table class="w-full text-sm">
                <thead class="bg-slate-900 text-slate-200 sticky top-0">
                  <tr>
                    <th class="text-left px-3 py-2">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                    <th class="text-left px-3 py-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå</th>
                    <th class="text-right px-3 py-2">‡πÅ‡∏ï‡πâ‡∏°</th>
                    <th class="text-right px-3 py-2">‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ 30 ‡∏ß‡∏±‡∏ô</th>
                    <th class="text-right px-3 py-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                  </tr>
                </thead>
                <tbody id="adminCustomersTbody" class="divide-y divide-slate-800"></tbody>
              </table>
            </div>

            <p class="text-[11px] text-slate-500 mt-3">
              ‡∏ó‡∏¥‡∏õ: ‡∏Å‡∏î ‚Äú‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            </p>
          </div>
        </div>

        <div id="adminTabServices" class="hidden space-y-4">
          <div class="bg-slate-900/95 border border-slate-700 rounded-2xl p-5 shadow-[0_18px_40px_rgba(15,23,42,0.9)]">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
              <div>
                <h3 class="text-lg font-semibold text-slate-50 flex items-center gap-2">
                  <span class="text-2xl">üõ†Ô∏è</span> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ &amp; ‡∏£‡∏≤‡∏Ñ‡∏≤
                </h3>
                <p class="text-sm text-slate-300 mt-1">
                  ‡πÅ‡∏Å‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡πÄ‡∏ß‡∏•‡∏≤ ETA ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô <span class="font-semibold text-amber-200">localStorage</span> ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)
                </p>
              </div>
              <div class="flex flex-wrap items-center gap-2 text-xs">
                <button id="adminAddServiceBtn"
                        class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-sky-600 text-white hover:bg-sky-700 text-[11px]">
                  ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
                </button>
                <button id="adminExportServicesBtn"
                        class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 text-[11px]">
                  ‚¨áÔ∏è Export JSON
                </button>
                <button id="adminImportServicesBtn"
                        class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-amber-500 text-white hover:bg-amber-600 text-[11px]">
                  ‚¨ÜÔ∏è Import JSON
                </button>
                <button id="adminResetServicesBtn"
                        class="inline-flex items-center gap-1 px-3 py-2 rounded-full bg-slate-800 text-slate-100 hover:bg-slate-700 text-[11px] border border-slate-600">
                  ‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                </button>
              </div>
            </div>

            <p class="text-[11px] text-slate-400 mt-3" id="adminServicesSummary">‚Äî</p>

            <div class="mt-3 overflow-auto max-h-[560px] border border-slate-700 rounded-2xl">
              <table class="w-full text-sm">
                <thead class="bg-slate-900 text-slate-200 sticky top-0">
                  <tr>
                    <th class="text-left px-3 py-2">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th>
                    <th class="text-right px-3 py-2">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                    <th class="text-left px-3 py-2">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                    <th class="text-left px-3 py-2">ETA (‡∏ä‡∏°.)</th>
                    <th class="text-center px-3 py-2">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ</th>
                    <th class="text-right px-3 py-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                  </tr>
                </thead>
                <tbody id="adminServicesTbody" class="divide-y divide-slate-800"></tbody>
              </table>
            </div>

            <p class="text-[11px] text-slate-500 mt-3">
              ‡∏ó‡∏¥‡∏õ: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            </p>
          </div>
        </div>


      </section>
      <!-- ADMIN ORDER DETAIL / SLIP MODAL -->
      <div id="adminSlipModal" class="fixed inset-0 z-40 bg-black/40 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-xl max-w-lg w-[95%] p-4 relative">
          <button id="adminSlipClose" type="button" class="absolute right-3 top-3 text-slate-400 hover:text-slate-700 text-sm" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏•‡∏¥‡∏õ">
            ‚úï
          </button>
          <h3 class="text-base font-semibold text-slate-800 mb-2">
            ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå &amp; ‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
          </h3>
          <div class="text-[13px] space-y-1 mb-3">
            <p>
              <span class="text-slate-400">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #</span>
              <span id="adminSlipOrderId" class="font-semibold"></span>
            </p>
            <p>
              <span class="text-slate-400">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
              <span id="adminSlipCustomer" class="font-semibold"></span>
            </p>
            <p id="adminSlipService" class="text-slate-600"></p>
            <p id="adminSlipStatus" class="text-slate-600"></p>
            <p id="adminSlipPayment" class="text-slate-600"></p>
            <p id="adminSlipNote" class="text-slate-500"></p>
          </div>
          <div class="border rounded-xl overflow-hidden bg-slate-50 flex items-center justify-center min-h-[220px]">
            <img id="adminSlipImage" class="max-h-[360px] max-w-full object-contain hidden" src="" alt="‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
            <p id="adminSlipNoImage" class="text-xs text-slate-400 px-4 text-center">
              ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ
            </p>
          </div>
          <div class="mt-2 flex items-center justify-between text-[11px]">
            <a id="adminSlipOpenLink" href="#" target="_blank" rel="noopener" class="hidden text-sky-700 hover:underline">‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà</a>
            <span id="adminSlipHint" class="hidden text-slate-400">‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô: ‡∏ï‡∏±‡πâ‡∏á bucket ‡πÄ‡∏õ‡πá‡∏ô Public ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏≥ Storage policy ‡πÉ‡∏´‡πâ role anon ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ</span>
          </div>
          <p id="adminSlipError" class="hidden mt-1 text-[11px] text-rose-600"></p>
        </div>
      </div>


      
      <!-- ADMIN SERVICE EDIT MODAL -->
      <input id="adminServicesImportFile" type="file" accept="application/json" class="hidden" />
      <div id="adminServiceModal" class="fixed inset-0 z-[90] hidden">
        <div class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
        <div class="relative max-w-2xl mx-auto mt-10 p-4">
          <div class="bg-slate-900 border border-slate-700 rounded-2xl shadow-[0_22px_60px_rgba(2,6,23,0.8)] overflow-hidden">
            <div class="p-4 border-b border-slate-800 flex items-center justify-between">
              <div>
                <h3 id="adminServiceModalTitle" class="text-base font-semibold text-slate-50">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
                <p class="text-[11px] text-slate-400 mt-0.5">‡πÅ‡∏Å‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πá‡∏û‡∏≠ (‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢/ETA)</p>
              </div>
              <button id="adminServiceCloseBtn"
                      class="px-3 py-1.5 rounded-full border border-slate-600 text-slate-200 hover:bg-slate-800 text-[11px]">
                ‚úï ‡∏õ‡∏¥‡∏î
              </button>
            </div>

            <div class="p-4 space-y-3">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="md:col-span-2">
                  <label class="text-[11px] text-slate-400">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
                  <input id="adminServiceTitle" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏±‡∏Å-‡∏û‡∏±‡∏ö"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
                <div>
                  <label class="text-[11px] text-slate-400">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</label>
                  <input id="adminServiceIcon" type="text" placeholder="üß∫"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <div class="md:col-span-2">
                  <label class="text-[11px] text-slate-400">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (id)</label>
                  <input id="adminServiceId" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô wash_fold"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                  <p class="text-[11px] text-slate-500 mt-1">* ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á orders ‚Üí service_type</p>
                </div>
                <div>
                  <label class="text-[11px] text-slate-400">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                  <input id="adminServiceBasePrice" type="number" min="0" step="1" placeholder="0"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
                <div>
                  <label class="text-[11px] text-slate-400">‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                  <input id="adminServiceUnitLabel" type="text" placeholder="‡∏ñ‡∏∏‡∏á / ‡∏Ñ‡∏π‡πà / ‡∏ä‡∏¥‡πâ‡∏ô"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                <div class="md:col-span-2">
                  <label class="text-[11px] text-slate-400">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô</label>
                  <input id="adminServiceShortDesc" type="text" placeholder="‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏ö‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
                <div>
                  <label class="text-[11px] text-slate-400">ETA ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (‡∏ä‡∏°.)</label>
                  <input id="adminServiceEtaMin" type="number" min="1" step="1" placeholder="24"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
                <div>
                  <label class="text-[11px] text-slate-400">ETA ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏ä‡∏°.)</label>
                  <input id="adminServiceEtaMax" type="number" min="1" step="1" placeholder="36"
                         class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                </div>
              </div>

              <div class="flex items-center gap-2 text-sm">
                <input id="adminServiceActive" type="checkbox" class="w-4 h-4 accent-sky-500" checked>
                <label for="adminServiceActive" class="text-slate-200">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
              </div>

              <details class="rounded-2xl border border-slate-700 bg-slate-950/30 p-3">
                <summary class="cursor-pointer text-sm text-slate-200 font-semibold">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</summary>
                <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div>
                    <label class="text-[11px] text-slate-400">‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (cardBg)</label>
                    <input id="adminServiceCardBg" type="text" placeholder="bg-gradient-to-br from-sky-400 to-sky-600"
                           class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                    <p class="text-[11px] text-slate-500 mt-1">‡πÉ‡∏™‡πà‡∏Ñ‡∏•‡∏≤‡∏™ Tailwind (‡πÄ‡∏ä‡πà‡∏ô bg-gradient-to-br from-amber-400 to-orange-500)</p>
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-400">qtyLabel</label>
                    <input id="adminServiceQtyLabel" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡∏∏‡∏á‡∏ã‡∏±‡∏Å-‡∏û‡∏±‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô"
                           class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
                  </div>
                  <div class="md:col-span-2">
                    <label class="text-[11px] text-slate-400">heroDesc (‡πÉ‡∏ä‡πâ‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå)</label>
                    <textarea id="adminServiceHeroDesc" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏ö‡∏ö‡∏¢‡∏≤‡∏ß (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)"
                              class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400"></textarea>
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-400">primaryAddons (JSON array)</label>
                    <textarea id="adminServicePrimaryAddons" rows="4" placeholder='[{"id":"iron","name":"‡∏£‡∏µ‡∏î‡∏ú‡πâ‡∏≤","desc":"...","price":39,"icon":"üß¥"}]'
                              class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400"></textarea>
                  </div>
                  <div>
                    <label class="text-[11px] text-slate-400">extraAddons (JSON array)</label>
                    <textarea id="adminServiceExtraAddons" rows="4" placeholder='[{"id":"disinfect","name":"‡∏ã‡∏±‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠","desc":"...","price":69,"icon":"ü¶†"}]'
                              class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400"></textarea>
                  </div>
                </div>
              </details>

              <p id="adminServiceModalError" class="hidden text-sm text-rose-300 bg-rose-500/10 border border-rose-500/30 rounded-xl px-3 py-2"></p>
            </div>

            <div class="p-4 border-t border-slate-800 flex items-center justify-between gap-2">
              <button id="adminServiceDeleteBtn"
                      class="hidden inline-flex items-center gap-1 px-4 py-2 rounded-xl bg-rose-600 text-white hover:bg-rose-700 text-sm font-semibold">
                üóëÔ∏è ‡∏•‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
              </button>
              <div class="ml-auto flex items-center gap-2">
                <button id="adminServiceCancelBtn"
                        class="inline-flex items-center gap-1 px-4 py-2 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-800 text-sm font-semibold">
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button id="adminServiceSaveBtn"
                        class="inline-flex items-center gap-1 px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 text-sm font-semibold">
                  ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

<!-- SERVICES HUB -->
      <section id="view-services" class="hidden space-y-6 py-4">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div>
            <h2 class="text-2xl font-semibold text-slate-900 flex items-center gap-2">
              <span class="text-3xl">üßº</span>
              <span>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏≠‡∏ö‡∏£‡∏µ‡∏î‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡∏µ‡πà</span>
            </h2>
            <p class="text-sm text-slate-600 mt-1">
              ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì <span id="currentUserName" class="font-semibold text-sky-700"></span>
              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            </p>
          </div>
          <div class="flex flex-wrap items-center gap-2 text-xs text-slate-500">
            <span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-3 py-1 border border-emerald-100">
              <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
              ‡πÇ‡∏´‡∏°‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Demo)
            </span>
            <span class="inline-flex items-center gap-1 rounded-full bg-sky-50 px-3 py-1 border border-sky-100">
              ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <span class="font-semibold text-sky-700">Supabase</span>
            </span>
            <span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-3 py-1 border border-amber-100">
              ‚≠ê ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°: <span id="currentUserPoints" class="font-semibold text-amber-700">0</span>
            </span>
            <span class="inline-flex items-center gap-1 rounded-full bg-slate-50 px-3 py-1 border border-slate-200">
              üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥: <span id="defaultAddressLabel" class="font-semibold text-slate-700">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
              <button type="button" id="btnOpenAddressBook"
                      class="ml-1 text-[11px] font-semibold text-sky-700 hover:text-sky-800 underline underline-offset-2">
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
              </button>
              <button type="button" id="btnAddressHelp"
                      class="ml-1 text-[11px] text-sky-700 hover:text-sky-800 underline underline-offset-2">
                ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
              </button>
            </span>
            <button type="button" id="btnOpenNotif"
                    class="inline-flex items-center gap-1 rounded-full bg-white px-3 py-1 border border-slate-200 hover:bg-slate-50 shadow-sm">
              üîî <span class="text-[11px] font-semibold text-slate-700">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
              <span id="notifBadge" class="hidden ml-1 text-[10px] font-bold bg-rose-600 text-white px-1.5 py-0.5 rounded-full">0</span>
            </button>

          </div>
        </div>

        <div class="glass-card border border-sky-100 rounded-[2rem] p-4 md:p-5 shadow-md">
          <h3 class="text-lg font-semibold text-sky-800 mb-1">
            LaundryGo Web App ‚Äì ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏à‡∏£‡∏¥‡∏á
          </h3>
          <p class="text-sm text-slate-600 leading-relaxed">
            ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏ô‡πÇ‡∏î‡πÄ‡∏°‡∏ô <span class="font-semibold text-slate-900">.com</span>:
            ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå, ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà, ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏•‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
            ‚Äì ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
          </p>

          <!-- How it works / Timeline (‡πÉ‡∏´‡∏°‡πà) -->
          <div class="mt-4 grid md:grid-cols-3 gap-3 text-xs">
            <div class="flex items-start gap-2">
              <div class="mt-0.5">
                <div class="w-3 h-3 rounded-full bg-sky-500 timeline-dot"></div>
                <div class="h-10 w-px bg-sky-200 mx-auto mt-1 hidden md:block"></div>
              </div>
              <div>
                <p class="font-semibold text-slate-800">1. ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
                <p class="text-slate-600">
                  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ñ‡∏±‡∏á ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                </p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <div class="mt-0.5">
                <div class="w-3 h-3 rounded-full bg-sky-500 timeline-dot"></div>
                <div class="h-10 w-px bg-sky-200 mx-auto mt-1 hidden md:block"></div>
              </div>
              <div>
                <p class="font-semibold text-slate-800">2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Supabase</p>
                <p class="text-slate-600">
                  ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á <span class="font-mono text-[11px] bg-slate-100 px-1 rounded">orders</span> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ & ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
                </p>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <div class="mt-0.5">
                <div class="w-3 h-3 rounded-full bg-sky-500 timeline-dot"></div>
              </div>
              <div>
                <p class="font-semibold text-slate-800">3. ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</p>
                <p class="text-slate-600">
                  ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö 5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÑ‡∏î‡πâ
                </p>
              </div>
            </div>
          </div>
    <!-- Admin Customer Edit Modal -->
    <div id="adminCustomerModal" class="fixed inset-0 z-[80] hidden">
      <div class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
      <div class="relative max-w-lg mx-auto mt-10 p-4">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl shadow-[0_22px_60px_rgba(2,6,23,0.8)] overflow-hidden">
          <div class="p-4 border-b border-slate-800 flex items-center justify-between">
            <div>
              <h3 class="text-base font-semibold text-slate-50">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
              <p id="adminCustomerModalSubtitle" class="text-[11px] text-slate-400 mt-0.5">‚Äî</p>
            </div>
            <button id="adminCustomerCloseBtn"
                    class="px-3 py-1.5 rounded-full border border-slate-600 text-slate-200 hover:bg-slate-800 text-[11px]">
              ‚úï ‡∏õ‡∏¥‡∏î
            </button>
          </div>

          <div class="p-4 space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label class="text-[11px] text-slate-400">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
                <input id="adminEditCustomerPhone" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô 09x-xxx-xxxx"
                       class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400" />
              </div>
              <div>
                <label class="text-[11px] text-slate-400">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</label>
                <input id="adminEditCustomerPoints" type="number" min="0" step="1"
                       class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400" />
              </div>
            </div>

            <div>
              <label class="text-[11px] text-slate-400">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)</label>
              <textarea id="adminEditCustomerNote" rows="2" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥, ‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á 18:00"
                        class="mt-1 w-full px-3.5 py-2 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-400"></textarea>
              <p class="text-[11px] text-slate-500 mt-1">* ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå note ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ</p>
            </div>

            <p id="adminCustomerModalError" class="hidden text-sm text-rose-300 bg-rose-500/10 border border-rose-500/30 rounded-xl px-3 py-2"></p>
          </div>

          <div class="p-4 border-t border-slate-800 flex items-center justify-end gap-2">
            <button id="adminCustomerSaveBtn"
                    class="inline-flex items-center gap-1 px-4 py-2 rounded-xl bg-amber-500 text-white hover:bg-amber-600 text-sm font-semibold">
              ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </button>
          </div>
        </div>
      </div>
    </div>

        </div>

        
        <!-- PINNED: ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
        <div id="activeOrderWrap" class="hidden glass-card border border-amber-100 rounded-[2rem] p-4 md:p-5 shadow-md">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div>
              <h3 class="text-base font-semibold text-slate-900 flex items-center gap-2">
                <span class="text-xl">üßæ</span>
                <span>‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
              </h3>
              <p class="text-xs text-slate-500 mt-1">
                ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß (Pinned)
              </p>
            </div>
            <div class="flex items-center gap-2">
              <span id="activeOrderStatusBadge"
                    class="inline-flex items-center px-2.5 py-1 rounded-full text-[11px] bg-sky-50 text-sky-700 border border-sky-100">
                -
              </span>
              <span id="activeOrderPayBadge"
                    class="inline-flex items-center px-2.5 py-1 rounded-full text-[11px] bg-amber-50 text-amber-700 border border-amber-100">
                -
              </span>
              <button type="button" id="btnActiveOrderDetails"
                      class="inline-flex items-center gap-1 rounded-xl px-3 py-2 text-xs font-semibold
                             bg-slate-900 text-white hover:bg-slate-800 shadow-sm">
                ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
              </button>
            </div>
          </div>

          <div class="mt-3 grid md:grid-cols-3 gap-3">
            <div class="rounded-2xl border border-slate-200 bg-white/70 p-3">
              <p class="text-[11px] text-slate-500">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
              <p id="activeOrderService" class="font-semibold text-slate-900 text-sm">-</p>
              <p class="text-[11px] text-slate-500 mt-1">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
              <p id="activeOrderId" class="font-mono text-[12px] text-slate-700">-</p>
            </div>
            <div class="rounded-2xl border border-slate-200 bg-white/70 p-3">
              <p class="text-[11px] text-slate-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤</p>
              <p id="activeOrderPickup" class="font-semibold text-slate-900 text-sm">-</p>
              <p class="text-[11px] text-slate-500 mt-1">ETA ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</p>
              <p id="activeOrderEta" class="text-[12px] text-slate-700">-</p>
            </div>
            <div class="rounded-2xl border border-slate-200 bg-white/70 p-3">
              <p class="text-[11px] text-slate-500">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</p>
              <p class="font-semibold text-slate-900 text-sm">‡∏ø<span id="activeOrderPrice">-</span></p>
              <p class="text-[11px] text-slate-500 mt-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</p>
              <p id="activeOrderNote" class="text-[12px] text-slate-700 line-clamp-2">-</p>
            </div>
          </div>

          <!-- Timeline -->
          <div class="mt-4">
            <div id="activeOrderTimeline" class="grid grid-cols-4 md:grid-cols-8 gap-2 text-[11px]"></div>
          </div>
        </div>

        <div id="serviceCards" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>

        <!-- HISTORY -->
        <div class="glass-card rounded-[2rem] shadow-md border border-sky-100 p-4 mt-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-base font-semibold text-slate-900">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
            <button type="button" id="btnOpenOrdersModal"
                    class="text-[11px] font-semibold text-sky-700 hover:text-sky-800 underline underline-offset-2">
              ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>

            <span class="text-[11px] text-slate-400">‡πÅ‡∏™‡∏î‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
          </div>
          <p id="noOrdersMessage" class="text-xs text-slate-400 mt-1">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å Supabase ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
          </p>
          <div id="ordersList" class="mt-3 space-y-2 text-sm text-slate-700"></div>
        </div>
      </section>

      <!-- ORDER PAGE -->
      <section id="view-order" class="hidden space-y-5 py-4">
        <button type="button"
                onclick="backToServices()"
                class="inline-flex items-center gap-1 text-xs text-slate-500 hover:text-sky-600 mb-1">
          ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
        </button>

        <!-- TABS -->
        <div id="orderTabs"
             class="flex items-center gap-1 overflow-x-auto pb-2 border-b border-sky-100 text-sm"></div>

        
        <!-- PRESETS (‡πÉ‡∏´‡∏°‡πà) -->
        <div class="glass-card border border-sky-100 rounded-[2rem] p-3.5 md:p-4 shadow-md">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
            <div>
              <p class="text-sm font-semibold text-slate-900">‚ú® ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</p>
              <p class="text-[11px] text-slate-500 mt-0.5">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô + ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° + ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ + ‡πÄ‡∏ß‡∏•‡∏≤)</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 sm:items-center">
              <select id="presetSelect"
                      class="min-w-[220px] w-full sm:w-auto border rounded-xl px-3 py-2 text-xs bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï --</option>
              </select>
              <button type="button" id="btnApplyPreset"
                      class="rounded-xl px-4 py-2 text-xs font-semibold bg-white border border-slate-200 hover:bg-slate-50">
                ‡πÉ‡∏ä‡πâ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
              </button>
              <button type="button" id="btnSavePreset"
                      class="rounded-xl px-4 py-2 text-xs font-semibold bg-sky-600 hover:bg-sky-700 text-white shadow-sm">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
              </button>
              <button type="button" id="btnManagePresets"
                      class="rounded-xl px-4 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700">
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
              </button>
            </div>
          </div>
        </div>
<!-- HERO SERVICE -->
        <div class="glass-card border border-sky-100 rounded-[2rem] px-4 py-4 md:px-6 md:py-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4 shadow-md">
          <div class="flex items-start gap-3">
            <div id="orderServiceIcon"
                 class="w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-gradient-to-br from-sky-500 to-cyan-500 flex items-center justify-center text-3xl text-white shadow-md">
              üß∫
            </div>
            <div>
              <h2 id="orderServiceName" class="text-xl font-semibold text-slate-900 mb-1">‡∏ã‡∏±‡∏Å-‡∏û‡∏±‡∏ö</h2>
              <p id="orderServiceDesc" class="text-sm text-slate-600 leading-relaxed">
                ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å-‡∏û‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡∏ã‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏ú‡πâ‡∏≤‡∏•‡∏≥‡∏•‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏ú‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
              </p>
              <span class="inline-flex items-center gap-1 mt-1 text-[11px] text-slate-400">
                ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏•‡∏≠‡∏á: ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏î‡πâ
              </span>
            </div>
          </div>
          <div class="text-right text-sm">
            <p class="text-slate-500 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πà‡∏≠ 1 ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
            <p class="text-2xl font-semibold text-sky-700">
              ‡∏ø<span id="orderBasePrice">0</span>
              <span id="orderUnitLabel" class="text-xs text-slate-500">/‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
            </p>
            <p class="text-[11px] text-slate-400 mt-1">
              * ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‚Äì ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
            </p>
          </div>
        </div>

        <!-- ORDER FORM -->
        <form id="serviceOrderForm"
              class="glass-card rounded-[2rem] shadow-md border border-sky-100 p-5 space-y-5">
          <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô + ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
          <div class="grid md:grid-cols-[minmax(0,2fr)_minmax(0,3fr)] gap-4">
            <div>
              <label class="block text-sm text-slate-700 mb-1.5">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
              </label>
              <div class="flex items-center gap-2">
                <button type="button"
                        id="btnQtyMinus"
                        class="w-9 h-9 rounded-full border border-slate-200 flex items-center justify-center text-lg text-slate-600 hover:bg-slate-50">
                  ‚àí
                </button>
                <input id="orderQty" name="orderQty" type="number" min="1" value="1"
                       class="w-20 text-center border rounded-xl px-2 py-2.5 text-sm bg-slate-50/90 focus:outline-none focus:ring-2 focus:ring-sky-400"
                       required>
                <button type="button"
                        id="btnQtyPlus"
                        class="w-9 h-9 rounded-full border border-slate-200 flex items-center justify-center text-lg text-slate-600 hover:bg-slate-50">
                  +
                </button>
                <span id="orderQtyUnitLabel" class="text-xs text-slate-500"></span>
              </div>
            </div>
            <div>
              <label class="block text-sm text-slate-700 mb-1.5">
                ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ñ‡∏∂‡∏á‡∏£‡πâ‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
              </label>
              <textarea id="orderNote"
                        class="w-full border rounded-xl px-3.5 py-2.5 text-sm bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400 leading-relaxed"
                        rows="2"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡∏≤‡∏ß, ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡∏°‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥, ‡∏°‡∏µ‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏° 1 ‡∏ú‡∏∑‡∏ô ‡∏Ø‡∏•‡∏Ø"></textarea>
            </div>
          </div>

          <!-- ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏Å -->
          <div>
            <p class="text-sm font-semibold text-slate-800 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏Å</p>
            <p class="text-xs text-slate-500 mb-3">
              ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </p>
            <div id="orderAddonPrimary" class="space-y-2"></div>
          </div>

          <!-- ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
          <div>
            <p class="text-sm font-semibold text-slate-800 mb-2">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
            <p class="text-xs text-slate-500 mb-3">
              ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏î‡∏•‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏±‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠, ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≥, ‡∏î‡∏π‡πÅ‡∏•‡πÑ‡∏£‡∏ù‡∏∏‡πà‡∏ô ‚Äì ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            </p>
            <div id="orderAddonExtra" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-2.5"></div>
          </div>

          <!-- ‡πÄ‡∏ß‡∏•‡∏≤ + ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á + ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤ -->
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-slate-700 mb-1.5">
                ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
              </label>
              <input type="datetime-local" id="orderPickupTime" name="orderPickupTime"
                     class="w-full border rounded-xl px-3.5 py-2.5 text-sm bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400">
              <!-- ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) -->
              <div class="mt-3 rounded-2xl border border-slate-200 bg-white/70 p-3">
                <div class="flex items-start justify-between gap-2">
                  <div>
                    <p class="text-sm font-semibold text-slate-800">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥</p>
                    <p class="text-[11px] text-slate-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</p>
                  </div>
                  <button type="button" id="refreshFavoriteBtn"
                          class="rounded-xl px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700">
                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                  </button>
                </div>

                <div class="mt-2 grid md:grid-cols-2 gap-2">
                  <select id="favoriteAddressSelect"
                          class="w-full border rounded-xl px-3.5 py-2.5 bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>
                  </select>
                  <div class="grid grid-cols-2 gap-2">
                    <select id="saveAddressLabel"
                            class="w-full border rounded-xl px-3.5 py-2.5 bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400">
                      <option value="‡∏ö‡πâ‡∏≤‡∏ô">‡∏ö‡πâ‡∏≤‡∏ô</option>
                      <option value="‡∏´‡∏≠" selected>‡∏´‡∏≠</option>
                      <option value="‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î">‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î</option>
                      <option value="‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô">‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</option>
                      <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                    <input id="saveAddressName"
                           class="w-full border rounded-xl px-3.5 py-2.5 bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400"
                           placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á 501">
                  </div>
                </div>

                <div class="mt-2 flex items-center justify-between gap-2">
                  <label class="inline-flex items-center gap-2 text-xs text-slate-600">
                    <input type="checkbox" id="saveAddressDefault"
                           class="w-4 h-4 rounded border-slate-300 text-sky-600 focus:ring-sky-400">
                    ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                  </label>
                  <button type="button" id="btnSaveAddress"
                          class="rounded-xl px-4 py-2 text-xs font-semibold bg-sky-600 hover:bg-sky-700 text-white shadow-sm">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î)
                  </button>
                </div>
              </div>


              <!-- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ / ‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤ -->
              <div class="mt-3">
                <label class="block text-sm text-slate-700 mb-1.5">
                  ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ / ‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤ (‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà)
                </label>

                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                  <div class="text-xs text-slate-500">
                    <p id="pickupPreview">
                      ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î)
                    </p>
                    <input type="hidden" id="pickupLat" name="pickupLat">
                    <input type="hidden" id="pickupLng" name="pickupLng">
                  </div>
                  <button type="button"
                          id="btnOpenMap"
                          class="inline-flex items-center gap-1 px-3 py-2 rounded-xl border border-sky-200 text-xs text-sky-700 bg-sky-50 hover:bg-sky-100">
                    üó∫Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î
                  </button>
                </div>

                <div id="mapWrapper" class="hidden mt-3">
                  <div id="laundryMap" class="w-full h-64 rounded-2xl border border-slate-200"></div>
                </div>
              </div>
            </div>

            <div>
              <p class="block text-sm text-slate-700 mb-1.5">
                ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
              </p>
              <div class="mt-2 rounded-2xl border border-amber-100 bg-amber-50/60 px-3.5 py-2.5">
                <p class="text-[11px] text-amber-700 font-semibold">‚≠ê ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                <div class="flex items-center justify-between mt-1">
                  <span class="text-xs text-slate-600">‡πÅ‡∏ï‡πâ‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
                  <span class="text-xs font-semibold text-slate-900"><span id="pointsCurrent">0</span> ‡πÅ‡∏ï‡πâ‡∏°</span>
                </div>
                <div class="mt-2">
                  <div class="flex items-center justify-between text-[11px] text-slate-500">
                    <span>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</span>
                    <span><span id="pointsGoalLabel" class="font-semibold text-slate-700">100</span> ‡πÅ‡∏ï‡πâ‡∏°</span>
                  </div>
                  <div class="mt-1 h-2 rounded-full bg-amber-100 overflow-hidden">
                    <div id="pointsProgressBar" class="h-full bg-amber-500" style="width:0%"></div>
                  </div>
                  <p id="pointsProgressHint" class="text-[11px] text-amber-700 mt-1">‡∏≠‡∏µ‡∏Å 100 ‡πÅ‡∏ï‡πâ‡∏° ‡∏à‡∏∞‡πÅ‡∏•‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î ‡∏ø10 ‡πÑ‡∏î‡πâ</p>
                </div>
                <div class="flex items-center justify-between mt-1">
                  <span class="text-xs text-slate-600">‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</span>
                  <span class="text-xs font-semibold text-slate-900"><span id="pointsAfter">0</span> ‡πÅ‡∏ï‡πâ‡∏°</span>
                </div>
                <p class="text-[11px] text-slate-500 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πâ‡∏°‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</p>
              </div>

              <div class="bg-sky-50 border border-sky-100 rounded-2xl px-3.5 py-2.5 flex items-center justify-between">
                <div class="text-xs text-slate-600">
                  <p>‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô + ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ √ó ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
                  <p class="text-[11px] text-slate-400 mt-0.5">
                    ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‚Äì ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏π‡∏ï‡∏£‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
                  </p>
                </div>
                <div class="text-right">
                  <p class="text-xs text-slate-500">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</p>
                  <p class="text-lg font-semibold text-sky-700">
                    ‡∏ø<span id="orderTotalPrice">0</span>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 pt-3 border-t border-slate-100 mt-1">
            <p class="text-xs text-slate-500">
              ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î ‚Äú‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‚Äù ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á
              <span class="font-semibold text-sky-700">orders</span> ‡πÉ‡∏ô Supabase
              ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á <span class="font-semibold">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏•‡∏≠‡∏á</span>
            </p>
            <button type="submit"
                    class="inline-flex justify-center px-5 py-2.5 rounded-xl bg-gradient-to-r from-sky-500 to-cyan-500 text-white text-sm font-semibold hover:from-sky-600 hover:to-cyan-600 shadow-md">
              ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ ‚Äì ‡∏ø<span id="orderTotalPriceBottom">0</span>
            </button>
          </div>
        </form>
      </section>

    </div>
  </main>
</div>

<!-- PAYMENT OVERLAY: ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢ (‡πÄ‡∏î‡πÇ‡∏°‡πà) -->
<section id="view-payment"
         class="hidden fixed inset-0 z-50 bg-slate-900/70 flex items-center justify-center px-4">
  <div class="bg-white rounded-[2rem] shadow-[0_22px_70px_rgba(15,23,42,0.9)] max-w-md w-full p-5 space-y-4">
    <div class="flex items-start justify-between gap-2">
      <div>
        <h2 class="text-lg font-semibold text-slate-900 flex items-center gap-2">
          <span class="text-2xl">üí≥</span>
          <span>‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡πÄ‡∏î‡πÇ‡∏°‡πà)</span>
        </h2>
        <p class="text-xs text-slate-500 mt-1">
          ‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£/PromptPay (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î ‚Äú‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </p>
      </div>
      <button id="paymentCloseBtn" type="button"
              class="text-slate-400 hover:text-slate-600 text-lg leading-none" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">
        ‚úï
      </button>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3 space-y-1 text-xs text-slate-600">
      <p>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: <span class="font-semibold text-slate-900" id="payServiceName">-</span></p>
      <p>‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå: <span class="font-mono text-slate-900" id="payOrderId">-</span></p>
      <p>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì):
        <span class="font-semibold text-sky-700 text-base">‡∏ø<span id="payAmount">0</span></span>
      </p>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-slate-50 flex flex-col items-center justify-center p-4 space-y-2">
      <div class="w-40 h-40 rounded-2xl bg-white border border-slate-200 flex items-center justify-center overflow-hidden">
        <!-- ‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á QR -->
        <img src="tooy.jpg" alt="PromptPay QR (Demo)" class="w-full h-full object-contain">
      </div>
      <div class="text-[11px] text-slate-500 text-center">
        ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á): <span class="font-semibold">LaundryGo Demo</span><br>
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á): <span class="font-mono">08X-XXX-XXXX</span>
      </div>
    </div>

    <!-- ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏î‡πÇ‡∏°‡πà) -->
    <div class="space-y-2 text-xs text-slate-600">
      <div>
        <label for="paymentSlipInput" class="block font-semibold text-slate-800 mb-1">
          ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
        </label>
        <input id="paymentSlipInput" type="file" accept="image/*"
               class="block w-full text-xs text-slate-600
                      file:mr-2 file:py-1.5 file:px-3
                      file:rounded-full file:border-0
                      file:text-xs file:font-semibold
                      file:bg-sky-50 file:text-sky-700
                      hover:file:bg-sky-100">
        <p class="mt-1 text-[11px] text-slate-400">
          ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà Supabase Storage (bucket: <span class="font-mono">too</span>)
          ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á <span class="font-mono">orders.payment_slip_url</span> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ
        </p>
      </div>
      <div id="paymentSlipPreview" class="hidden mt-1 rounded-xl border border-slate-200 overflow-hidden w-32 h-32 bg-slate-50">
        <img id="paymentSlipPreviewImg" src="" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö" class="w-full h-full object-cover">
      </div>
    </div>

    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 pt-1">
      <button id="paymentLaterBtn" type="button"
              class="w-full sm:w-auto px-4 py-2 rounded-xl border border-slate-200 text-xs text-slate-600 bg-slate-50 hover:bg-slate-100">
        ‡∏à‡∏∞‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á / ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
      </button>
      <button id="paymentConfirmBtn" type="button"
              class="w-full sm:w-auto px-4 py-2 rounded-xl bg-gradient-to-r from-emerald-500 to-lime-500 text-white text-xs font-semibold hover:from-emerald-600 hover:to-lime-600 shadow-sm">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏î‡πÇ‡∏°‡πà)
      </button>
    </div>

    <p class="text-[10px] text-slate-400 text-center">
      * ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏î‡πÇ‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Payment Gateway ‡∏à‡∏£‡∏¥‡∏á ‚Äì
      ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå Flow ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    </p>
  </div>
</section>

<!-- CONTACT OVERLAY (‡πÉ‡∏´‡∏°‡πà) -->
<section id="view-contact"
         class="hidden fixed inset-0 z-40 bg-slate-900/60 flex items-center justify-center px-4">
  <div class="bg-white rounded-3xl shadow-[0_18px_60px_rgba(15,23,42,0.8)] max-w-sm w-full p-5 space-y-4">
    <div class="flex items-start justify-between gap-2">
      <div>
        <h2 class="text-lg font-semibold text-slate-900 flex items-center gap-2">
          <span class="text-xl">üí¨</span>
          <span>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô / ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</span>
        </h2>
        <p class="text-xs text-slate-500 mt-1">
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ
        </p>
      </div>
      <button id="contactCloseBtn" type="button"
              class="text-slate-400 hover:text-slate-600 text-lg leading-none" aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô">
        ‚úï
      </button>
    </div>
    <div class="space-y-3 text-xs text-slate-700">
      <button type="button"
              class="w-full flex items-center justify-between px-3.5 py-2.5 rounded-2xl border border-emerald-100 bg-emerald-50 hover:bg-emerald-100">
        <span class="inline-flex items-center gap-2">
          <span class="text-lg">üü¢</span>
          <span class="font-semibold">‡πÅ‡∏ä‡∏ï LINE ‡∏£‡πâ‡∏≤‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</span>
        </span>
        <span class="font-mono text-[11px] text-emerald-700">@laundrygo_demo</span>
      </button>
      <button type="button"
              class="w-full flex items-center justify-between px-3.5 py-2.5 rounded-2xl border border-sky-100 bg-sky-50 hover:bg-sky-100">
        <span class="inline-flex items-center gap-2">
          <span class="text-lg">üìû</span>
          <span class="font-semibold">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏£‡πâ‡∏≤‡∏ô</span>
        </span>
        <span class="font-mono text-[11px] text-sky-700">08X-XXX-XXXX</span>
      </button>
      <div class="rounded-2xl border border-slate-100 bg-slate-50 px-3.5 py-3">
        <p class="text-[11px] font-semibold text-slate-800 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)</p>
        <p class="text-[11px] text-slate-600">
          ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‚Äì‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå 09.00‚Äì21.00 ‡∏ô.<br>
          ‡∏ï‡∏±‡∏î‡∏£‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ 19.00 ‡∏ô. (‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Floating chat button (‡πÉ‡∏´‡∏°‡πà) -->
<button id="floatingChatBtn"
        class="fixed bottom-4 right-4 z-30 floating-chat inline-flex items-center gap-2 px-3.5 py-2.5 rounded-full bg-gradient-to-r from-sky-500 to-cyan-500 text-white text-xs font-semibold shadow-[0_15px_40px_rgba(8,47,73,0.7)] hover:from-sky-600 hover:to-cyan-600">
  <span class="w-6 h-6 rounded-full bg-white/20 flex items-center justify-center text-lg">üí¨</span>
  <span class="hidden sm:inline">‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô / ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ</span>
  <span class="sm:hidden">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</span>
</button>

<!-- Toast Container (‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô alert ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) -->
<div id="toastContainer" class="fixed top-4 inset-x-0 flex flex-col items-center gap-2 z-50 pointer-events-none"></div>


  <!-- Overlay: ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏•‡∏¥‡∏õ -->
  <section
    id="viewAdminSlip"
    class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/70 backdrop-blur-sm"
  >
    <div class="w-full max-w-md rounded-2xl bg-white shadow-2xl border border-slate-200 overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 border-b border-slate-100 bg-slate-50/80">
        <div class="flex flex-col">
          <h3 class="text-sm font-semibold text-slate-800">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h3>
          <p class="text-[11px] text-slate-500">
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡πÇ‡∏°‡πà (‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)
          </p>
        </div>
        <button
          id="adminSlipCloseBtn"
          class="inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-500 hover:bg-slate-100 text-xs"
         aria-label="‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏•‡∏¥‡∏õ">
          ‚úï
        </button>
      </div>

      <div class="px-4 py-3 space-y-3 text-sm">
        <div class="grid grid-cols-[90px,1fr] gap-2 items-start">
          <span class="text-xs font-medium text-slate-500">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
          <span id="adminSlipOrderId" class="font-mono text-xs text-slate-800">-</span>

          <span class="text-xs font-medium text-slate-500">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
          <span id="adminSlipCustomer" class="text-xs text-slate-800">-</span>

          <span class="text-xs font-medium text-slate-500">‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô</span>
          <span id="adminSlipAmount" class="text-xs text-emerald-700 font-semibold">-</span>

          <span class="text-xs font-medium text-slate-500">‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</span>
          <span id="adminSlipRef" class="text-xs text-slate-800">-</span>

          <span class="text-xs font-medium text-slate-500">‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ</span>
          <span id="adminSlipFile" class="text-xs text-slate-800 break-all">-</span>

          <span class="text-xs font-medium text-slate-500">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠</span>
          <span id="adminSlipUploadedAt" class="text-xs text-slate-800">-</span>
        </div>

        <div class="mt-1 rounded-lg border border-amber-100 bg-amber-50/80 px-3 py-2">
          <p class="text-[11px] leading-snug text-amber-700">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡πÇ‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ã‡∏±‡∏Å‡∏≠‡∏ö‡∏£‡∏µ‡∏î‡∏à‡∏£‡∏¥‡∏á
            ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô, ‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á, ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)
            ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô LocalStorage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ
          </p>
        </div>
      </div>
    </div>
  </section>


  
      <!-- MODAL: ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
      <div id="notifModal" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="absolute inset-0 flex items-end md:items-center justify-center p-3">
          <div class="w-full max-w-xl rounded-[2rem] bg-white shadow-2xl border border-slate-200 overflow-hidden">
            <div class="p-4 md:p-5 border-b border-slate-100 flex items-start justify-between gap-3">
              <div>
                <p class="text-xs text-slate-500">‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                <h3 class="text-lg font-semibold text-slate-900 mt-0.5">üîî ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
                <p id="notifHint" class="text-[11px] text-slate-500 mt-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</p>
              </div>
              <div class="flex items-center gap-2">
                <button type="button" id="btnClearNotif"
                        class="rounded-xl px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 text-slate-700">
                  ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button type="button" id="btnCloseNotif"
                        class="rounded-xl px-3 py-2 text-xs font-semibold bg-white border border-slate-200 hover:bg-slate-50 text-slate-700">
                  ‡∏õ‡∏¥‡∏î
                </button>
              </div>
            </div>
            <div class="p-4 md:p-5">
              <div id="notifList" class="space-y-2 text-sm text-slate-700"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL: Address Book -->
      <div id="addressBookModal" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="absolute inset-0 flex items-end md:items-center justify-center p-3">
          <div class="w-full max-w-xl rounded-[2rem] bg-white shadow-2xl border border-slate-200 overflow-hidden">
            <div class="p-4 md:p-5 border-b border-slate-100 flex items-start justify-between gap-3">
              <div>
                <p class="text-xs text-slate-500">Address Book</p>
                <h3 class="text-lg font-semibold text-slate-900 mt-0.5">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
                <p class="text-[11px] text-slate-500 mt-1">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô / ‡∏•‡∏ö / ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ</p>
              </div>
              <button type="button" id="btnCloseAddressBook"
                      class="rounded-xl px-3 py-2 text-xs font-semibold bg-white border border-slate-200 hover:bg-slate-50 text-slate-700">
                ‡∏õ‡∏¥‡∏î
              </button>
            </div>
            <div class="p-4 md:p-5">
              <div id="addressBookList" class="space-y-2 text-sm text-slate-700"></div>
              <div class="mt-3 rounded-2xl border border-slate-200 bg-slate-50/60 p-3">
                <p class="text-xs text-slate-600 font-semibold">‡∏ó‡∏¥‡∏õ</p>
                <p class="text-[11px] text-slate-500 mt-1">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‚Äù ‡πÇ‡∏î‡∏¢‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‚Äù.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï -->
      <div id="presetsModal" class="hidden fixed inset-0 z-50">
        <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
        <div class="absolute inset-0 flex items-end md:items-center justify-center p-3">
          <div class="w-full max-w-xl rounded-[2rem] bg-white shadow-2xl border border-slate-200 overflow-hidden">
            <div class="p-4 md:p-5 border-b border-slate-100 flex items-start justify-between gap-3">
              <div>
                <p class="text-xs text-slate-500">Presets</p>
                <h3 class="text-lg font-semibold text-slate-900 mt-0.5">‚ú® ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</h3>
                <p class="text-[11px] text-slate-500 mt-1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∏‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
              </div>
              <button type="button" id="btnClosePresets"
                      class="rounded-xl px-3 py-2 text-xs font-semibold bg-white border border-slate-200 hover:bg-slate-50 text-slate-700">
                ‡∏õ‡∏¥‡∏î
              </button>
            </div>
            <div class="p-4 md:p-5">
              <div class="flex flex-col sm:flex-row gap-2 sm:items-center mb-3">
                <input id="presetNameInput"
                       class="w-full border rounded-xl px-3.5 py-2 text-xs bg-slate-50/80 focus:outline-none focus:ring-2 focus:ring-sky-400"
                       placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)">
                <button type="button" id="btnCreatePresetFromCurrent"
                        class="rounded-xl px-4 py-2 text-xs font-semibold bg-sky-600 hover:bg-sky-700 text-white shadow-sm">
                  ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                </button>
              </div>
              <div id="presetsList" class="space-y-2 text-sm text-slate-700"></div>
            </div>
          </div>
        </div>
      </div>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>


<script>
// -------- CONFIG: ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á ‡πÜ + ETA ----------
  const DEFAULT_SERVICES = [
    {
      id: 'wash_fold',
      title: '‡∏ã‡∏±‡∏Å-‡∏û‡∏±‡∏ö',
      icon: 'üß∫',
      cardBg: 'bg-gradient-to-br from-sky-400 to-sky-600',
      basePrice: 129,
      unitLabel: '‡∏ñ‡∏∏‡∏á',
      qtyLabel: '‡∏ñ‡∏∏‡∏á‡∏ã‡∏±‡∏Å-‡∏û‡∏±‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô',
      shortDesc: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡∏ã‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î ‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡πå ‡∏ú‡πâ‡∏≤‡∏Ç‡∏ô‡∏´‡∏ô‡∏π ‡∏Ø‡∏•‡∏Ø',
      heroDesc: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å-‡∏≠‡∏ö-‡∏û‡∏±‡∏ö ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡πÄ‡∏£‡∏≤‡∏ã‡∏±‡∏Å ‡∏≠‡∏ö ‡∏û‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡πÉ‡∏™‡πà‡∏ñ‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
      etaHours: { min: 24, max: 36 }, // ETA 24‚Äì36 ‡∏ä‡∏°.
      primaryAddons: [
        { id: 'iron',  name: '‡∏£‡∏µ‡∏î‡∏ú‡πâ‡∏≤',          desc: '‡∏£‡∏µ‡∏î‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏Ç‡∏ß‡∏ô/‡∏û‡∏±‡∏ö‡∏™‡∏ß‡∏¢', price: 39, icon: 'üß¥' },
        { id: 'hang',  name: '‡πÅ‡∏Ç‡∏ß‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©',      desc: '‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ñ‡∏∏‡∏á',     price: 29, icon: 'üß•' }
      ],
      extraAddons: [
        { id: 'disinfect', name: '‡∏ã‡∏±‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠',   desc: '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô/‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞‡∏ö‡πà‡∏≠‡∏¢', price: 69, icon: 'ü¶†' },
        { id: 'sport',     name: '‡∏î‡∏π‡πÅ‡∏•‡∏ä‡∏∏‡∏î‡∏Å‡∏µ‡∏¨‡∏≤',       desc: '‡∏•‡∏î‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏≠‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏≤‡∏ö‡πÄ‡∏´‡∏á‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ä‡∏∏‡∏î‡∏Å‡∏µ‡∏¨‡∏≤',         price: 59, icon: '‚öΩ' }
      ]
    },
    {
      id: 'shoes',
      title: '‡∏ã‡∏±‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤',
      icon: 'üëü',
      cardBg: 'bg-gradient-to-br from-rose-400 to-pink-500',
      basePrice: 249,
      unitLabel: '‡∏Ñ‡∏π‡πà',
      qtyLabel: '‡∏Ñ‡∏π‡πà‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤',
      shortDesc: '‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ú‡πâ‡∏≤‡πÉ‡∏ö ‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏Å‡∏µ‡∏¨‡∏≤ ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏°',
      heroDesc: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤ ‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏≤‡∏ö‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏≠‡∏±‡∏ö',
      etaHours: { min: 24, max: 48 },
      primaryAddons: [
        { id: 'deep_clean', name: '‡∏Ç‡∏±‡∏î‡∏•‡∏∂‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©',   desc: '‡∏Ç‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏≠‡∏≤‡∏î', price: 69, icon: 'üßΩ' }
      ],
      extraAddons: [
        { id: 'waterproof', name: '‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≥',   desc: '‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏ú‡∏¥‡∏ß‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ö‡∏≤‡∏á ‡πÜ ‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≥/‡∏Ñ‡∏£‡∏≤‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢', price: 89, icon: 'üíß' }
      ]
    },
    {
      id: 'iron_only',
      title: '‡∏£‡∏µ‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô',
      icon: 'üß∫',
      cardBg: 'bg-gradient-to-br from-emerald-400 to-teal-500',
      basePrice: 25,
      unitLabel: '‡∏ä‡∏¥‡πâ‡∏ô',
      qtyLabel: '‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏î',
      shortDesc: '‡∏£‡∏µ‡∏î‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡∏¥‡πâ‡∏ï ‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏™‡πÅ‡∏•‡∏Ñ ‡πÅ‡∏•‡∏∞‡∏ä‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',
      heroDesc: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏Å‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏µ‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏™‡πà',
      etaHours: { min: 12, max: 24 },
      primaryAddons: [
        { id: 'hanger_iron', name: '‡πÉ‡∏™‡πà‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡∏¥‡πâ‡∏ô', desc: '‡∏£‡∏µ‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏Ç‡∏ß‡∏ô‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß', price: 29, icon: 'üëî' }
      ],
      extraAddons: [
        { id: 'starch', name: '‡∏£‡∏µ‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏£‡∏á', desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏£‡∏µ‡∏î‡∏ú‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏£‡∏á', price: 39, icon: 'üß¥' }
      ]
    },
    {
      id: 'bedding',
      title: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏≠‡∏ô & ‡∏ö‡πâ‡∏≤‡∏ô',
      icon: 'üõèÔ∏è',
      cardBg: 'bg-gradient-to-br from-amber-400 to-orange-500',
      basePrice: 485,
      unitLabel: '‡∏ä‡∏∏‡∏î',
      qtyLabel: '‡∏ä‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏≠‡∏ô (‡∏ú‡πâ‡∏≤‡∏õ‡∏π + ‡∏õ‡∏•‡∏≠‡∏Å‡∏´‡∏°‡∏≠‡∏ô ‡∏Ø‡∏•‡∏Ø)',
      shortDesc: '‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏° ‡∏ú‡πâ‡∏≤‡∏õ‡∏π ‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏Å‡∏´‡∏°‡∏≠‡∏ô',
      heroDesc: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å-‡∏≠‡∏ö-‡∏û‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏≠‡∏ô ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏≠‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î ‡∏î‡∏π‡πÅ‡∏•‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏° ‡∏ú‡πâ‡∏≤‡∏õ‡∏π ‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≠‡∏Å‡∏´‡∏°‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏≠‡∏°‡∏ü‡∏π‡∏ô‡∏∏‡πà‡∏°‡∏™‡∏ö‡∏≤‡∏¢',
      etaHours: { min: 36, max: 48 },
      primaryAddons: [
        { id: 'extra_soft', name: '‡∏ã‡∏±‡∏Å‡∏ô‡∏∏‡πà‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©', desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡∏ô‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏≠‡∏ô', price: 49, icon: '‚òÅÔ∏è' },
        { id: 'mites',      name: '‡∏î‡∏π‡πÅ‡∏•‡πÑ‡∏£‡∏ù‡∏∏‡πà‡∏ô',  desc: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡πÑ‡∏£‡∏ù‡∏∏‡πà‡∏ô‡∏ö‡∏ô‡∏´‡∏°‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°', price: 89, icon: 'üï∑Ô∏è' }
      ],
      extraAddons: [
        { id: 'disinfect_b', name: '‡∏ã‡∏±‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠', desc: '‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏', price: 129, icon: 'ü¶†' },
        { id: 'sun',         name: '‡∏≠‡∏ö‡πÅ‡∏î‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°',     desc: '‡∏≠‡∏ö‡πÅ‡∏î‡∏î‡∏ï‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏ú‡πâ‡∏≤‡∏ô‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏î', price: 69, icon: 'üå§Ô∏è' },
        { id: 'duvet',       name: '‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏°/‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà', desc: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©', price: 99, icon: 'üß£' }
      ]
    }
  ];


const SERVICES_STORAGE_KEY = 'laundrygo_services_catalog_v1';

function cloneDeep(obj) {
  try { return JSON.parse(JSON.stringify(obj)); } catch (_) { return obj; }
}

function normalizeService(s) {
  if (!s || typeof s !== 'object') return null;
  const id = String(s.id || '').trim();
  const title = String(s.title || '').trim();
  if (!id || !title) return null;

  const basePrice = Number(s.basePrice ?? 0);
  const etaMin = Number((s.etaHours && s.etaHours.min) ?? s.etaMin ?? 24);
  const etaMax = Number((s.etaHours && s.etaHours.max) ?? s.etaMax ?? 36);

  const service = {
    id,
    title,
    icon: String(s.icon || 'üß∫'),
    cardBg: String(s.cardBg || 'bg-gradient-to-br from-sky-400 to-sky-600'),
    basePrice: Number.isFinite(basePrice) ? Math.max(0, Math.round(basePrice)) : 0,
    unitLabel: String(s.unitLabel || '‡∏´‡∏ô‡πà‡∏ß‡∏¢'),
    qtyLabel: String(s.qtyLabel || ''),
    shortDesc: String(s.shortDesc || ''),
    heroDesc: String(s.heroDesc || s.shortDesc || ''),
    etaHours: {
      min: Number.isFinite(etaMin) ? Math.max(1, Math.round(etaMin)) : 24,
      max: Number.isFinite(etaMax) ? Math.max(Math.round(etaMax), Math.round(etaMin) || 24) : 36
    },
    primaryAddons: Array.isArray(s.primaryAddons) ? s.primaryAddons : [],
    extraAddons: Array.isArray(s.extraAddons) ? s.extraAddons : [],
    active: (s.active === false) ? false : true
  };

  return service;
}

function loadServicesCatalog() {
  try {
    const raw = localStorage.getItem(SERVICES_STORAGE_KEY);
    if (!raw) return cloneDeep(DEFAULT_SERVICES);

    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed)) return cloneDeep(DEFAULT_SERVICES);

    const normalized = parsed.map(normalizeService).filter(Boolean);
    return normalized.length ? normalized : cloneDeep(DEFAULT_SERVICES);
  } catch (_) {
    return cloneDeep(DEFAULT_SERVICES);
  }
}

function saveServicesCatalog(list) {
  try { localStorage.setItem(SERVICES_STORAGE_KEY, JSON.stringify(list)); } catch (_) {}
}

function getVisibleServices() {
  return SERVICES.filter(s => s && s.active !== false);
}

function rerenderServicesEverywhere() {
  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‚Äù
  try { renderServiceCards(); } catch (_) {}
  try { renderOrderTabs(); } catch (_) {}

  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏π
  try {
    const viewOrderEl = document.getElementById('view-order');
    if (viewOrderEl && !viewOrderEl.classList.contains('hidden')) {
      const s = getServiceById(currentServiceId) || getVisibleServices()[0];
      if (s) setupOrderView(s);
    }
  } catch (_) {}
}

function resetServicesCatalog() {
  SERVICES = cloneDeep(DEFAULT_SERVICES);
  saveServicesCatalog(SERVICES);
  rerenderServicesEverywhere();
  try { showToast('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ‚Äú‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£/‡∏£‡∏≤‡∏Ñ‡∏≤‚Äù ‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success'); } catch (_) {}
}

let SERVICES = loadServicesCatalog();

  const SUPABASE_URL = 'https://mrwyoilxnkjubaszjdoo.supabase.co';
  const SUPABASE_ANON_KEY =
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1yd3lvaWx4bmtqdWJhc3pqZG9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NDg3MjgsImV4cCI6MjA3OTUyNDcyOH0.E-UKuNBljtScCuh7sSJ_MYl9bloSOHFQvfq2drGOhO8';

  const { createClient } = supabase;
  const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // GOOGLE MAPS
  let laundryMap = null;
  let laundryMarker = null;

  function initLaundryMap() {
    const mapEl = document.getElementById('laundryMap');
    if (!mapEl) return;

    const initial = { lat: 14.9799, lng: 102.0977 }; // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

    laundryMap = new google.maps.Map(mapEl, {
      center: initial,
      zoom: 15,
    });

    laundryMap.addListener('click', (e) => {
      const pos = e.latLng;

      if (!laundryMarker) {
        laundryMarker = new google.maps.Marker({
          position: pos,
          map: laundryMap,
        });
      } else {
        laundryMarker.setPosition(pos);
      }

      const lat = pos.lat();
      const lng = pos.lng();

      const latInput = document.getElementById('pickupLat');
      const lngInput = document.getElementById('pickupLng');
      const previewEl = document.getElementById('pickupPreview');

      if (latInput && lngInput) {
        latInput.value = lat;
        lngInput.value = lng;
      }
      if (previewEl) {
        previewEl.textContent = `‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${lat.toFixed(5)}, ${lng.toFixed(5)}`;
      }
    });
  }

  const ORDER_STATUSES = [
    '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤',
    '‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß',
    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏±‡∏Å',
    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏ö',
    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏ö',
    '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á',
    '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
    '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
  ];

  const PAYMENT_STATUSES = [
    '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞',
    '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',
    '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß'
  ];

  // Info ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
  let adminDailySummaryData = null;
  let adminSummarySelectedDateKey = null;

  // Favorite addresses
  let favoriteAddresses = [];

  // ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  let lastOrderPointsEarn = 0;
  let lastOrderPointsUsed = 0;
  let lastOrderRedeemMode = 'none';

  // Chart.js instances
  let revenueChart = null;
  let serviceChart = null;
  let pendingSlipFile = null;


  // ---------------------------
  // ---------------------------
  // Login skin (locked: Glass Split)
  // ---------------------------
  function applyLoginSkin() {
    const viewLogin = document.getElementById('view-login');
    if (!viewLogin) return;
    // Always use Glass Split (skin-a)
    viewLogin.classList.remove('skin-a', 'skin-b', 'skin-c');
    viewLogin.classList.add('skin-a');
  }

  // Keep compatibility in case any old code still calls setLoginSkin()
  function setLoginSkin(_) {
    applyLoginSkin();
  }
  window.setLoginSkin = setLoginSkin;

  document.addEventListener('DOMContentLoaded', async () => {
    applyLoginSkin();

    // Views
    const viewLogin = document.getElementById('view-login');
    const viewRegister = document.getElementById('view-register');
    const viewServices = document.getElementById('view-services');
    const viewOrder = document.getElementById('view-order');
    const viewAdminLogin = document.getElementById('view-admin-login');
    const viewAdminDashboard = document.getElementById('view-admin-dashboard');
    const viewPayment = document.getElementById('view-payment');

    // Navbar buttons
    const navLoginBtn = document.getElementById('navLoginBtn');
    const navRegisterBtn = document.getElementById('navRegisterBtn');
    const navAdminBtn = document.getElementById('navAdminBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    // ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ forms
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginUsernameInput = document.getElementById('loginUsername');
    const loginPasswordInput = document.getElementById('loginPassword');

    // UI helpers
    const loginSubmitBtn = document.getElementById('loginSubmitBtn');
    const loginCard = document.getElementById('loginCard');
    const toastContainer = document.getElementById('toastContainer');

    function showToast(message, type = 'info', opts = {}) {
      const container = toastContainer;
      if (!container) return;

      const duration = typeof opts.duration === 'number' ? opts.duration : 2800;

      const palette = {
        success: { ring: 'ring-emerald-200', border: 'border-emerald-200/70', bg: 'bg-white/90', iconBg: 'bg-emerald-100', icon: '‚úÖ', text: 'text-emerald-800' },
        error:   { ring: 'ring-rose-200',    border: 'border-rose-200/70',    bg: 'bg-white/90', iconBg: 'bg-rose-100',    icon: '‚ö†Ô∏è', text: 'text-rose-800' },
        info:    { ring: 'ring-sky-200',     border: 'border-sky-200/70',     bg: 'bg-white/90', iconBg: 'bg-sky-100',     icon: '‚ÑπÔ∏è', text: 'text-slate-800' },
      };
      const p = palette[type] || palette.info;

      const toast = document.createElement('div');
      toast.className = `lg-toast pointer-events-auto w-[min(520px,calc(100vw-2rem))] ${p.bg} ${p.border} ${p.ring} ring-1 shadow-xl rounded-2xl px-4 py-3`;
      toast.setAttribute('role', 'status');
      toast.innerHTML = `
        <div class="flex items-start gap-3">
          <div class="mt-0.5 h-9 w-9 rounded-xl ${p.iconBg} flex items-center justify-center text-base">
            ${p.icon}
          </div>
          <div class="flex-1">
            <div class="text-sm font-semibold ${p.text} leading-5">${escapeHtml(message)}</div>
            ${opts.subtitle ? `<div class="mt-0.5 text-xs text-slate-500">${escapeHtml(opts.subtitle)}</div>` : ''}
          </div>
          <button type="button" class="ml-1 text-slate-400 hover:text-slate-600 rounded-lg p-1" aria-label="‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M6 6L18 18M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      `;

      const closeBtn = toast.querySelector('button');
      const remove = () => {
        toast.classList.add('leaving');
        setTimeout(() => toast.remove(), 180);
      };
      if (closeBtn) closeBtn.addEventListener('click', remove);

      container.appendChild(toast);
      setTimeout(remove, duration);
    }

    function setBtnLoading(btn, isLoading, loadingText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...') {
      if (!btn) return;
      const textEl = btn.querySelector('.btnText');
      btn.classList.toggle('is-loading', !!isLoading);
      btn.disabled = !!isLoading;
      btn.setAttribute('aria-busy', isLoading ? 'true' : 'false');
      if (textEl) textEl.textContent = isLoading ? loadingText : (btn.dataset.idleText || textEl.textContent || 'Sign In');
      if (!btn.dataset.idleText && textEl) btn.dataset.idleText = 'Sign In';
    }

    function shake(el) {
      if (!el) return;
      el.classList.remove('lg-shake');
      // force reflow
      void el.offsetWidth;
      el.classList.add('lg-shake');
      setTimeout(() => el.classList.remove('lg-shake'), 450);
    }

    function setInvalid(inputEl, isInvalid) {
      if (!inputEl) return;
      inputEl.classList.toggle('lg-invalid', !!isInvalid);
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    const currentUserNameSpan = document.getElementById('currentUserName');
    const defaultAddressLabelSpan = document.getElementById('defaultAddressLabel');
    const btnAddressHelp = document.getElementById('btnAddressHelp');
    const addressHelpModal = document.getElementById('addressHelpModal');
    const btnCloseAddressHelp = document.getElementById('btnCloseAddressHelp');
    const btnOpenAddressBook = document.getElementById('btnOpenAddressBook');
    const addressBookModal = document.getElementById('addressBookModal');
    const btnCloseAddressBook = document.getElementById('btnCloseAddressBook');
    const addressBookList = document.getElementById('addressBookList');

    const btnOpenNotif = document.getElementById('btnOpenNotif');
    const notifBadge = document.getElementById('notifBadge');
    const notifModal = document.getElementById('notifModal');
    const btnCloseNotif = document.getElementById('btnCloseNotif');
    const btnClearNotif = document.getElementById('btnClearNotif');
    const notifList = document.getElementById('notifList');
    const notifHint = document.getElementById('notifHint');

    const presetSelect = document.getElementById('presetSelect');
    const btnApplyPreset = document.getElementById('btnApplyPreset');
    const btnSavePreset = document.getElementById('btnSavePreset');
    const btnManagePresets = document.getElementById('btnManagePresets');

    const presetsModal = document.getElementById('presetsModal');
    const btnClosePresets = document.getElementById('btnClosePresets');
    const presetsList = document.getElementById('presetsList');
    const presetNameInput = document.getElementById('presetNameInput');
    const btnCreatePresetFromCurrent = document.getElementById('btnCreatePresetFromCurrent');

    const pointsProgressBar = document.getElementById('pointsProgressBar');
    const pointsProgressHint = document.getElementById('pointsProgressHint');
    const pointsGoalLabel = document.getElementById('pointsGoalLabel');


    // Active order (pinned)
    const activeOrderWrap = document.getElementById('activeOrderWrap');
    const activeOrderStatusBadge = document.getElementById('activeOrderStatusBadge');
    const activeOrderPayBadge = document.getElementById('activeOrderPayBadge');
    const btnActiveOrderDetails = document.getElementById('btnActiveOrderDetails');
    const activeOrderService = document.getElementById('activeOrderService');
    const activeOrderId = document.getElementById('activeOrderId');
    const activeOrderPickup = document.getElementById('activeOrderPickup');
    const activeOrderEta = document.getElementById('activeOrderEta');
    const activeOrderPrice = document.getElementById('activeOrderPrice');
    const activeOrderNote = document.getElementById('activeOrderNote');
    const activeOrderTimeline = document.getElementById('activeOrderTimeline');

    // Orders modal (all history)
    const ordersModal = document.getElementById('ordersModal');
    const btnOpenOrdersModal = document.getElementById('btnOpenOrdersModal');
    const btnCloseOrdersModal = document.getElementById('btnCloseOrdersModal');
    const ordersSearch = document.getElementById('ordersSearch');
    const ordersSort = document.getElementById('ordersSort');
    const ordersStatusChips = document.getElementById('ordersStatusChips');
    const ordersAllList = document.getElementById('ordersAllList');
    const ordersModalHint = document.getElementById('ordersModalHint');

    let ordersAllCache = [];
    let ordersStatusFilter = 'all';

    const currentUserPointsSpan = document.getElementById('currentUserPoints');
    const serviceCards = document.getElementById('serviceCards');
    const ordersList = document.getElementById('ordersList');
    const noOrdersMessage = document.getElementById('noOrdersMessage');

    // ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    const orderTabs = document.getElementById('orderTabs');
    const orderServiceIcon = document.getElementById('orderServiceIcon');
    const orderServiceName = document.getElementById('orderServiceName');
    const orderServiceDesc = document.getElementById('orderServiceDesc');
    const orderBasePrice = document.getElementById('orderBasePrice');
    const orderUnitLabel = document.getElementById('orderUnitLabel');
    const orderQtyUnitLabel = document.getElementById('orderQtyUnitLabel');

    const orderQtyInput = document.getElementById('orderQty');
    const btnQtyMinus = document.getElementById('btnQtyMinus');
    const btnQtyPlus = document.getElementById('btnQtyPlus');
    const orderNoteInput = document.getElementById('orderNote');
    const orderPickupTimeInput = document.getElementById('orderPickupTime');

    const orderAddonPrimary = document.getElementById('orderAddonPrimary');
    const orderAddonExtra = document.getElementById('orderAddonExtra');
    const orderTotalPriceSpan = document.getElementById('orderTotalPrice');
    const orderTotalPriceBottom = document.getElementById('orderTotalPriceBottom');

    const orderEtaText = document.getElementById('orderEtaText');

    const pointsCurrentSpan = document.getElementById('pointsCurrent');
    const pointsEarnSpan = document.getElementById('pointsEarn');
    const pointsUsedSpan = document.getElementById('pointsUsed');
    const pointsAfterSpan = document.getElementById('pointsAfter');

    const serviceOrderForm = document.getElementById('serviceOrderForm');

    // Map-related elements
    const btnOpenMap = document.getElementById('btnOpenMap');
    const mapWrapper = document.getElementById('mapWrapper');
    const pickupLatInput = document.getElementById('pickupLat');
    const pickupLngInput = document.getElementById('pickupLng');
    const pickupPreview = document.getElementById('pickupPreview');

    // Favorite address elements
    const favoriteAddressSelect = document.getElementById('favoriteAddressSelect');
    const refreshFavoriteBtn = document.getElementById('refreshFavoriteBtn');
    const saveAddressLabel = document.getElementById('saveAddressLabel');
    const saveAddressName = document.getElementById('saveAddressName');
    const btnSaveAddress = document.getElementById('btnSaveAddress');

    // ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
    const adminLoginForm = document.getElementById('adminLoginForm');
    const adminUsernameInput = document.getElementById('adminUsername');
    const adminPasswordInput = document.getElementById('adminPassword');
    const adminNameSpan = document.getElementById('adminName');
    const adminStatusFilter = document.getElementById('adminStatusFilter');
    const adminPaymentFilter = document.getElementById('adminPaymentFilter');
    const adminSummary = document.getElementById('adminSummary');
    const adminOrdersList = document.getElementById('adminOrdersList');
    const adminReloadBtn = document.getElementById('adminReloadBtn');
    const adminSearchInput = document.getElementById('adminSearchInput');
    const adminSlipModal = document.getElementById('adminSlipModal');
    const adminSlipClose = document.getElementById('adminSlipClose');
    const adminSlipImage = document.getElementById('adminSlipImage');
    const adminSlipNoImage = document.getElementById('adminSlipNoImage');
    const adminSlipOrderId = document.getElementById('adminSlipOrderId');
    const adminSlipCustomer = document.getElementById('adminSlipCustomer');
    const adminSlipService = document.getElementById('adminSlipService');
    const adminSlipStatus = document.getElementById('adminSlipStatus');
    const adminSlipPayment = document.getElementById('adminSlipPayment');
    const adminSlipNote = document.getElementById('adminSlipNote');
    const adminSlipOpenLink = document.getElementById('adminSlipOpenLink');
    const adminSlipHint = document.getElementById('adminSlipHint');
    const adminSlipError = document.getElementById('adminSlipError');
    if (adminSlipModal && adminSlipClose) {
      adminSlipClose.addEventListener('click', () => {
        adminSlipModal.classList.add('hidden');
      });
      adminSlipModal.addEventListener('click', (e) => {
        if (e.target === adminSlipModal) {
          adminSlipModal.classList.add('hidden');
        }
      });
    }


    // Summary elements
    const summaryDayButtons = document.getElementById('summaryDayButtons');
    const summaryOrderCount = document.getElementById('summaryOrderCount');
    const summaryPaidRevenue = document.getElementById('summaryPaidRevenue');
    const summaryAllRevenue = document.getElementById('summaryAllRevenue');
    const summarySelectedDateLabel = document.getElementById('summarySelectedDateLabel');
    const summaryUpdatedAt = document.getElementById('summaryUpdatedAt');

    // Payment overlay elements
    const paymentCloseBtn = document.getElementById('paymentCloseBtn');
    const paymentLaterBtn = document.getElementById('paymentLaterBtn');
    const paymentConfirmBtn = document.getElementById('paymentConfirmBtn');
    const payServiceNameSpan = document.getElementById('payServiceName');
    const payOrderIdSpan = document.getElementById('payOrderId');
    const payAmountSpan = document.getElementById('payAmount');
    const paymentSlipInput = document.getElementById('paymentSlipInput');
    const paymentSlipPreview = document.getElementById('paymentSlipPreview');
    const paymentSlipPreviewImg = document.getElementById('paymentSlipPreviewImg');

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ + preview ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
    if (paymentSlipInput) {
      paymentSlipInput.addEventListener('change', () => {
        const file = paymentSlipInput.files && paymentSlipInput.files[0] ? paymentSlipInput.files[0] : null;
        pendingSlipFile = file || null;

        if (file && paymentSlipPreview && paymentSlipPreviewImg) {
          const reader = new FileReader();
          reader.onload = (ev) => {
            paymentSlipPreviewImg.src = ev.target.result;
            paymentSlipPreview.classList.remove('hidden');
          };
          reader.readAsDataURL(file);
        } else if (paymentSlipPreview && paymentSlipPreviewImg) {
          paymentSlipPreview.classList.add('hidden');
          paymentSlipPreviewImg.src = '';
        }
      });
    }

    // ‡∏•‡∏π‡∏Å‡πÄ‡∏•‡πà‡∏ô: ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤
    const detergentPills = document.querySelectorAll('.detergent-pill');
    const detergentDescription = document.getElementById('detergentDescription');

    // ‡πÅ‡∏ï‡πâ‡∏° redeem mode radio
    const redeemModeInputs = document.querySelectorAll('.redeem-mode');

    let currentUser = null;
    let currentAdmin = null;
    let currentServiceId = getVisibleServices().length ? getVisibleServices()[0].id : (SERVICES.length ? SERVICES[0].id : null);

    let lastCreatedOrder = null;
    let ordersHistoryCache = [];

    let lastCreatedService = null;
    let lastCreatedTotal = 0;

    function getServiceById(id) {
      return SERVICES.find(s => s.id === id) || null;
    }

    function hideAllViews() {
      viewLogin.classList.add('hidden');
      viewRegister.classList.add('hidden');
      viewServices.classList.add('hidden');
      viewOrder.classList.add('hidden');
      viewAdminLogin.classList.add('hidden');
      viewAdminDashboard.classList.add('hidden');
    }

    function updateNav() {
      const someoneLoggedIn = !!currentUser || !!currentAdmin;
      if (someoneLoggedIn) {
        logoutBtn.classList.remove('hidden');
        navLoginBtn.classList.add('hidden');
        navRegisterBtn.classList.add('hidden');
        navAdminBtn.classList.remove('hidden');
      } else {
        logoutBtn.classList.add('hidden');
        navLoginBtn.classList.remove('hidden');
        navRegisterBtn.classList.remove('hidden');
        navAdminBtn.classList.remove('hidden');
      }
    }

    function setView(name) {
      hideAllViews();
      if (name === 'login') viewLogin.classList.remove('hidden');
      else if (name === 'register') viewRegister.classList.remove('hidden');
      else if (name === 'services') viewServices.classList.remove('hidden');
      else if (name === 'order') viewOrder.classList.remove('hidden');
      else if (name === 'adminLogin') viewAdminLogin.classList.remove('hidden');
      else if (name === 'adminDashboard') viewAdminDashboard.classList.remove('hidden');
      updateNav();
    }

    function renderUserHeader() {
      if (currentUserNameSpan) {
        currentUserNameSpan.textContent =
          currentUser ? (currentUser.full_name || currentUser.username) : '';
      }
      updatePointsUI();
      updateDefaultAddressUI();
    }

    function renderAdminHeader() {
      if (!adminNameSpan) return;
      adminNameSpan.textContent =
        currentAdmin ? (currentAdmin.full_name || currentAdmin.username) : '';
    }

    // ---------- Supabase helpers ----------
    async function loadCurrentUserFromLocal() {
      const username = localStorage.getItem('laundryCurrentUser');
      if (!username) return null;
      const { data, error } = await db
        .from('customers')
        .select('*')
        .eq('username', username)
        .limit(1);
      if (error || !data || !data.length) return null;
      return data[0];
    }

    async function loadCurrentAdminFromLocal() {
      const username = localStorage.getItem('laundryAdminUser');
      if (!username) return null;
      const { data, error } = await db
        .from('admins')
        .select('*')
        .eq('username', username)
        .limit(1);
      if (error || !data || !data.length) return null;
      return data[0];
    }

    async function loginCustomer(username, password) {
      const { data, error } = await db
        .from('customers')
        .select('*')
        .eq('username', username)
        .eq('password', password)
        .limit(1);

      if (error || !data || !data.length) return null;
      return data[0];
    }

    async function registerCustomer(fullName, username, phone, password) {
      const { data, error } = await db
        .from('customers')
        .insert([{ full_name: fullName, username, phone, password }])
        .select()
        .single();
      if (error) throw error;
      return data;
    }

    async function loginAdmin(username, password) {
      const { data, error } = await db
        .from('admins')
        .select('*')
        .eq('username', username)
        .eq('password', password)
        .limit(1);

      if (error || !data || !data.length) return null;
      const admin = data[0];

      await db
        .from('admins')
        .update({ last_login: new Date().toISOString() })
        .eq('id', admin.id);

      return admin;
    }

    async function fetchOrdersForCurrentUser(limit = 5) {
      if (!currentUser) return [];
      const { data, error } = await db
        .from('orders')
        .select('*')
        .eq('customer_username', currentUser.username)
        .order('created_at', { ascending: false })
        .limit(limit);

      if (error || !data) return [];
      return data;
    }

    async function fetchOrdersForAdmin(statusFilter = 'all') {
      let query = db
        .from('orders')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(200);

      if (statusFilter && statusFilter !== 'all') {
        query = query.eq('status', statusFilter);
      }

      const { data, error } = await query;
      if (error || !data) return [];
      return data;
    }

    async function updateOrderStatus(orderId, newStatus) {
      const { error } = await db
        .from('orders')
        .update({ status: newStatus })
        .eq('id', orderId);
      if (error) throw error;
    }

    async function updateOrderPaymentStatus(orderId, paymentStatus) {
      const { error } = await db
        .from('orders')
        .update({ payment_status: paymentStatus })
        .eq('id', orderId);
      if (error) throw error;
    }

    async function deleteOrder(orderId) {
      const { error } = await db
        .from('orders')
        .delete()
        .eq('id', orderId);
      if (error) throw error;
    }

    async function createOrderForCurrentUser(orderInput) {
      if (!currentUser) throw new Error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô');

      const s = getServiceById(orderInput.serviceType);
      const serviceName = s ? s.title : orderInput.serviceType;

      const parts = [];
      parts.push(`‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ${serviceName} (${orderInput.serviceType})`);
      parts.push(`‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${orderInput.quantity} ${orderInput.unitLabel || '‡∏´‡∏ô‡πà‡∏ß‡∏¢'}`);
      if (orderInput.addons && orderInput.addons.length) {
        parts.push(`‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°: ${orderInput.addons.join(', ')}`);
      }
      if (orderInput.note) parts.push(`‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${orderInput.note}`);
      if (orderInput.locationText) parts.push(orderInput.locationText);
      if (orderInput.pointsInfoText) parts.push(orderInput.pointsInfoText);
      const noteText = parts.join(' | ');

      const payload = {
        customer_username: currentUser.username,
        service_type: orderInput.serviceType,
        drum_size: 'standard',
        detergent: 'shop',
        pickup_type: 'delivery',
        pickup_time: orderInput.pickupTime
          ? new Date(orderInput.pickupTime).toISOString()
          : null,
        pickup_lat: orderInput.pickupLat || null,
        pickup_lng: orderInput.pickupLng || null,
        address: null,
        note: noteText,
        price: orderInput.totalPrice ?? null,
        status: '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤',
        payment_status: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞',
        points_earn: orderInput.pointsEarn ?? null,
        points_used: orderInput.pointsUsed ?? null
      };

      const { data, error } = await db
        .from('orders')
        .insert([payload])
        .select()
        .single();

      if (error) throw error;
      return data;
    }

    // Favorite addresses helpers
    async function fetchFavoriteAddresses() {
      if (!currentUser) return [];
      const { data, error } = await db
        .from('customer_addresses')
        .select('*')
        .eq('customer_username', currentUser.username)
        .order('created_at', { ascending: false });
      if (error || !data) return [];
      return data;
    }

    async function saveFavoriteAddress(label, nickname, lat, lng, isDefault = false) {
      if (!currentUser) throw new Error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô');
      // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ is_default=false ‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
      if (isDefault) {
        try {
          await db
            .from('customer_addresses')
            .update({ is_default: false })
            .eq('customer_username', currentUser.username);
        } catch (e) {
          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå/‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏Å‡πá‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏î‡πâ
        }
      }

      // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏° is_default (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà) ‡∏ñ‡πâ‡∏≤ error ‡πÉ‡∏´‡πâ fallback ‡πÄ‡∏õ‡πá‡∏ô schema ‡πÄ‡∏î‡∏¥‡∏°
      let { error } = await db
        .from('customer_addresses')
        .insert([{
          customer_username: currentUser.username,
          label,
          nickname,
          lat,
          lng,
          ...(isDefault ? { is_default: true } : {})
        }]);

      if (error) {
        // fallback (‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå is_default)
        const retry = await db
          .from('customer_addresses')
          .insert([{
            customer_username: currentUser.username,
            label,
            nickname,
            lat,
            lng
          }]);
        error = retry.error;
      }
      if (error) throw error;
    }

    // Customers map (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö search ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô)
    async function fetchCustomersByUsernames(usernames) {
      if (!usernames.length) return {};
      const unique = Array.from(new Set(usernames));
      const { data, error } = await db
        .from('customers')
        .select('username, full_name, phone')
        .in('username', unique);
      if (error || !data) return {};
      const map = {};
      data.forEach(c => {
        map[c.username] = c;
      });
      return map;
    }

    async function updateCustomerPoints(username, newPoints) {
      const { data, error } = await db
        .from('customers')
        .update({ points: newPoints })
        .eq('username', username)
        .select()
        .single();
      if (error) throw error;
      return data;
    }

    // ---------- Points / ETA UI ----------
    
    const POINTS_GOAL_DEFAULT = 100;

    function updatePointsProgress(points) {
      const goal = POINTS_GOAL_DEFAULT;
      if (pointsGoalLabel) pointsGoalLabel.textContent = goal;

      if (!pointsProgressBar || !pointsProgressHint) return;

      const p = Math.max(0, Math.min(points || 0, goal));
      const percent = goal ? Math.round((p / goal) * 100) : 0;
      pointsProgressBar.style.width = percent + '%';

      if ((points || 0) >= goal) {
        pointsProgressHint.textContent = '‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß üéâ ‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢';
      } else {
        const remain = goal - (points || 0);
        pointsProgressHint.textContent = `‡∏≠‡∏µ‡∏Å ${remain} ‡πÅ‡∏ï‡πâ‡∏° ‡∏à‡∏∞‡πÅ‡∏•‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î ‡∏ø10 ‡πÑ‡∏î‡πâ`;
      }
    }

function updatePointsUI() {
      const points = currentUser ? (currentUser.points || 0) : 0;
      if (currentUserPointsSpan) {
        currentUserPointsSpan.textContent = points;
      }
      if (pointsCurrentSpan) {
        pointsCurrentSpan.textContent = points;
      }
      if (pointsAfterSpan) {
        pointsAfterSpan.textContent = points;
      }
      updatePointsProgress(points);
    }

    function formatEtaText(service, pickupTimeStr) {
      if (!service || !service.etaHours) return '‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‚Ä¶ ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô';

      const { min, max } = service.etaHours;
      if (!pickupTimeStr) {
        return `‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${min}-${max} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏∏‡∏ì`;
      }

      const pickupDate = new Date(pickupTimeStr);
      if (isNaN(pickupDate.getTime())) {
        return `‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${min}-${max} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏∏‡∏ì`;
      }

      const etaMin = new Date(pickupDate.getTime() + min * 60 * 60 * 1000);
      const etaMax = new Date(pickupDate.getTime() + max * 60 * 60 * 1000);

      const opts = {
        day: 'numeric',
        month: 'short',
        hour: '2-digit',
        minute: '2-digit'
      };

      return `‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ã‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${etaMin.toLocaleString('th-TH', opts)} ‚Äì ${etaMax.toLocaleString('th-TH', opts)}`;
    }

    function updateEtaUI(service) {
      if (!orderEtaText) return;
      const pickupTimeStr = orderPickupTimeInput ? orderPickupTimeInput.value : '';
      orderEtaText.textContent = formatEtaText(service, pickupTimeStr);
    }

    function updateRedeemOptions(service) {
      const freeBagLabel = document.querySelector('.redeem-free-bag');
      if (!freeBagLabel) return;
      if (service && service.unitLabel === '‡∏ñ‡∏∏‡∏á') {
        freeBagLabel.classList.remove('opacity-40');
      } else {
        freeBagLabel.classList.add('opacity-40');
        const freeRadio = freeBagLabel.querySelector('input[type="radio"]');
        if (freeRadio && freeRadio.checked) {
          const noneRadio = document.querySelector('input.redeem-mode[value="none"]');
          if (noneRadio) noneRadio.checked = true;
        }
      }
    }

    // ---------- Render service cards / tabs ----------
    function renderServiceCards() {
      if (!serviceCards) return;
      serviceCards.innerHTML = getVisibleServices().map(s => `
        <div class="relative rounded-3xl p-4 text-xs text-white shadow-lg ${s.cardBg} overflow-hidden transform hover:-translate-y-1 hover:shadow-2xl transition">
          <div class="absolute -right-6 -top-6 w-20 h-20 bg-white/15 rounded-full blur-lg"></div>
          <div class="flex flex-col h-full relative z-10">
            <div class="flex-1">
              <div class="flex items-center justify-between mb-2">
                <div class="text-3xl md:text-4xl drop-shadow-sm">${s.icon}</div>
                <span class="px-2 py-1 rounded-full bg-black/20 text-[10px] border border-white/20">
                  ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ø${s.basePrice}
                </span>
              </div>
              <h3 class="text-base font-semibold mb-0.5">${s.title}</h3>
              <p class="text-[11px] opacity-95 leading-relaxed">${s.shortDesc}</p>
              <p class="text-[10px] mt-1 opacity-90">
                ‚è± ETA ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${s.etaHours.min}-${s.etaHours.max} ‡∏ä‡∏°. ‡∏´‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤
              </p>
            </div>
            <button type="button"
                    onclick="openServiceOrder('${s.id}')"
                    class="mt-4 w-full py-2.5 rounded-xl bg-white/95 text-slate-900 text-xs font-semibold hover:bg-white shadow-md">
              ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ
            </button>
          </div>
        </div>
      `).join('');
    }

    function renderOrderTabs() {
      if (!orderTabs) return;
      orderTabs.innerHTML = getVisibleServices().map(s => `
        <button type="button"
                onclick="switchOrderServiceTab('${s.id}')"
                class="service-tab px-3.5 py-2 rounded-t-2xl border-b-2 border-transparent text-xs sm:text-sm whitespace-nowrap text-slate-500 hover:bg-sky-50">
          ${s.title}
        </button>
      `).join('');
      updateActiveTab();
    }

    function updateActiveTab() {
      if (!orderTabs || !currentServiceId) return;
      const tabs = orderTabs.querySelectorAll('.service-tab');
      tabs.forEach(btn => {
        const text = btn.textContent.trim();
        const service = SERVICES.find(s => s.title === text);
        if (service && service.id === currentServiceId) {
          btn.classList.add('border-sky-500', 'text-sky-700', 'bg-sky-50');
          btn.classList.remove('border-transparent', 'text-slate-500');
        } else {
          btn.classList.add('border-transparent', 'text-slate-500');
          btn.classList.remove('border-sky-500', 'text-sky-700', 'bg-sky-50');
        }
      });
    }

    // ---------- Order view (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤) ----------
    function buildAddonPrimary(service) {
      if (!orderAddonPrimary) return;
      if (!service.primaryAddons || !service.primaryAddons.length) {
        orderAddonPrimary.innerHTML = '<p class="text-xs text-slate-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</p>';
        return;
      }
      orderAddonPrimary.innerHTML = service.primaryAddons.map(a => `
        <label class="flex items-center justify-between gap-3 rounded-2xl border border-slate-200 bg-slate-50/80 px-3.5 py-2.5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-xl">
              ${a.icon || 'üß∫'}
            </div>
            <div>
              <p class="text-sm font-semibold text-slate-800">${a.name}</p>
              <p class="text-xs text-slate-500">${a.desc}</p>
            </div>
          </div>
          <div class="flex flex-col items-end gap-1">
            <span class="text-xs text-sky-600 font-semibold">+‡∏ø${a.price}</span>
            <div class="relative inline-flex items-center">
              <input type="checkbox"
                     class="sr-only addon-toggle peer"
                     data-addon-id="${a.id}"
                     data-addon-name="${a.name}"
                     data-addon-price="${a.price}">
              <div class="w-9 h-5 bg-slate-300 rounded-full peer-checked:bg-sky-500 transition-colors"></div>
              <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full shadow
                          peer-checked:translate-x-4 transition-transform"></div>
            </div>
          </div>
        </label>
      `).join('');
    }

    function buildAddonExtra(service) {
      if (!orderAddonExtra) return;
      if (!service.extraAddons || !service.extraAddons.length) {
        orderAddonExtra.innerHTML = '<p class="text-xs text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</p>';
        return;
      }
      orderAddonExtra.innerHTML = service.extraAddons.map(a => `
        <label class="flex flex-col justify-between rounded-2xl border border-slate-200 bg-slate-50/80 px-3.5 py-3 space-y-2">
          <div class="flex items-center gap-2">
            <div class="w-9 h-9 rounded-full bg-white flex items-center justify-center text-xl">
              ${a.icon || 'üß∫'}
            </div>
            <div>
              <p class="text-sm font-semibold text-slate-800">${a.name}</p>
              <p class="text-xs text-slate-500">${a.desc}</p>
            </div>
          </div>
          <div class="flex items-center justify-between text-xs">
            <span class="text-sky-600 font-semibold">+‡∏ø${a.price} / ${service.unitLabel}</span>
            <div class="relative inline-flex items-center">
              <input type="checkbox"
                     class="sr-only addon-toggle peer"
                     data-addon-id="${a.id}"
                     data-addon-name="${a.name}"
                     data-addon-price="${a.price}">
              <div class="w-9 h-5 bg-slate-300 rounded-full peer-checked:bg-sky-500 transition-colors"></div>
              <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full shadow
                          peer-checked:translate-x-4 transition-transform"></div>
            </div>
          </div>
        </label>
      `).join('');
    }

    function calculateTotalPrice(service) {
      const qty = Math.max(parseInt(orderQtyInput.value || '1', 10), 1);
      const basePerUnit = service.basePrice;

      let addonPerUnit = 0;
      const checked = viewOrder.querySelectorAll('.addon-toggle:checked');
      checked.forEach(cb => {
        const extra = Number(cb.dataset.addonPrice || '0');
        addonPerUnit += extra;
      });

      const baseTotal = (basePerUnit + addonPerUnit) * qty;

      const pointsCurrent = currentUser ? (currentUser.points || 0) : 0;
      let pointsUsed = 0;
      let discount = 0;
      let redeemMode = 'none';

      const selectedRedeem = document.querySelector('input.redeem-mode:checked');
      if (selectedRedeem) {
        redeemMode = selectedRedeem.value || 'none';
      }

      if (redeemMode === 'discount' && pointsCurrent > 0) {
        pointsUsed = pointsCurrent;
        discount = pointsUsed * 10;
        if (discount > baseTotal) {
          discount = baseTotal;
          pointsUsed = Math.ceil(baseTotal / 10);
        }
      } else if (redeemMode === 'free_bag' &&
                 pointsCurrent >= 10 &&
                 service.unitLabel === '‡∏ñ‡∏∏‡∏á') {
        const perUnitTotal = basePerUnit + addonPerUnit;
        discount = perUnitTotal;
        pointsUsed = 10;
      }

      const finalTotal = Math.max(baseTotal - discount, 0);

      const pointsEarn = Math.floor(finalTotal / 100); // ‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
      const pointsAfter = pointsCurrent - pointsUsed + pointsEarn;

      return {
        qty,
        basePerUnit,
        addonPerUnit,
        baseTotal,
        discount,
        total: finalTotal,
        pointsCurrent,
        pointsUsed,
        pointsEarn,
        pointsAfter,
        redeemMode
      };
    }

    function updatePointsSummaryUI(calc) {
      if (!calc) return;
      if (pointsCurrentSpan) pointsCurrentSpan.textContent = calc.pointsCurrent;
      updatePointsProgress(calc.pointsCurrent);
      if (pointsEarnSpan) pointsEarnSpan.textContent = calc.pointsEarn;
      if (pointsUsedSpan) pointsUsedSpan.textContent = calc.pointsUsed;
      if (pointsAfterSpan) pointsAfterSpan.textContent = calc.pointsAfter;
    }

    function updateOrderPrice() {
      const service = getServiceById(currentServiceId);
      if (!service) return;
      const calc = calculateTotalPrice(service);
      orderTotalPriceSpan.textContent = String(calc.total);
      orderTotalPriceBottom.textContent = String(calc.total);
      lastOrderPointsEarn = calc.pointsEarn;
      lastOrderPointsUsed = calc.pointsUsed;
      lastOrderRedeemMode = calc.redeemMode;
      updatePointsSummaryUI(calc);
      updateEtaUI(service);
    }

    function setupOrderView(service) {
      if (!service) return;
      currentServiceId = service.id;

      orderServiceIcon.textContent = service.icon || 'üß∫';
      orderServiceName.textContent = service.title;
      orderServiceDesc.textContent = service.heroDesc || service.shortDesc;
      orderBasePrice.textContent = String(service.basePrice);
      orderUnitLabel.textContent = '/' + (service.unitLabel || '‡∏´‡∏ô‡πà‡∏ß‡∏¢');
      orderQtyUnitLabel.textContent = service.qtyLabel || '';

      orderQtyInput.value = '1';
      orderNoteInput.value = '';
      if (orderPickupTimeInput) orderPickupTimeInput.value = '';
      if (pickupLatInput) pickupLatInput.value = '';
      if (pickupLngInput) pickupLngInput.value = '';
      if (pickupPreview) {
        pickupPreview.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)';
      }

      // reset redeem mode
      const noneRadio = document.querySelector('input.redeem-mode[value="none"]');
      if (noneRadio) noneRadio.checked = true;

      buildAddonPrimary(service);
      buildAddonExtra(service);
      updateRedeemOptions(service);

      const addonCheckboxes = viewOrder.querySelectorAll('.addon-toggle');
      addonCheckboxes.forEach(cb => cb.addEventListener('change', updateOrderPrice));

      updateActiveTab();
      updateOrderPrice();
    }

    // ---------- HISTORY ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ----------
    async function renderOrdersHistory() {
      if (!ordersList || !noOrdersMessage) return;
      if (!currentUser) {
        ordersList.innerHTML = '';
      // Pinned active order
      const active = getActiveOrderFromList(orders);
      const activeService = active ? SERVICES.find(s => s.id === active.service_type) : null;
      renderActiveOrderCard(active, activeService);

        noOrdersMessage.classList.remove('hidden');
        return;
      }
      const orders = await fetchOrdersForCurrentUser(20);
      ordersHistoryCache = orders;
      detectOrderStatusChanges(orders);
      ordersList.innerHTML = '';

      if (!orders.length) {
        noOrdersMessage.classList.remove('hidden');
        return;
      }
      noOrdersMessage.classList.add('hidden');

      orders.slice(0,5).forEach(order => {
        const created = new Date(order.created_at);
        const createdText = isNaN(created.getTime())
          ? ''
          : created.toLocaleString('th-TH');

        const service = getServiceById(order.service_type);
        const serviceName = service ? service.title : order.service_type;

        const paymentStatus = order.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞';
        const isPaid = paymentStatus === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß';
        const isChecking = paymentStatus === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';

        let payClass = 'bg-amber-50 text-amber-700 border-amber-100';
        if (isPaid) payClass = 'bg-emerald-50 text-emerald-700 border-emerald-100';
        else if (!isPaid && !isChecking) payClass = 'bg-rose-50 text-rose-700 border-rose-100';

        const div = document.createElement('div');
        div.className = 'border border-slate-100 rounded-xl p-2.5 bg-slate-50/90';
        div.innerHTML = `
          <div class="flex items-center justify-between gap-2 mb-1">
            <p class="font-semibold text-[13px] text-slate-800">
              ${serviceName}
            </p>
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px]
                           bg-sky-50 text-sky-700 border border-sky-100">
              ${order.status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤'}
            </span>
          </div>
          <p class="text-[11px] text-slate-500">
            ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ‡∏ø${order.price ?? '-'}
          </p>
          <p class="text-[11px] mt-0.5">
            ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:
            <span class="inline-flex items-center px-2 py-0.5 rounded-full border text-[10px] ${payClass}">
              ${paymentStatus}
            </span>
          </p>
          <div class="flex items-center justify-between mt-1">
            <p class="text-[11px] text-slate-400">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${createdText}</p>
            <p class="text-[11px] text-slate-500 truncate max-w-[55%]">
              ${order.note || ''}
            </p>
          </div>
          <div class="mt-2 flex items-center justify-end gap-2">
            <button type="button"
                    class="rounded-lg px-3 py-1.5 text-[11px] font-semibold bg-white border border-slate-200 hover:bg-slate-50"
                    data-action="reorder"
                    data-order-id="${order.id ?? ''}">
              ‡∏™‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≥
            </button>
            <button type="button"
                    class="rounded-lg px-3 py-1.5 text-[11px] font-semibold bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-700"
                    data-action="preset-from-order"
                    data-order-id="${order.id ?? ''}">
              ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
            </button>
          </div>
        `;
        ordersList.appendChild(div);
      });
    }

    
    // ---------- Default address (Services header) ----------
    async function fetchDefaultAddressForCurrentUser() {
      if (!currentUser) return null;
      try {
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå is_default ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
        const { data, error } = await db
          .from('customer_addresses')
          .select('*')
          .eq('customer_username', currentUser.username)
          .order('is_default', { ascending: false })
          .order('created_at', { ascending: false })
          .limit(1);
        if (error || !data || !data.length) return null;
        return data[0];
      } catch (e) {
        // fallback: schema ‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏°‡∏µ is_default)
        const { data } = await db
          .from('customer_addresses')
          .select('*')
          .eq('customer_username', currentUser.username)
          .order('created_at', { ascending: false })
          .limit(1);
        return (data && data[0]) ? data[0] : null;
      }
    }

    async function updateDefaultAddressUI() {
      if (!defaultAddressLabelSpan) return;
      if (!currentUser) {
        defaultAddressLabelSpan.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
        return;
      }
      const addr = await fetchDefaultAddressForCurrentUser();
      if (!addr) {
        defaultAddressLabelSpan.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
        return;
      }
      const name = addr.nickname ? ` - ${addr.nickname}` : '';
      defaultAddressLabelSpan.textContent = `${addr.label}${name}`;
    }

    // ---------- Active order card ----------
    function getActiveOrderFromList(orders) {
      if (!orders || !orders.length) return null;
      return orders.find(o => (o.status !== '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' && o.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')) || null;
    }

    function renderActiveOrderTimeline(status) {
      if (!activeOrderTimeline) return;
      const steps = ['‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤','‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏±‡∏Å','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏ö','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏ö','‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á','‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'];
      const idx = Math.max(0, steps.indexOf(status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤'));
      activeOrderTimeline.innerHTML = '';
      steps.forEach((s, i) => {
        const done = i <= idx;
        const el = document.createElement('div');
        el.className = 'rounded-xl border px-2 py-2 text-center ' +
          (done ? 'bg-emerald-50 border-emerald-100 text-emerald-700' : 'bg-slate-50 border-slate-200 text-slate-500');
        el.innerHTML = `<div class="font-semibold">${i+1}</div><div class="mt-1">${escapeHtml(s)}</div>`;
        activeOrderTimeline.appendChild(el);
      });
    }

    function renderActiveOrderCard(order, service) {
      if (!activeOrderWrap) return;
      if (!order) {
        activeOrderWrap.classList.add('hidden');
        return;
      }
      activeOrderWrap.classList.remove('hidden');

      const serviceName = (service && service.title) ? service.title : (order.service_type || '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');
      if (activeOrderService) activeOrderService.textContent = serviceName;
      if (activeOrderId) activeOrderId.textContent = String(order.id ?? '-');
      if (activeOrderPickup) {
        activeOrderPickup.textContent = order.pickup_time
          ? new Date(order.pickup_time).toLocaleString('th-TH')
          : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
      }
      if (activeOrderEta) activeOrderEta.textContent = formatEtaText(service, order.pickup_time || '');
      if (activeOrderPrice) activeOrderPrice.textContent = (order.price ?? '-') + '';
      if (activeOrderNote) activeOrderNote.textContent = order.note || '-';

      // status badge
      if (activeOrderStatusBadge) activeOrderStatusBadge.textContent = order.status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤';

      // payment badge with colors similar to history
      const isPaid = (order.payment_status === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß');
      const isChecking = (order.payment_status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô');
      let payText = order.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞';
      if (activeOrderPayBadge) {
        activeOrderPayBadge.textContent = payText;
        activeOrderPayBadge.className = 'inline-flex items-center px-2.5 py-1 rounded-full text-[11px] border ' +
          (isPaid ? 'bg-emerald-50 text-emerald-700 border-emerald-100'
                 : (isChecking ? 'bg-amber-50 text-amber-700 border-amber-100'
                               : 'bg-rose-50 text-rose-700 border-rose-100'));
      }

      renderActiveOrderTimeline(order.status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤');

      if (btnActiveOrderDetails) {
        btnActiveOrderDetails.onclick = () => {
          // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ô‡πâ‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ (‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ flow ‡πÄ‡∏î‡∏¥‡∏°)
          openOrdersModal(String(order.id));
        };
      }
    }

    // ---------- Orders modal ----------
    function openOrdersModal(focusOrderId = '') {
      if (!ordersModal) return;
      ordersModal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');

      if (ordersSearch) ordersSearch.value = focusOrderId || '';
      if (ordersModalHint) ordersModalHint.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
      if (ordersAllList) ordersAllList.innerHTML = '';

      ensureOrdersStatusChips();
      loadOrdersAll().then(() => applyOrdersModalFilters());
    }

    function closeOrdersModal() {
      if (!ordersModal) return;
      ordersModal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }

    function ensureOrdersStatusChips() {
      if (!ordersStatusChips) return;
      ordersStatusChips.innerHTML = '';

      const chip = (key, label) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'px-3 py-1.5 rounded-full text-[11px] font-semibold border ' +
          (ordersStatusFilter === key ? 'bg-sky-600 text-white border-sky-600' : 'bg-white text-slate-700 border-slate-200 hover:border-sky-300');
        b.textContent = label;
        b.addEventListener('click', () => {
          ordersStatusFilter = key;
          ensureOrdersStatusChips();
          applyOrdersModalFilters();
        });
        return b;
      };

      ordersStatusChips.appendChild(chip('all', '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î'));
      ORDER_STATUSES.forEach(s => {
        ordersStatusChips.appendChild(chip(s, s));
      });
    }

    async function loadOrdersAll() {
      if (!currentUser) {
        ordersAllCache = [];
        if (ordersModalHint) ordersModalHint.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô';
        return;
      }
      // ‡∏î‡∏∂‡∏á‡πÄ‡∏¢‡∏≠‡∏∞‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á/‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á client
      ordersAllCache = await fetchOrdersForCurrentUser(200);
      if (ordersModalHint) {
        ordersModalHint.textContent = ordersAllCache.length ? `‡∏û‡∏ö ${ordersAllCache.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå';
      }
    }

    function applyOrdersModalFilters() {
      if (!ordersAllList) return;
      const q = (ordersSearch && ordersSearch.value ? ordersSearch.value.trim().toLowerCase() : '');
      const sort = (ordersSort && ordersSort.value) || 'newest';

      let arr = [...ordersAllCache];

      // status filter
      if (ordersStatusFilter && ordersStatusFilter !== 'all') {
        arr = arr.filter(o => (o.status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤') === ordersStatusFilter);
      }

      // search filter
      if (q) {
        arr = arr.filter(o => {
          const s = [
            String(o.id ?? ''),
            String(o.service_type ?? ''),
            String(o.note ?? ''),
            String(o.status ?? ''),
            String(o.payment_status ?? '')
          ].join(' ').toLowerCase();
          return s.includes(q);
        });
      }

      // sort
      arr.sort((a, b) => {
        const da = new Date(a.created_at || 0).getTime();
        const dbt = new Date(b.created_at || 0).getTime();
        return sort === 'oldest' ? (da - dbt) : (dbt - da);
      });

      ordersAllList.innerHTML = '';
      arr.forEach(order => {
        const service = SERVICES.find(s => s.id === order.service_type);
        const serviceName = service ? service.title : (order.service_type || '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');

        const isPaid = (order.payment_status === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß');
        const isChecking = (order.payment_status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô');
        let payClass = 'bg-amber-50 text-amber-700 border-amber-100';
        if (isPaid) payClass = 'bg-emerald-50 text-emerald-700 border-emerald-100';
        else if (!isPaid && !isChecking) payClass = 'bg-rose-50 text-rose-700 border-rose-100';

        const div = document.createElement('div');
        div.className = 'border border-slate-100 rounded-xl p-2.5 bg-white';
        div.innerHTML = `
          <div class="flex items-center justify-between gap-2 mb-1">
            <p class="font-semibold text-[13px] text-slate-800">${escapeHtml(serviceName)}</p>
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] bg-sky-50 text-sky-700 border border-sky-100">
              ${escapeHtml(order.status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤')}
            </span>
          </div>
          <div class="flex items-center justify-between text-[11px] text-slate-500">
            <span class="font-mono">#${order.id ?? '-'}</span>
            <span>${order.created_at ? new Date(order.created_at).toLocaleString('th-TH') : ''}</span>
          </div>
          <div class="mt-2 flex items-center justify-between gap-2">
            <span class="text-[11px] text-slate-500">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ‡∏ø${order.price ?? '-'}</span>
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] border ${payClass}">
              ${escapeHtml(order.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞')}
            </span>
          </div>
          ${order.note ? `<p class="text-[11px] text-slate-500 mt-1 line-clamp-2">${escapeHtml(order.note)}</p>` : ''}
        
          <div class="mt-2 flex items-center justify-end gap-2">
            <button type="button"
                    class="rounded-lg px-3 py-1.5 text-[11px] font-semibold bg-white border border-slate-200 hover:bg-slate-50"
                    data-action="reorder"
                    data-order-id="${order.id ?? ''}">
              ‡∏™‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≥
            </button>
            <button type="button"
                    class="rounded-lg px-3 py-1.5 text-[11px] font-semibold bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-700"
                    data-action="preset-from-order"
                    data-order-id="${order.id ?? ''}">
              ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
            </button>
          </div>
`;
        ordersAllList.appendChild(div);
      });
    }

    // ---------- Favorite Addresses UI ----------
    async function loadFavoriteAddresses() {
      if (!favoriteAddressSelect) return;
      if (!currentUser) {
        favoriteAddresses = [];
        favoriteAddressSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>';
        return;
      }
      favoriteAddresses = await fetchFavoriteAddresses();
      renderFavoriteAddressesSelect();
    }

    function renderFavoriteAddressesSelect() {
      if (!favoriteAddressSelect) return;
      favoriteAddressSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>';
      favoriteAddresses.forEach(addr => {
        const option = document.createElement('option');
        option.value = String(addr.id);
        const nickname = addr.nickname ? ` (${addr.nickname})` : '';
        option.textContent = `${addr.label}${nickname}`;
        favoriteAddressSelect.appendChild(option);
      });
    }

    function applyFavoriteAddressById(idStr) {
      if (!idStr) return;
      const id = Number(idStr);
      const addr = favoriteAddresses.find(a => a.id === id);
      if (!addr || !pickupLatInput || !pickupLngInput || !pickupPreview) return;

      pickupLatInput.value = addr.lat;
      pickupLngInput.value = addr.lng;
      pickupPreview.textContent = `‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥: ${addr.label}${addr.nickname ? ' - ' + addr.nickname : ''} (‡∏û‡∏¥‡∏Å‡∏±‡∏î ${addr.lat.toFixed(5)}, ${addr.lng.toFixed(5)})`;

      if (laundryMap && typeof google !== 'undefined') {
        const pos = new google.maps.LatLng(addr.lat, addr.lng);
        if (!laundryMarker) {
          laundryMarker = new google.maps.Marker({
            position: pos,
            map: laundryMap,
          });
        } else {
          laundryMarker.setPosition(pos);
        }
        laundryMap.setCenter(pos);
      }
    }

    // ---------- ADMIN SUMMARY (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î + charts) ----------
    function formatThaiDateKey(key) {
      const d = new Date(key + 'T00:00:00');
      if (isNaN(d.getTime())) return key;
      const now = new Date();
      const diffDays = Math.floor((now - d) / (24 * 60 * 60 * 1000));
      if (diffDays === 0) return '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ';
      if (diffDays === 1) return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô';
      return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
    }

    function updateAdminSummaryUIForDate() {
      if (!adminDailySummaryData || !adminSummarySelectedDateKey) return;
      const { daily } = adminDailySummaryData;

      const stats = daily[adminSummarySelectedDateKey] || {
        totalOrders: 0,
        totalRevenue: 0,
        paidRevenue: 0,
      };

      if (summaryOrderCount) summaryOrderCount.textContent = stats.totalOrders;
      if (summaryPaidRevenue) summaryPaidRevenue.textContent = stats.paidRevenue;
      if (summaryAllRevenue) summaryAllRevenue.textContent = stats.totalRevenue;
      if (summarySelectedDateLabel) summarySelectedDateLabel.textContent = formatThaiDateKey(adminSummarySelectedDateKey);

      if (summaryDayButtons) {
        summaryDayButtons.querySelectorAll('button[data-date-key]').forEach(btn => {
          if (btn.dataset.dateKey === adminSummarySelectedDateKey) {
            btn.classList.remove('bg-slate-800', 'border-slate-700', 'text-slate-200');
            btn.classList.add('bg-emerald-500/20', 'border-emerald-400', 'text-emerald-50');
          } else {
            btn.classList.add('bg-slate-800', 'border-slate-700', 'text-slate-200');
            btn.classList.remove('bg-emerald-500/20', 'border-emerald-400', 'text-emerald-50');
          }
        });
      }
    }

    function updateAdminCharts(dateKeys, daily, serviceCounts) {
      const revenueCanvas = document.getElementById('chartRevenue7Days');
      const serviceCanvas = document.getElementById('chartOrdersByService');
      if (!revenueCanvas || !serviceCanvas) return;

      const sortedKeys = [...dateKeys].sort();
      const labels = sortedKeys.map(k => formatThaiDateKey(k));
      const ordersData = sortedKeys.map(k => (daily[k]?.totalOrders) || 0);
      const revenueData = sortedKeys.map(k => (daily[k]?.paidRevenue) || 0);

      if (revenueChart) revenueChart.destroy();
      revenueChart = new Chart(revenueCanvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels,
          datasets: [
            {
              label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå',
              data: ordersData,
            },
            {
              label: '‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏≤‡∏ó)',
              data: revenueData,
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      const serviceKeys = Object.keys(serviceCounts);
      const serviceLabels = serviceKeys.map(k => {
        const s = getServiceById(k);
        return s ? s.title : k;
      });
      const serviceData = serviceKeys.map(k => serviceCounts[k]);

      if (serviceChart) serviceChart.destroy();
      serviceChart = new Chart(serviceCanvas.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: serviceLabels,
          datasets: [{
            data: serviceData
          }]
        },
        options: {
          responsive: true
        }
      });
    }

    async function renderAdminSummary() {
      if (!summaryDayButtons || !summaryOrderCount || !summaryPaidRevenue || !summaryAllRevenue || !summarySelectedDateLabel) {
        return;
      }

      const days = 7;
      const now = new Date();
      const from = new Date(now.getTime() - (days - 1) * 24 * 60 * 60 * 1000);

      const { data, error } = await db
        .from('orders')
        .select('*')
        .gte('created_at', from.toISOString())
        .order('created_at', { ascending: false });

      if (error || !data) {
        adminDailySummaryData = null;
        summaryDayButtons.innerHTML = '<p class="text-xs text-slate-300">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏î‡πâ</p>';
        return;
      }

      const daily = {};
      const serviceCounts = {};

      data.forEach(order => {
        const created = new Date(order.created_at);
        if (isNaN(created.getTime())) return;
        const key = created.toISOString().slice(0, 10);
        if (!daily[key]) {
          daily[key] = { totalOrders: 0, totalRevenue: 0, paidRevenue: 0 };
        }
        const price = Number(order.price) || 0;
        daily[key].totalOrders++;
        daily[key].totalRevenue += price;
        if ((order.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞') === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß') {
          daily[key].paidRevenue += price;
        }

        const s = getServiceById(order.service_type);
        const serviceName = s ? s.title : order.service_type || '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ';
        serviceCounts[serviceName] = (serviceCounts[serviceName] || 0) + 1;
      });

      const dateKeys = [];
      for (let i = 0; i < days; i++) {
        const d = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
        const key = d.toISOString().slice(0, 10);
        dateKeys.push(key);
      }

      adminDailySummaryData = { daily, dateKeys };
      summaryDayButtons.innerHTML = '';

      dateKeys.forEach(key => {
        const label = formatThaiDateKey(key);
        const stats = daily[key] || { totalOrders: 0, paidRevenue: 0 };
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.dataset.dateKey = key;
        btn.className =
          'summary-day-btn rounded-2xl border px-3 py-2 text-xs bg-slate-800 border-slate-700 text-slate-200 hover:border-emerald-400/70';
        btn.innerHTML = `
          <div class="font-semibold">${label}</div>
          <div class="text-[11px] text-slate-400">
            ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå ${stats.totalOrders} ‚Ä¢ ‡∏ø${stats.paidRevenue}
          </div>
        `;
        summaryDayButtons.appendChild(btn);
      });

      adminSummarySelectedDateKey = dateKeys[0];
      updateAdminSummaryUIForDate();
      updateAdminCharts(dateKeys, daily, serviceCounts);

      if (summaryUpdatedAt) {
        summaryUpdatedAt.textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + new Date().toLocaleString('th-TH');
      }
    }

    // ---------- ADMIN: Render orders ----------

    async function openAdminOrderDetail(order) {
      if (!adminSlipModal) return;
      adminSlipModal.classList.remove('hidden');

      // Reset UI
      if (adminSlipError) {
        adminSlipError.textContent = '';
        adminSlipError.classList.add('hidden');
      }
      if (adminSlipHint) adminSlipHint.classList.add('hidden');
      if (adminSlipOpenLink) {
        adminSlipOpenLink.href = '#';
        adminSlipOpenLink.classList.add('hidden');
      }

      if (adminSlipOrderId) {
        adminSlipOrderId.textContent = order.id ?? '-';
      }

      const customerName = order.full_name || order.customer_name || '';
      if (adminSlipCustomer) {
        adminSlipCustomer.textContent = (order.customer_username || '') + (customerName ? ' ¬∑ ' + customerName : '');
      }

      if (adminSlipService) {
        const parts = [];
        if (order.service_type) parts.push('‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: ' + order.service_type);
        if (order.drum_size) parts.push('‡∏Ç‡∏ô‡∏≤‡∏î: ' + order.drum_size);
        if (order.detergent) parts.push('‡∏ô‡πâ‡∏≥‡∏¢‡∏≤: ' + order.detergent);
        if (order.pickup_type) parts.push('‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á: ' + order.pickup_type);
        adminSlipService.textContent = parts.length ? parts.join(' ¬∑ ') : '';
      }

      if (adminSlipStatus) {
        adminSlipStatus.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ' + (order.status || '-');
      }

      if (adminSlipPayment) {
        const paid = order.payment_status || '-';
        let priceText = '';
        if (typeof order.price === 'number') {
          priceText = order.price.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' ‡∏ö‡∏≤‡∏ó';
        } else if (order.price) {
          priceText = order.price + ' ‡∏ö‡∏≤‡∏ó';
        }
        adminSlipPayment.textContent = '‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ' + paid + (priceText ? ' ¬∑ ‡∏¢‡∏≠‡∏î ' + priceText : '');
      }

      if (adminSlipNote) {
        adminSlipNote.textContent = order.note ? '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ' + order.note : '';
      }

      // Prepare image element
      if (adminSlipImage) {
        adminSlipImage.src = '';
        adminSlipImage.classList.add('hidden');
        adminSlipImage.onload = null;
        adminSlipImage.onerror = null;
      }

      // If no slip in DB
      if (!order.payment_slip_url) {
        if (adminSlipNoImage) {
          adminSlipNoImage.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ';
          adminSlipNoImage.classList.remove('hidden');
        }
        return;
      }

      // Show loading state
      if (adminSlipNoImage) {
        adminSlipNoImage.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ...';
        adminSlipNoImage.classList.remove('hidden');
      }

      // Resolve URL (signed > raw)
      const displayUrl = await resolveSlipDisplayUrl(order.payment_slip_url);

      if (!displayUrl) {
        if (adminSlipNoImage) {
          adminSlipNoImage.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ';
          adminSlipNoImage.classList.remove('hidden');
        }
        if (adminSlipHint) adminSlipHint.classList.remove('hidden');
        return;
      }

      if (adminSlipOpenLink) {
        adminSlipOpenLink.href = displayUrl;
        adminSlipOpenLink.classList.remove('hidden');
      }

      if (!adminSlipImage) return;

      adminSlipImage.onload = () => {
        if (adminSlipNoImage) adminSlipNoImage.classList.add('hidden');
        adminSlipImage.classList.remove('hidden');
      };

      adminSlipImage.onerror = () => {
        adminSlipImage.classList.add('hidden');
        if (adminSlipNoImage) {
          adminSlipNoImage.textContent = '‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏•‡∏≠‡∏á‡∏Å‡∏î ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà‚Äù)';
          adminSlipNoImage.classList.remove('hidden');
        }
        if (adminSlipHint) adminSlipHint.classList.remove('hidden');
        if (adminSlipError) {
          adminSlipError.textContent = '‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢: bucket too ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà public ‡∏´‡∏£‡∏∑‡∏≠ Storage policy ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ role anon ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå';
          adminSlipError.classList.remove('hidden');
        }
      };

      adminSlipImage.src = displayUrl;
    }

async function renderAdminOrders() {
      if (!adminOrdersList) return;

      const statusFilter = adminStatusFilter ? adminStatusFilter.value : 'all';
      const payFilter = adminPaymentFilter ? adminPaymentFilter.value : 'all';
      const searchTerm = adminSearchInput ? adminSearchInput.value.trim().toLowerCase() : '';

      const orders = await fetchOrdersForAdmin(statusFilter);

      const customersMap = await fetchCustomersByUsernames(
        orders.map(o => o.customer_username)
      );

      let filtered = orders;
      if (payFilter !== 'all') {
        filtered = filtered.filter(o => (o.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞') === payFilter);
      }

      // ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ‡∏à‡∏≤‡∏Å‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å (all) ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô DB ‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏ö‡πÉ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ
      const now = new Date();
      const fiveDaysMs = 5 * 24 * 60 * 60 * 1000;
      let visible = filtered.filter(o => {
        const payStatus = o.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞';

        // ‡πÇ‡∏´‡∏°‡∏î‡∏î‡∏π "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å
        if (statusFilter === 'all' && o.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
          return false;
        }

        // ‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô") ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç 5 ‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô + ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß
        if (o.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' && payStatus === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß') {
          const created = new Date(o.created_at);
          if (!isNaN(created.getTime()) && (now - created) > fiveDaysMs) {
            return false; // ‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
          }
        }

        return true;
      });

      // Search
      if (searchTerm) {
        visible = visible.filter(o => {
          const cust = customersMap[o.customer_username] || {};
          const username = (o.customer_username || '').toLowerCase();
          const fullName = (cust.full_name || '').toLowerCase();
          const phone = (cust.phone || '').toLowerCase();
          return (
            username.includes(searchTerm) ||
            fullName.includes(searchTerm) ||
            phone.includes(searchTerm)
          );
        });
      }

      if (adminSummary) {
        if (!visible.length) {
          adminSummary.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
        } else {
          const totalOrders = visible.length;
          const sumApprox = visible.reduce((sum, o) => sum + (Number(o.price) || 0), 0);
          const pendingPayCount = visible.filter(
            o => (o.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞') !== '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß'
          ).length;
          adminSummary.textContent =
            `‡∏û‡∏ö ${totalOrders} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏ø${sumApprox}) ‚Ä¢ ` +
            `‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞/‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ${pendingPayCount} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå`;
        }
      }

      adminOrdersList.innerHTML = '';

      if (!visible.length) {
        adminOrdersList.innerHTML = '<p class="text-xs text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
        return;
      }

      visible.forEach(order => {
        const created = new Date(order.created_at);
        const createdText = isNaN(created.getTime())
          ? ''
          : created.toLocaleString('th-TH');

        const service = getServiceById(order.service_type);
        const serviceName = service ? service.title : order.service_type;
        const safeStatus = ORDER_STATUSES.includes(order.status) ? order.status : '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤';

        const paymentStatus = order.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞';
        const isPaid = paymentStatus === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß';

        const customer = customersMap[order.customer_username] || {};
        // attach customer info onto order object (used by modal)
        order.full_name = customer.full_name || order.full_name || '';
        order.customer_name = customer.full_name || order.customer_name || '';
        order.phone = customer.phone || order.phone || '';
        const fullName = customer.full_name || '';
        const phone = customer.phone || '';

        const statusOptionsHtml = ORDER_STATUSES.map(st => `
          <option value="${st}" ${st === safeStatus ? 'selected' : ''}>${st}</option>
        `).join('');

        const paymentOptionsHtml = PAYMENT_STATUSES.map(ps => `
          <option value="${ps}" ${ps === paymentStatus ? 'selected' : ''}>${ps}</option>
        `).join('');

        const payBadgeClass = isPaid
          ? 'border-emerald-200 bg-emerald-50 text-emerald-700'
          : (paymentStatus === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô'
            ? 'border-amber-200 bg-amber-50 text-amber-700'
            : 'border-rose-200 bg-rose-50 text-rose-700');

        let mapLinkHtml = '';
        if (order.pickup_lat && order.pickup_lng) {
          mapLinkHtml = `
            <a href="https://www.google.com/maps?q=${order.pickup_lat},${order.pickup_lng}"
               target="_blank"
               class="inline-flex items-center gap-1 text-[11px] text-sky-700 hover:underline mt-1">
              üó∫Ô∏è ‡∏î‡∏π‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            </a>
          `;
        }

        let slipHtml = '';
        if (order.payment_slip_url) {
          slipHtml = `
            <button
              type="button"
              data-role="admin-open-detail"
              class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100">
              <span class="text-xs">‚ãØ</span>
              <span>‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏™‡∏•‡∏¥‡∏õ</span>
            </button>
          `;
        } else {
          slipHtml = `
            <button
              type="button"
              data-role="admin-open-detail"
              class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-[11px] border border-slate-200 text-slate-500 hover:bg-slate-50">
              <span class="text-xs">‚ãØ</span>
              <span>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span>
            </button>
          `;
        }

        const div = document.createElement('div');
        div.className = 'border border-slate-200 rounded-2xl p-4 bg-slate-50';

        div.innerHTML = `
          <div class="flex items-center justify-between gap-2 mb-1">
            <div class="text-[13px]">
              <span class="font-semibold text-slate-800">${serviceName}</span>
              <span class="text-slate-400"> ‚Ä¢ </span>
              <span class="text-slate-600">@${order.customer_username}</span>
              ${fullName ? `<span class="text-slate-500"> (${fullName}${phone ? ' ¬∑ ' + phone : ''})</span>` : ''}
              <span class="text-slate-400 text-[10px] ml-1">#${order.id}</span>
            </div>
            <span class="text-[11px] text-slate-400">${createdText}</span>
          </div>
          <p class="text-xs text-slate-500 mb-1 truncate">
            ${order.note || ''}
          </p>
          <div class="flex flex-wrap items-center gap-1">
            ${mapLinkHtml}
            ${slipHtml}
          </div>
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mt-2">
            <div class="space-y-1 text-[11px]">
              <p>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: <span class="font-semibold text-slate-800">‡∏ø${order.price ?? '-'}</span></p>
              <p>
                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô:
                <span class="inline-flex items-center gap-1">
                  <select data-order-id="${order.id}"
                          class="admin-status-select border rounded-lg px-2 py-1.5 bg-white text-slate-700 text-xs">
                    ${statusOptionsHtml}
                  </select>
                </span>
              </p>
              <p>
                ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:
                <span class="inline-flex items-center px-2 py-0.5 rounded-full border text-[10px] ${payBadgeClass}">
                  ${paymentStatus}
                </span>
              </p>
            </div>
            <div class="flex flex-col items-stretch md:items-end gap-1 text-[11px]">
              <div class="flex flex-wrap items-center gap-2">
                <select data-pay-id="${order.id}"
                        class="admin-payment-select border rounded-lg px-2 py-1.5 bg-white text-slate-700 text-xs">
                  ${paymentOptionsHtml}
                </select>
                <button type="button"
                        data-pay-id="${order.id}"
                        class="admin-payment-update-btn inline-flex items-center gap-1 px-3 py-1.5 rounded-lg bg-emerald-500 text-white hover:bg-emerald-600">
                  ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                </button>
              </div>
              <button type="button"
                      data-order-id="${order.id}"
                      class="admin-update-btn inline-flex items-center gap-1 px-3 py-1.5 rounded-lg bg-amber-500 text-white hover:bg-amber-600">
                ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô
              </button>
              ${safeStatus === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? `
              <button type="button"
                      data-delete-id="${order.id}"
                      data-status="${safeStatus}"
                      class="admin-delete-btn inline-flex items-center gap-1 px-3 py-1.5 rounded-lg bg-rose-500 text-white hover:bg-rose-600">
                ‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏ó‡∏î‡∏•‡∏≠‡∏á)
              </button>
              ` : ''}
            </div>
          </div>
        `;
        adminOrdersList.appendChild(div);

        const moreBtn = div.querySelector('[data-role="admin-open-detail"]');
        if (moreBtn) {
          moreBtn.addEventListener('click', () => openAdminOrderDetail(order));
        }
      });
    }

    async function showAdminDashboardView() {
      if (!currentAdmin) {
        setView('adminLogin');
        return;
      }
      renderAdminHeader();
      setView('adminDashboard');

      // default tab
      try { setAdminTab('overview'); } catch (_) {}

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ
      await renderAdminOrders();
      await renderAdminSummary();

      // ‡∏Å‡∏£‡∏≤‡∏ü/‡∏≠‡∏¥‡∏ô‡πÑ‡∏ã‡∏ï‡πå (‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
      renderAdminCharts().catch(() => {});
      renderAdminCustomers().catch(() => {});
    }

    // ---------- Payment slip helpers ----------
    function resetPaymentSlipUI() {
      pendingSlipFile = null;
      if (paymentSlipInput) paymentSlipInput.value = '';
      if (paymentSlipPreview) paymentSlipPreview.classList.add('hidden');
      if (paymentSlipPreviewImg) paymentSlipPreviewImg.src = '';
    }

    
    // Bucket name for payment slips (Supabase Storage)
    const SLIP_BUCKET = 'too';

    // Extract object path from either:
    // - a plain path like "123/1700000000.jpg"
    // - a Supabase public URL ".../storage/v1/object/public/<bucket>/<path>"
    // - a Supabase signed URL  ".../storage/v1/object/sign/<bucket>/<path>?token=..."
    function extractSlipPath(slipRef) {
      if (!slipRef) return null;
      const s = String(slipRef);
      // If it already looks like a "folder/file" path
      if (!/^https?:\/\//i.test(s)) return s.replace(/^\/+/, '');
      try {
        const url = new URL(s);
        // Try to locate "/storage/v1/object/" then bucket + path
        const parts = url.pathname.split('/').filter(Boolean);
        const objectIdx = parts.findIndex(p => p === 'object');
        if (objectIdx === -1) return null;
        // Expected: .../object/(public|sign)/<bucket>/<path...>
        const mode = parts[objectIdx + 1];
        const bucket = parts[objectIdx + 2];
        if (!bucket) return null;
        if (bucket !== SLIP_BUCKET) return null;
        const pathParts = parts.slice(objectIdx + 3);
        return pathParts.join('/');
      } catch (e) {
        return null;
      }
    }

    async function createSlipSignedUrl(path, expiresInSec = 1800) {
      if (!path) return null;
      try {
        const { data, error } = await db.storage
          .from(SLIP_BUCKET)
          .createSignedUrl(path, expiresInSec);
        if (error) return null;
        return data && data.signedUrl ? data.signedUrl : null;
      } catch (e) {
        return null;
      }
    }

    // Resolve whatever is stored in orders.payment_slip_url into a URL we can actually render.
    // - If stored value is already a URL, we still try to refresh it as a signed URL (helps private buckets / expired links).
    async function resolveSlipDisplayUrl(slipRef) {
      if (!slipRef) return null;

      const raw = String(slipRef);
      const path = extractSlipPath(raw);

      // 1) Prefer a fresh signed URL if we can derive a path
      if (path) {
        const signed = await createSlipSignedUrl(path, 1800);
        if (signed) return signed;
      }

      // 2) Fallback to raw value (works for public buckets)
      return raw;
    }

    async function uploadPaymentSlip(orderId) {
      if (!pendingSlipFile) return null;
      try {
        const ext = (pendingSlipFile.name && pendingSlipFile.name.split('.').pop()) || 'jpg';
        const path = `${orderId}/${Date.now()}.${ext}`;

        const { error } = await db.storage
          .from(SLIP_BUCKET)
          .upload(path, pendingSlipFile, {
            cacheControl: '3600',
            upsert: true,
            contentType: pendingSlipFile.type || 'image/jpeg',
          });

        if (error) {
          console.error('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', error);
          return null;
        }

        // Prefer saving a signed URL (works even when bucket is private, as long as Storage policies allow it).
        // If signed URL creation is not allowed, fallback to public URL.
        const signed = await createSlipSignedUrl(path, 60 * 60 * 24 * 7); // 7 days
        if (signed) return signed;

        const publicRes = db.storage.from(SLIP_BUCKET).getPublicUrl(path);
        return publicRes && publicRes.data ? publicRes.data.publicUrl : null;
      } catch (err) {
        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ', err);
        return null;
      }
    }

    // ---------- Payment overlay ----------
    function openPaymentOverlay(order, service, total) {
      lastCreatedOrder = order;
      lastCreatedService = service;
      lastCreatedTotal = total;

      payServiceNameSpan.textContent = service.title;
      payOrderIdSpan.textContent = order.id;
      payAmountSpan.textContent = total;

      resetPaymentSlipUI();
      viewPayment.classList.remove('hidden');
    }

    function closePaymentOverlay() {
      viewPayment.classList.add('hidden');
    }

    async function finishPaymentFlow(markPaid) {
      if (!lastCreatedOrder) {
        closePaymentOverlay();
        resetPaymentSlipUI();
        return;
      }

      if (markPaid) {
        try {
          // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö)
          const slipUrl = await uploadPaymentSlip(lastCreatedOrder.id);

          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô" + ‡πÅ‡∏ô‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏•‡∏¥‡∏õ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          const updatePayload = { payment_status: '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô' };
          if (slipUrl) {
            updatePayload.payment_slip_url = slipUrl;
          }

          await db
            .from('orders')
            .update(updatePayload)
            .eq('id', lastCreatedOrder.id);

          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡πÉ‡∏ô customers (Demo logic: ‡∏ô‡∏±‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡πâ‡∏ß)
          if (currentUser) {
            const oldPoints = currentUser.points || 0;
            const newPoints = oldPoints - lastOrderPointsUsed + lastOrderPointsEarn;
            const updated = await updateCustomerPoints(currentUser.username, newPoints);
            currentUser = updated;
            updatePointsUI();
          }

          alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏î‡πÇ‡∏°‡πà)\n‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        } catch (e) {
          console.error(e);
          alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô/‡∏™‡∏•‡∏¥‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
      }

      closePaymentOverlay();
      resetPaymentSlipUI();
      serviceOrderForm.reset();
      orderQtyInput.value = '1';

      if (pickupPreview) {
        pickupPreview.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)';
      }
      if (mapWrapper) {
        mapWrapper.classList.add('hidden');
      }

      const firstService = SERVICES[0];
      if (firstService) setupOrderView(firstService);

      await renderOrdersHistory();
      setView('services');

      lastCreatedOrder = null;
      lastCreatedService = null;
      lastCreatedTotal = 0;
      lastOrderPointsEarn = 0;
      lastOrderPointsUsed = 0;
      lastOrderRedeemMode = 'none';
    }

    // ---------- Global functions (‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å HTML) ----------
    window.showLogin = function () {
      setView('login');
    };

    window.showRegister = function () {
      setView('register');
    };

    window.showAdminLogin = function () {
      if (currentAdmin) {
        showAdminDashboardView();
      } else {
        setView('adminLogin');
      }
    };

    window.logout = function () {
      currentUser = null;
      currentAdmin = null;
      favoriteAddresses = [];
      localStorage.removeItem('laundryCurrentUser');
      localStorage.removeItem('laundryAdminUser');
      renderUserHeader();
      renderAdminHeader();
      setView('login');
    };

    window.openServiceOrder = function (serviceId) {
      if (!currentUser) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå');
        setView('login');
        return;
      }
      const s = getServiceById(serviceId);
      if (!s) return;
      setupOrderView(s);
      setView('order');
    };

    window.switchOrderServiceTab = function (serviceId) {
      const s = getServiceById(serviceId);
      if (!s) return;
      setupOrderView(s);
    };

    window.backToServices = function () {
      if (currentUser) {
        setView('services');
        renderOrdersHistory();
      } else if (currentAdmin) {
        showAdminDashboardView();
      } else {
        setView('login');
      }
    };

    // ---------- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ----------
    if (btnOpenMap && mapWrapper) {
      btnOpenMap.addEventListener('click', () => {
        mapWrapper.classList.toggle('hidden');

        if (!mapWrapper.classList.contains('hidden') &&
            typeof google !== 'undefined' &&
            laundryMap) {
          google.maps.event.trigger(laundryMap, 'resize');
          if (laundryMarker && typeof laundryMarker.getPosition === 'function') {
            laundryMap.setCenter(laundryMarker.getPosition());
          }
        }
      });
    }

    
    // ------- Modals / quick actions ----------
    if (btnOpenOrdersModal) {
      btnOpenOrdersModal.addEventListener('click', () => openOrdersModal());
    }
    if (btnCloseOrdersModal) {
      btnCloseOrdersModal.addEventListener('click', () => closeOrdersModal());
    }
    if (ordersModal) {
      ordersModal.addEventListener('click', (e) => {
        // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î
        if (e.target === ordersModal) closeOrdersModal();
      });
    }
    if (ordersSearch) {
      ordersSearch.addEventListener('input', () => applyOrdersModalFilters());
    }
    if (ordersSort) {
      ordersSort.addEventListener('change', () => applyOrdersModalFilters());
    }

    if (btnAddressHelp && addressHelpModal) {
      btnAddressHelp.addEventListener('click', () => {
        addressHelpModal.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
      });
    }
    if (btnCloseAddressHelp && addressHelpModal) {
      btnCloseAddressHelp.addEventListener('click', () => {
        addressHelpModal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
      });
    }


    // ---------- Favorite address events ----------
    if (favoriteAddressSelect) {
      favoriteAddressSelect.addEventListener('change', () => {
        const idStr = favoriteAddressSelect.value;
        if (idStr) applyFavoriteAddressById(idStr);
      });
    }

    if (refreshFavoriteBtn) {
      refreshFavoriteBtn.addEventListener('click', () => {
        loadFavoriteAddresses();
      });
    }

    if (btnSaveAddress) {
      btnSaveAddress.addEventListener('click', async () => {
        if (!currentUser) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà');
          return;
        }
        const lat = pickupLatInput ? parseFloat(pickupLatInput.value || '0') : 0;
        const lng = pickupLngInput ? parseFloat(pickupLngInput.value || '0') : 0;
        if (!lat || !lng) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà');
          return;
        }
        const label = (saveAddressLabel && saveAddressLabel.value) || '‡∏´‡∏≠';
        const nickname = (saveAddressName && saveAddressName.value.trim()) || '';

        try {
          const isDefault = !!(document.getElementById('saveAddressDefault') && document.getElementById('saveAddressDefault').checked);
          await saveFavoriteAddress(label, nickname, lat, lng, isDefault);
          alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
          if (saveAddressName) saveAddressName.value = '';
          await loadFavoriteAddresses();
          await updateDefaultAddressUI();
        } catch (e) {
          console.error(e);
          alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
      });
    }

    // ---------- Form handlers: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ----------
    if (loginForm) {
      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = loginUsernameInput.value.trim();
        const password = loginPasswordInput.value;

        // reset invalid state
        setInvalid(loginUsernameInput, false);
        setInvalid(loginPasswordInput, false);

        setBtnLoading(loginSubmitBtn, true);

        try {
          const user = await loginCustomer(username, password);

          if (!user) {
            showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error', {
              subtitle: '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î ‚Äú‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‚Äù ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ'
            });
            setInvalid(loginUsernameInput, true);
            setInvalid(loginPasswordInput, true);
            shake(loginCard);
            return;
          }

          currentUser = user;
          localStorage.setItem('laundryCurrentUser', user.username);

          showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${user.full_name || user.username}`, 'success', {
            subtitle: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‚Ä¶'
          });

          renderUserHeader();
          renderServiceCards();
          renderOrderTabs();
          await loadFavoriteAddresses();
          setView('services');
          await renderOrdersHistory();
        } catch (err) {
          console.error(err);
          showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error', {
            subtitle: '‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á'
          });
          shake(loginCard);
        } finally {
          setBtnLoading(loginSubmitBtn, false);
        }
      });
    }

    if (registerForm) {
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fullName = document.getElementById('regFullName').value.trim();
        const username = document.getElementById('regUsername').value.trim();
        const phone = document.getElementById('regPhone').value.trim();
        const password = document.getElementById('regPassword').value;
        const password2 = document.getElementById('regPassword2').value;

        if (password !== password2) {
          alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
          return;
        }

        try {
          await registerCustomer(fullName, username, phone, password);
          alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
          registerForm.reset();
          loginUsernameInput.value = username;
          setView('login');
        } catch (err) {
          if (err && err.code === '23505') {
            alert('‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô');
          } else {
            alert('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
          }
        }
      });
    }

    if (btnQtyMinus && btnQtyPlus && orderQtyInput) {
      btnQtyMinus.addEventListener('click', () => {
        const val = Math.max(parseInt(orderQtyInput.value || '1', 10) - 1, 1);
        orderQtyInput.value = String(val);
        updateOrderPrice();
      });
      btnQtyPlus.addEventListener('click', () => {
        const val = Math.max(parseInt(orderQtyInput.value || '1', 10) + 1, 1);
        orderQtyInput.value = String(val);
        updateOrderPrice();
      });
      orderQtyInput.addEventListener('input', () => {
        if (!orderQtyInput.value) orderQtyInput.value = '1';
        updateOrderPrice();
      });
    }

    if (orderPickupTimeInput) {
      orderPickupTimeInput.addEventListener('change', () => {
        updateOrderPrice();
      });
    }

    if (redeemModeInputs && redeemModeInputs.length) {
      redeemModeInputs.forEach(radio => {
        radio.addEventListener('change', () => {
          updateOrderPrice();
        });
      });
    }

    if (serviceOrderForm) {
      serviceOrderForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!currentUser) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå');
          return;
        }
        const service = getServiceById(currentServiceId);
        if (!service) {
          alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');
          return;
        }

        const calc = calculateTotalPrice(service);
        const total = calc.total;
        const qty = calc.qty;

        const checked = viewOrder.querySelectorAll('.addon-toggle:checked');
        const addonNames = [];
        checked.forEach(cb => {
          const n = cb.dataset.addonName || cb.dataset.addonId;
          if (n) addonNames.push(n);
        });

        const pickupLat = pickupLatInput ? pickupLatInput.value : '';
        const pickupLng = pickupLngInput ? pickupLngInput.value : '';
        const locationText = pickupLat && pickupLng
          ? `‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤: ${pickupLat}, ${pickupLng}`
          : '';

        const pointsInfoText = `‡πÅ‡∏ï‡πâ‡∏°‡πÉ‡∏ä‡πâ: ${calc.pointsUsed} ‡πÅ‡∏ï‡πâ‡∏° | ‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ: ${calc.pointsEarn} ‡πÅ‡∏ï‡πâ‡∏°`;

        const orderInput = {
          serviceType: service.id,
          quantity: qty,
          unitLabel: service.unitLabel,
          addons: addonNames,
          note: orderNoteInput.value.trim(),
          pickupTime: orderPickupTimeInput.value || null,
          totalPrice: total,
          locationText,
          pickupLat: pickupLat || null,
          pickupLng: pickupLng || null,
          pointsEarn: calc.pointsEarn,
          pointsUsed: calc.pointsUsed,
          pointsInfoText
        };

        try {
          const created = await createOrderForCurrentUser(orderInput);
          openPaymentOverlay(created, service, total);
        } catch (err) {
          console.error(err);
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        }
      });
    }

    // ---------- Form handlers: ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ----------
    if (adminLoginForm) {
      adminLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = adminUsernameInput.value.trim();
        const password = adminPasswordInput.value;

        try {
          const admin = await loginAdmin(username, password);
          if (!admin) {
            alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            return;
          }
          currentAdmin = admin;
          localStorage.setItem('laundryAdminUser', admin.username);
          renderAdminHeader();
          adminLoginForm.reset();
          await showAdminDashboardView();
        } catch {
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
        }
      });
    }

    if (adminReloadBtn) {
      adminReloadBtn.addEventListener('click', () => {
        renderAdminOrders();
        renderAdminSummary();
      });
    }

    if (adminStatusFilter) {
      adminStatusFilter.addEventListener('change', () => {
        renderAdminOrders();
      });
    }

    if (adminPaymentFilter) {
      adminPaymentFilter.addEventListener('change', () => {
        renderAdminOrders();
      });
    }

    if (adminSearchInput) {
      adminSearchInput.addEventListener('input', () => {
        renderAdminOrders();
      });
    }

    if (adminOrdersList) {
      adminOrdersList.addEventListener('click', async (e) => {
        if (e.target.classList.contains('admin-update-btn')) {
          const orderId = e.target.dataset.orderId;
          const select = adminOrdersList.querySelector(`select[data-order-id="${orderId}"]`);
          if (!select) return;
          const newStatus = select.value;
          try {
            await updateOrderStatus(orderId, newStatus);
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            await renderAdminOrders();
            await renderAdminSummary();
          } catch {
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          }
        }

        if (e.target.classList.contains('admin-payment-update-btn')) {
          const orderId = e.target.dataset.payId;
          const selectPay = adminOrdersList.querySelector(`select[data-pay-id="${orderId}"]`);
          if (!selectPay) return;
          const newPayStatus = selectPay.value;
          try {
            await updateOrderPaymentStatus(orderId, newPayStatus);
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            await renderAdminOrders();
            await renderAdminSummary();
          } catch {
            alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          }
        }

        if (e.target.classList.contains('admin-delete-btn')) {
          const orderId = e.target.dataset.deleteId;
          const status = e.target.dataset.status;
          if (status !== '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') {
            alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
            return;
          }
          if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ')) {
            return;
          }
          try {
            await deleteOrder(orderId);
            alert('‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            await renderAdminOrders();
            await renderAdminSummary();
          } catch {
            alert('‡∏•‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          }
        }
      });
    }

    // ---------- Summary day button click ----------
    if (summaryDayButtons) {
      summaryDayButtons.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-date-key]');
        if (!btn || !adminDailySummaryData) return;
        adminSummarySelectedDateKey = btn.dataset.dateKey;
        updateAdminSummaryUIForDate();
      });
    }

    // ---------- Payment overlay listeners ----------
    if (paymentCloseBtn) {
      paymentCloseBtn.addEventListener('click', () => {
        finishPaymentFlow(false);
      });
    }

    if (paymentLaterBtn) {
      paymentLaterBtn.addEventListener('click', () => {
        finishPaymentFlow(false);
      });
    }

    if (paymentConfirmBtn) {
      paymentConfirmBtn.addEventListener('click', async () => {
        await finishPaymentFlow(true);
      });
    }

    // ---------- ‡∏•‡∏π‡∏Å‡πÄ‡∏•‡πà‡∏ô: ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Login ----------
    if (detergentPills && detergentPills.length && detergentDescription) {
      const info = {
        fresh: {
          title: 'Fresh Campus ‚Äì ‡∏´‡∏≠‡∏°‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏≠',
          desc: '‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ä‡∏∏‡∏î‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏•‡∏î‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏≠‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏Å‡πÉ‡∏ô‡∏´‡∏≠/‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î.'
        },
        cozy: {
          title: 'Cozy Cotton ‚Äì ‡∏ô‡∏∏‡πà‡∏°‡∏ü‡∏π‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏≠‡∏ô & ‡∏ú‡πâ‡∏≤‡∏´‡πà‡∏°',
          desc: '‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏ú‡πâ‡∏≤‡∏ù‡πâ‡∏≤‡∏¢‡∏≠‡πà‡∏≠‡∏ô ‡πÜ ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏≠‡∏ô ‡∏ú‡πâ‡∏≤‡∏õ‡∏π‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô ‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏ú‡πâ‡∏≤‡∏Ç‡∏ô‡∏´‡∏ô‡∏π ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô‡∏´‡∏≠‡∏´‡∏≠‡∏°‡∏ô‡∏∏‡πà‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ.'
        },
        sensitive: {
          title: 'Sensitive Calm ‚Äì ‡∏™‡∏π‡∏ï‡∏£‡πÑ‡∏£‡πâ‡∏ô‡πâ‡∏≥‡∏´‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢',
          desc: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡∏´‡∏≠‡∏° ‡∏•‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏∞‡∏Ñ‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏∑‡∏≠‡∏á ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏•‡πá‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏ï‡∏¥‡∏î‡∏ú‡πâ‡∏≤‡πÅ‡∏£‡∏á ‡πÜ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ.'
        }
      };

      function setDetergent(kind) {
        const data = info[kind] || info.fresh;
        detergentPills.forEach(btn => {
          if (btn.dataset.detergent === kind) {
            btn.classList.add('detergent-pill-active');
          } else {
            btn.classList.remove('detergent-pill-active');
          }
        });
        detergentDescription.innerHTML = `
          <p class="font-semibold text-slate-800 mb-0.5">${data.title}</p>
          <p class="text-slate-600">${data.desc}</p>
        `;
      }

      detergentPills.forEach(btn => {
        btn.addEventListener('click', () => {
          const kind = btn.dataset.detergent || 'fresh';
          setDetergent(kind);
        });
      });

      // default
      setDetergent('fresh');
    }

    // ---------- Initial load ----------
    renderServiceCards();
    renderOrderTabs();

    try {
      const [user, admin] = await Promise.all([
        loadCurrentUserFromLocal(),
        loadCurrentAdminFromLocal()
      ]);

      if (user) {
        currentUser = user;
        renderUserHeader();
        await loadFavoriteAddresses();
        setView('services');
        await renderOrdersHistory();
      } else if (admin) {
        currentAdmin = admin;
        renderAdminHeader();
        await showAdminDashboardView();
      } else {
        setView('login');
      }
    } catch {
      setView('login');
    }
  

    // ============================
    // NEW: Notifications / Presets / Address Book / Re-order
    // ============================

    function userKey(prefix) {
      const u = currentUser && currentUser.username ? currentUser.username : 'guest';
      return `${prefix}:${u}`;
    }

    // -------- Notifications --------
    function loadNotifs() {
      try {
        const raw = localStorage.getItem(userKey('laundryNotifs'));
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }

    function saveNotifs(arr) {
      try { localStorage.setItem(userKey('laundryNotifs'), JSON.stringify(arr || [])); } catch (e) {}
    }

    function loadStatusCache() {
      try {
        const raw = localStorage.getItem(userKey('laundryOrderStatusCache'));
        const obj = raw ? JSON.parse(raw) : {};
        return obj && typeof obj === 'object' ? obj : {};
      } catch (e) {
        return {};
      }
    }

    function saveStatusCache(obj) {
      try { localStorage.setItem(userKey('laundryOrderStatusCache'), JSON.stringify(obj || {})); } catch (e) {}
    }

    function updateNotifBadge() {
      if (!notifBadge) return;
      const notifs = loadNotifs();
      const unread = notifs.filter(n => !n.read).length;
      if (unread > 0) {
        notifBadge.textContent = String(unread);
        notifBadge.classList.remove('hidden');
      } else {
        notifBadge.classList.add('hidden');
      }
      if (notifHint) {
        notifHint.textContent = notifs.length ? `‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${notifs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà';
      }
    }

    function renderNotifList() {
      if (!notifList) return;
      const notifs = loadNotifs().slice().sort((a,b) => (b.ts||0)-(a.ts||0));
      notifList.innerHTML = '';

      if (!notifs.length) {
        notifList.innerHTML = '<p class="text-xs text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>';
        return;
      }

      notifs.forEach(n => {
        const dt = n.ts ? new Date(n.ts) : null;
        const dtText = dt && !isNaN(dt.getTime()) ? dt.toLocaleString('th-TH') : '';
        const div = document.createElement('div');
        div.className = `rounded-2xl border ${n.read ? 'border-slate-200 bg-slate-50/60' : 'border-sky-200 bg-sky-50/60'} p-3`;
        div.innerHTML = `
          <div class="flex items-start justify-between gap-2">
            <div>
              <p class="text-sm font-semibold text-slate-900">${escapeHtml(n.title || '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï')}</p>
              <p class="text-[11px] text-slate-500 mt-0.5">${escapeHtml(n.body || '')}</p>
              <p class="text-[10px] text-slate-400 mt-1">${escapeHtml(dtText)}</p>
            </div>
            <div class="flex flex-col gap-2">
              ${n.orderId ? `<button type="button" class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-white border border-slate-200 hover:bg-slate-50" data-action="focus-order" data-order-id="${n.orderId}">‡∏î‡∏π</button>` : ''}
              <button type="button" class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-700" data-action="mark-read" data-notif-id="${escapeHtml(String(n.id||''))}">‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
            </div>
          </div>
        `;
        notifList.appendChild(div);
      });
    }

    function addNotif(entry) {
      const notifs = loadNotifs();
      notifs.push(entry);
      // keep last 50
      const trimmed = notifs.slice(-50);
      saveNotifs(trimmed);
      updateNotifBadge();
    }

    function detectOrderStatusChanges(orders) {
      if (!currentUser || !orders || !orders.length) return;

      const cache = loadStatusCache();
      const hadCache = Object.keys(cache).length > 0;

      const nextCache = { ...cache };
      orders.forEach(o => {
        const id = String(o.id ?? '');
        if (!id) return;
        const status = (o.status || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤');
        if (hadCache && nextCache[id] && nextCache[id] !== status) {
          const service = getServiceById(o.service_type);
          const serviceName = service ? service.title : (o.service_type || '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå');
          const title = `‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${id} ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`;
          const body = `${serviceName} ‚Üí ${status}`;
          addNotif({ id: `${Date.now()}-${id}`, ts: Date.now(), orderId: id, title, body, read: false });
          showToast(`üîî ${body}`, 'info', { duration: 3200 });
        }
        nextCache[id] = status;
      });

      saveStatusCache(nextCache);
    }

    function openNotifModal() {
      if (!notifModal) return;
      notifModal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      // mark all read
      const notifs = loadNotifs().map(n => ({...n, read: true}));
      saveNotifs(notifs);
      renderNotifList();
      updateNotifBadge();
    }
    function closeNotifModal() {
      if (!notifModal) return;
      notifModal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
      updateNotifBadge();
    }

    if (btnOpenNotif && notifModal) {
      btnOpenNotif.addEventListener('click', () => {
        renderNotifList();
        openNotifModal();
      });
    }
    if (btnCloseNotif) btnCloseNotif.addEventListener('click', closeNotifModal);
    if (btnClearNotif) {
      btnClearNotif.addEventListener('click', () => {
        saveNotifs([]);
        renderNotifList();
        updateNotifBadge();
        showToast('‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
      });
    }
    if (notifModal) {
      notifModal.addEventListener('click', (e) => {
        if (e.target === notifModal) closeNotifModal();
      });
    }
    if (notifList) {
      notifList.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        if (action === 'focus-order') {
          const id = btn.getAttribute('data-order-id') || '';
          closeNotifModal();
          if (id) openOrdersModal(id);
        } else if (action === 'mark-read') {
          const nid = btn.getAttribute('data-notif-id');
          const notifs = loadNotifs().map(n => n.id === nid ? ({...n, read: true}) : n);
          saveNotifs(notifs);
          renderNotifList();
          updateNotifBadge();
        }
      });
    }

    // -------- Address Book modal --------
    async function refreshAddressBookList() {
      if (!addressBookList) return;
      if (!currentUser) {
        addressBookList.innerHTML = '<p class="text-xs text-slate-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô</p>';
        return;
      }
      favoriteAddresses = await fetchFavoriteAddresses();
      renderFavoriteAddressesSelect();
      await updateDefaultAddressUI();

      if (!favoriteAddresses.length) {
        addressBookList.innerHTML = '<p class="text-xs text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>';
        return;
      }

      // Determine default (best-effort)
      let defaultId = null;
      const def = await fetchDefaultAddressForCurrentUser();
      if (def && def.id != null) defaultId = String(def.id);

      addressBookList.innerHTML = '';
      favoriteAddresses.forEach(addr => {
        const isDefault = defaultId && String(addr.id) === defaultId;
        const nickname = addr.nickname ? ` - ${addr.nickname}` : '';
        const lat = addr.lat ?? addr.pickup_lat ?? null;
        const lng = addr.lng ?? addr.pickup_lng ?? null;

        const div = document.createElement('div');
        div.className = 'rounded-2xl border border-slate-200 bg-white p-3';
        div.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-sm font-semibold text-slate-900">
                ${escapeHtml(addr.label || '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà')}${escapeHtml(nickname)}
                ${isDefault ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold bg-emerald-50 text-emerald-700 border border-emerald-100">‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>' : ''}
              </p>
              <p class="text-[11px] text-slate-500 mt-0.5">‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${lat ?? '-'}, ${lng ?? '-'}</p>
            </div>
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
              <button type="button"
                      class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-white border border-slate-200 hover:bg-slate-50"
                      data-action="use-address"
                      data-address-id="${addr.id}">
                ‡πÉ‡∏ä‡πâ
              </button>
              <button type="button"
                      class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-700"
                      data-action="set-default"
                      data-address-id="${addr.id}">
                ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
              </button>
              <button type="button"
                      class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-rose-50 border border-rose-100 hover:bg-rose-100 text-rose-700"
                      data-action="delete-address"
                      data-address-id="${addr.id}">
                ‡∏•‡∏ö
              </button>
            </div>
          </div>
        `;
        addressBookList.appendChild(div);
      });
    }

    function openAddressBookModal() {
      if (!addressBookModal) return;
      addressBookModal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      refreshAddressBookList();
    }
    function closeAddressBookModal() {
      if (!addressBookModal) return;
      addressBookModal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }

    if (btnOpenAddressBook) btnOpenAddressBook.addEventListener('click', openAddressBookModal);
    if (btnCloseAddressBook) btnCloseAddressBook.addEventListener('click', closeAddressBookModal);
    if (addressBookModal) {
      addressBookModal.addEventListener('click', (e) => { if (e.target === addressBookModal) closeAddressBookModal(); });
    }

    if (addressBookList) {
      addressBookList.addEventListener('click', async (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        const id = btn.getAttribute('data-address-id');
        if (!id) return;

        if (action === 'use-address') {
          // apply to order view inputs (if available)
          const addr = favoriteAddresses.find(a => String(a.id) === String(id));
          if (addr && pickupLatInput && pickupLngInput) {
            pickupLatInput.value = String(addr.lat ?? addr.pickup_lat ?? '');
            pickupLngInput.value = String(addr.lng ?? addr.pickup_lng ?? '');
            if (pickupPreview) {
              const nickname = addr.nickname ? ` (${addr.nickname})` : '';
              pickupPreview.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${addr.label}${nickname}`;
            }
            if (favoriteAddressSelect) favoriteAddressSelect.value = String(id);
            showToast('‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success');
          } else {
            showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö input ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô', 'error');
          }
          closeAddressBookModal();
        }

        if (action === 'set-default') {
          if (!currentUser) return;
          // best-effort: set is_default if column exists
          try {
            await db.from('customer_addresses')
              .update({ is_default: false })
              .eq('customer_username', currentUser.username);

            const { error } = await db.from('customer_addresses')
              .update({ is_default: true })
              .eq('id', Number(id));
            if (error) throw error;

            showToast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
            await refreshAddressBookList();
          } catch (err) {
            showToast('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå is_default)', 'error');
            await refreshAddressBookList();
          }
        }

        if (action === 'delete-address') {
          if (!confirm('‡∏•‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;
          try {
            const { error } = await db.from('customer_addresses').delete().eq('id', Number(id));
            if (error) throw error;
            showToast('‡∏•‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'success');
            await refreshAddressBookList();
          } catch (err) {
            showToast('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö RLS/Policy)', 'error');
          }
        }
      });
    }

    // Also: make favoriteAddressSelect actually apply to pickup coordinates
    if (favoriteAddressSelect) {
      favoriteAddressSelect.addEventListener('change', () => {
        const id = favoriteAddressSelect.value || '';
        if (!id) return;
        const addr = favoriteAddresses.find(a => String(a.id) === String(id));
        if (!addr) return;
        if (pickupLatInput) pickupLatInput.value = String(addr.lat ?? addr.pickup_lat ?? '');
        if (pickupLngInput) pickupLngInput.value = String(addr.lng ?? addr.pickup_lng ?? '');
        if (pickupPreview) {
          const nickname = addr.nickname ? ` (${addr.nickname})` : '';
          pickupPreview.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${addr.label}${nickname}`;
        }
        showToast('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÅ‡∏•‡πâ‡∏ß', 'success', { duration: 1600 });
      });
    }

    // -------- Presets --------
    function loadPresets() {
      try {
        const raw = localStorage.getItem(userKey('laundryPresets'));
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      } catch (e) {
        return [];
      }
    }
    function savePresets(arr) {
      try { localStorage.setItem(userKey('laundryPresets'), JSON.stringify(arr || [])); } catch (e) {}
    }

    function refreshPresetSelect() {
      if (!presetSelect) return;
      const presets = loadPresets();
      presetSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï --</option>';
      presets.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.id;
        const service = getServiceById(p.serviceType);
        const serviceName = service ? service.title : (p.serviceType || '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');
        opt.textContent = `${p.name} ‚Ä¢ ${serviceName}`;
        presetSelect.appendChild(opt);
      });
    }

    function collectOrderDraftFromUI() {
      const service = currentServiceId;
      const qty = orderQtyInput ? Number(orderQtyInput.value || 1) : 1;
      const note = orderNoteInput ? (orderNoteInput.value || '') : '';
      const pickupTime = orderPickupTimeInput ? (orderPickupTimeInput.value || '') : '';
      const pickupLat = pickupLatInput ? (pickupLatInput.value || '') : '';
      const pickupLng = pickupLngInput ? (pickupLngInput.value || '') : '';
      const addons = Array.from(viewOrder.querySelectorAll('.addon-toggle'))
        .filter(cb => cb.checked)
        .map(cb => ({ id: cb.dataset.addonId, name: cb.dataset.addonName }));
      return { serviceType: service, quantity: qty, note, pickupTime, pickupLat, pickupLng, addons };
    }

    function formatLocalDatetimeValue(isoStr) {
      if (!isoStr) return '';
      const d = new Date(isoStr);
      if (isNaN(d.getTime())) return '';
      const pad = (n) => String(n).padStart(2,'0');
      const yyyy = d.getFullYear();
      const mm = pad(d.getMonth()+1);
      const dd = pad(d.getDate());
      const hh = pad(d.getHours());
      const mi = pad(d.getMinutes());
      return `${yyyy}-${mm}-${dd}T${hh}:${mi}`;
    }

    function applyDraftToOrderView(draft) {
      if (!draft) return;

      if (orderQtyInput && draft.quantity) orderQtyInput.value = String(draft.quantity);
      if (orderNoteInput && typeof draft.note === 'string') orderNoteInput.value = draft.note;

      if (orderPickupTimeInput) {
        // draft.pickupTime might already be datetime-local or ISO
        const v = draft.pickupTime.includes('T') && draft.pickupTime.length <= 16
          ? draft.pickupTime
          : formatLocalDatetimeValue(draft.pickupTime);
        if (v) orderPickupTimeInput.value = v;
      }

      if (pickupLatInput && draft.pickupLat) pickupLatInput.value = String(draft.pickupLat);
      if (pickupLngInput && draft.pickupLng) pickupLngInput.value = String(draft.pickupLng);

      if (pickupPreview && (draft.pickupLat || draft.pickupLng)) {
        pickupPreview.textContent = `‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏£‡∏±‡∏ö‡∏ú‡πâ‡∏≤: ${draft.pickupLat || '-'}, ${draft.pickupLng || '-'}`;
      }

      // addons: match by id or name
      const wants = (draft.addons || []).map(a => (typeof a === 'string' ? a : (a.id || a.name))).filter(Boolean);
      const wantsNames = new Set((draft.addons || []).map(a => typeof a === 'string' ? a : a.name).filter(Boolean));
      const wantsIds = new Set((draft.addons || []).map(a => typeof a === 'string' ? null : a.id).filter(Boolean));

      const cbs = Array.from(viewOrder.querySelectorAll('.addon-toggle'));
      cbs.forEach(cb => {
        const id = cb.dataset.addonId;
        const name = cb.dataset.addonName;
        cb.checked = wantsIds.has(id) || wantsNames.has(name) || wants.includes(id) || wants.includes(name);
      });

      updateOrderPrice();
      showToast('‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï/‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success', { duration: 2000 });
    }

    function openPresetsModal() {
      if (!presetsModal) return;
      presetsModal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      renderPresetsList();
    }
    function closePresetsModal() {
      if (!presetsModal) return;
      presetsModal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
      refreshPresetSelect();
    }

    function renderPresetsList() {
      if (!presetsList) return;
      const presets = loadPresets().slice().sort((a,b) => (b.ts||0)-(a.ts||0));
      presetsList.innerHTML = '';
      if (!presets.length) {
        presetsList.innerHTML = '<p class="text-xs text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</p>';
        return;
      }
      presets.forEach(p => {
        const service = getServiceById(p.serviceType);
        const serviceName = service ? service.title : (p.serviceType || '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');
        const div = document.createElement('div');
        div.className = 'rounded-2xl border border-slate-200 bg-white p-3';
        div.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-sm font-semibold text-slate-900">${escapeHtml(p.name || '‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï')}</p>
              <p class="text-[11px] text-slate-500 mt-0.5">${escapeHtml(serviceName)} ‚Ä¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${p.quantity || 1}</p>
              <p class="text-[11px] text-slate-500 mt-0.5">${(p.addons && p.addons.length) ? `‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°: ${escapeHtml(p.addons.map(a => a.name || a).join(', '))}` : '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°: -'}</p>
            </div>
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
              <button type="button" class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-white border border-slate-200 hover:bg-slate-50"
                      data-action="apply-preset" data-preset-id="${p.id}">‡πÉ‡∏ä‡πâ</button>
              <button type="button" class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-slate-100 border border-slate-200 hover:bg-slate-200 text-slate-700"
                      data-action="rename-preset" data-preset-id="${p.id}">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠</button>
              <button type="button" class="rounded-xl px-3 py-2 text-[11px] font-semibold bg-rose-50 border border-rose-100 hover:bg-rose-100 text-rose-700"
                      data-action="delete-preset" data-preset-id="${p.id}">‡∏•‡∏ö</button>
            </div>
          </div>
        `;
        presetsList.appendChild(div);
      });
    }

    function savePresetFromDraft(draft, nameHint = '') {
      if (!currentUser) { showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô', 'error'); return; }
      if (!draft || !draft.serviceType) { showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', 'error'); return; }

      const presets = loadPresets();
      const id = `${Date.now()}-${Math.random().toString(16).slice(2)}`;
      const service = getServiceById(draft.serviceType);
      const defName = nameHint || (service ? `‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï: ${service.title}` : '‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà');

      const name = (presetNameInput && presetNameInput.value.trim()) ? presetNameInput.value.trim() : defName;

      presets.push({
        id,
        ts: Date.now(),
        name,
        serviceType: draft.serviceType,
        quantity: draft.quantity || 1,
        note: draft.note || '',
        pickupTime: draft.pickupTime || '',
        pickupLat: draft.pickupLat || '',
        pickupLng: draft.pickupLng || '',
        addons: draft.addons || []
      });

      savePresets(presets.slice(-20));
      if (presetNameInput) presetNameInput.value = '';
      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
      refreshPresetSelect();
      renderPresetsList();
    }

    function applyPresetById(pid) {
      const presets = loadPresets();
      const p = presets.find(x => x.id === pid);
      if (!p) { showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', 'error'); return; }

      // If service differs, open correct service order first
      const svc = p.serviceType;
      if (svc && svc !== currentServiceId) {
        window.openServiceOrder(svc);
        setTimeout(() => applyDraftToOrderView(p), 50);
      } else {
        applyDraftToOrderView(p);
      }
    }

    if (btnManagePresets) btnManagePresets.addEventListener('click', openPresetsModal);
    if (btnClosePresets) btnClosePresets.addEventListener('click', closePresetsModal);
    if (presetsModal) presetsModal.addEventListener('click', (e) => { if (e.target === presetsModal) closePresetsModal(); });

    if (btnSavePreset) {
      btnSavePreset.addEventListener('click', () => {
        const draft = collectOrderDraftFromUI();
        savePresetFromDraft(draft);
      });
    }
    if (btnApplyPreset) {
      btnApplyPreset.addEventListener('click', () => {
        if (!presetSelect || !presetSelect.value) { showToast('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡πà‡∏≠‡∏ô', 'info'); return; }
        applyPresetById(presetSelect.value);
      });
    }
    if (btnCreatePresetFromCurrent) {
      btnCreatePresetFromCurrent.addEventListener('click', () => {
        const draft = collectOrderDraftFromUI();
        savePresetFromDraft(draft);
      });
    }

    if (presetsList) {
      presetsList.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        const pid = btn.getAttribute('data-preset-id');
        if (!pid) return;
        if (action === 'apply-preset') {
          closePresetsModal();
          applyPresetById(pid);
        } else if (action === 'rename-preset') {
          const presets = loadPresets();
          const p = presets.find(x => x.id === pid);
          if (!p) return;
          const nm = prompt('‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï', p.name || '');
          if (!nm) return;
          p.name = nm.trim();
          savePresets(presets);
          renderPresetsList();
          refreshPresetSelect();
        } else if (action === 'delete-preset') {
          if (!confirm('‡∏•‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;
          const presets = loadPresets().filter(x => x.id !== pid);
          savePresets(presets);
          renderPresetsList();
          refreshPresetSelect();
        }
      });
    }

    // Refresh preset select when user logs in/out
    const _renderUserHeaderOriginal = renderUserHeader;
    renderUserHeader = function() {
      _renderUserHeaderOriginal();
      refreshPresetSelect();
      updateNotifBadge();
    };

    // -------- Re-order from history --------
    function parseOrderNoteToDraft(noteText) {
      const draft = { quantity: 1, addons: [], note: '' };
      if (!noteText) return draft;
      const parts = String(noteText).split('|').map(s => s.trim());
      parts.forEach(p => {
        if (p.startsWith('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:')) {
          const m = p.match(/‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:\s*([0-9]+(?:\.[0-9]+)?)\s*(.*)$/);
          if (m) {
            draft.quantity = Number(m[1]) || 1;
          }
        } else if (p.startsWith('‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°:')) {
          const s = p.replace('‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°:', '').trim();
          if (s) draft.addons = s.split(',').map(x => x.trim()).filter(Boolean).map(name => ({ name }));
        } else if (p.startsWith('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:')) {
          draft.note = p.replace('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:', '').trim();
        }
      });
      return draft;
    }

    function reorderFromOrder(order) {
      if (!order) return;
      const serviceType = order.service_type;
      if (!serviceType) { showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ', 'error'); return; }

      const parsed = parseOrderNoteToDraft(order.note || '');
      const draft = {
        serviceType,
        quantity: parsed.quantity || 1,
        addons: parsed.addons || [],
        note: parsed.note || '',
        pickupTime: order.pickup_time || '',
        pickupLat: order.pickup_lat || '',
        pickupLng: order.pickup_lng || ''
      };

      window.openServiceOrder(serviceType);
      setTimeout(() => applyDraftToOrderView(draft), 60);
    }

    async function presetFromOrder(order) {
      if (!order) return;
      const serviceType = order.service_type;
      const parsed = parseOrderNoteToDraft(order.note || '');
      const draft = {
        serviceType,
        quantity: parsed.quantity || 1,
        addons: parsed.addons || [],
        note: parsed.note || '',
        pickupTime: order.pickup_time || '',
        pickupLat: order.pickup_lat || '',
        pickupLng: order.pickup_lng || ''
      };
      const service = getServiceById(serviceType);
      const nameHint = service ? `‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏à‡∏≤‡∏Å #${order.id} (${service.title})` : `‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏à‡∏≤‡∏Å #${order.id}`;
      savePresetFromDraft(draft, nameHint);
      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    function findOrderInCaches(orderId) {
      const id = String(orderId);
      const inAll = (ordersAllCache || []).find(o => String(o.id) === id);
      if (inAll) return inAll;
      const inHist = (ordersHistoryCache || []).find(o => String(o.id) === id);
      if (inHist) return inHist;
      return null;
    }

    if (ordersList) {
      ordersList.addEventListener('click', async (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        const id = btn.getAttribute('data-order-id');
        if (!id) return;

        let order = findOrderInCaches(id);
        if (!order) {
          const arr = await fetchOrdersForCurrentUser(200);
          order = arr.find(o => String(o.id) === String(id));
        }

        if (action === 'reorder') reorderFromOrder(order);
        if (action === 'preset-from-order') presetFromOrder(order);
      });
    }

    if (ordersAllList) {
      ordersAllList.addEventListener('click', async (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        const id = btn.getAttribute('data-order-id');
        if (!id) return;

        let order = findOrderInCaches(id);
        if (!order) {
          const arr = await fetchOrdersForCurrentUser(200);
          order = arr.find(o => String(o.id) === String(id));
        }

        if (action === 'reorder') reorderFromOrder(order);
        if (action === 'preset-from-order') presetFromOrder(order);
      });
    }

    // Init badge + presets
    updateNotifBadge();
    refreshPresetSelect();

});

    // =============================
    // Admin Enhancements (Tabs + Charts + Customers + Export)
    // =============================

    let adminCharts = { topServices: null, ordersTrend: null, paymentStatus: null };
    let adminOrders30dCache = null;
    let adminCustomersCache = null;
    let adminActiveCustomer = null;

    function fmtBaht(n) {
      const num = Number(n || 0);
      return num.toLocaleString('th-TH', { maximumFractionDigits: 0 });
    }

    function dateKeyLocal(iso) {
      const d = iso ? new Date(iso) : new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${dd}`;
    }

function setAdminTab(tab) {
  const tabOverview = document.getElementById('adminTabOverview');
  const tabOrders = document.getElementById('adminTabOrders');
  const tabCustomers = document.getElementById('adminTabCustomers');
  const tabServices = document.getElementById('adminTabServices');

  const btnOverview = document.getElementById('adminTabBtnOverview');
  const btnOrders = document.getElementById('adminTabBtnOrders');
  const btnCustomers = document.getElementById('adminTabBtnCustomers');
  const btnServices = document.getElementById('adminTabBtnServices');

  if (!tabOverview || !tabOrders || !tabCustomers || !btnOverview || !btnOrders || !btnCustomers) return;

  tabOverview.classList.toggle('hidden', tab !== 'overview');
  tabOrders.classList.toggle('hidden', tab !== 'orders');
  tabCustomers.classList.toggle('hidden', tab !== 'customers');
  if (tabServices) tabServices.classList.toggle('hidden', tab !== 'services');

  const activeCls = 'bg-slate-900/70 text-slate-100';
  const inactiveCls = 'bg-slate-900/40 text-slate-200';

  const buttons = [btnOverview, btnOrders, btnCustomers];
  if (btnServices) buttons.push(btnServices);

  buttons.forEach(b => {
    b.classList.remove('bg-slate-900/70', 'text-slate-100', 'bg-slate-900/40', 'text-slate-200');
    b.classList.add('border', 'border-slate-600');
  });

  btnOverview.classList.add(tab === 'overview' ? activeCls : inactiveCls);
  btnOrders.classList.add(tab === 'orders' ? activeCls : inactiveCls);
  btnCustomers.classList.add(tab === 'customers' ? activeCls : inactiveCls);
  if (btnServices) btnServices.classList.add(tab === 'services' ? activeCls : inactiveCls);

  // Load content on demand
  if (tab === 'overview') renderAdminCharts().catch(() => {});
  if (tab === 'orders') renderAdminOrders().catch(() => {});
  if (tab === 'customers') renderAdminCustomers().catch(() => {});
  if (tab === 'services') { try { renderAdminServices(); } catch (_) {} }
}

async function fetchOrdersLastNDays(days = 30) {
      const now = new Date();
      const from = new Date(now.getTime() - (days - 1) * 24 * 60 * 60 * 1000);
      const { data, error } = await db
        .from('orders')
        .select('id, customer_username, service_type, price, payment_status, status, created_at')
        .gte('created_at', from.toISOString())
        .order('created_at', { ascending: true });

      if (error || !data) return [];
      return data;
    }

    function destroyChartSafe(ch) {
      try { if (ch && typeof ch.destroy === 'function') ch.destroy(); } catch (_) {}
    }

    async function renderAdminCharts(days = 30) {
      const updatedAtEl = document.getElementById('adminChartsUpdatedAt');
      const insightsEl = document.getElementById('adminInsightsList');

      // Chart.js not loaded
      if (typeof Chart === 'undefined') {
        if (updatedAtEl) updatedAtEl.textContent = 'Chart.js ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        return;
      }

      const orders = await fetchOrdersLastNDays(days);
      adminOrders30dCache = orders;

      // Aggregate
      const serviceCounts = new Map();
      const dailyCounts = new Map();
      const paymentCounts = new Map();

      let totalOrders = 0;
      let totalRevenueAll = 0;
      let totalRevenuePaid = 0;
      let paidCount = 0;

      for (const o of orders) {
        totalOrders += 1;

        const s = (o.service_type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏');
        serviceCounts.set(s, (serviceCounts.get(s) || 0) + 1);

        const dk = dateKeyLocal(o.created_at);
        dailyCounts.set(dk, (dailyCounts.get(dk) || 0) + 1);

        const ps = (o.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞');
        paymentCounts.set(ps, (paymentCounts.get(ps) || 0) + 1);

        const price = Number(o.price || 0);
        totalRevenueAll += price;

        if (ps === '‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß') {
          totalRevenuePaid += price;
          paidCount += 1;
        }
      }

      // Top services chart
      const topPairs = [...serviceCounts.entries()].sort((a, b) => b[1] - a[1]).slice(0, 8);
      const topLabels = topPairs.map(([k]) => k);
      const topValues = topPairs.map(([, v]) => v);

      // Orders trend chart (sorted by date)
      const dayPairs = [...dailyCounts.entries()].sort((a, b) => a[0].localeCompare(b[0]));
      const dayLabels = dayPairs.map(([k]) => k.slice(5)); // MM-DD
      const dayValues = dayPairs.map(([, v]) => v);

      // Payment status chart
      const payPairs = [...paymentCounts.entries()].sort((a, b) => b[1] - a[1]);
      const payLabels = payPairs.map(([k]) => k);
      const payValues = payPairs.map(([, v]) => v);

      const ctxTop = document.getElementById('chartTopServices');
      const ctxTrend = document.getElementById('chartOrdersTrend');
      const ctxPay = document.getElementById('chartPaymentStatus');

      if (ctxTop) {
        destroyChartSafe(adminCharts.topServices);
        adminCharts.topServices = new Chart(ctxTop, {
          type: 'bar',
          data: { labels: topLabels, datasets: [{ label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå', data: topValues }] },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
          }
        });
      }

      if (ctxTrend) {
        destroyChartSafe(adminCharts.ordersTrend);
        adminCharts.ordersTrend = new Chart(ctxTrend, {
          type: 'line',
          data: { labels: dayLabels, datasets: [{ label: '‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå/‡∏ß‡∏±‡∏ô', data: dayValues, tension: 0.25 }] },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
          }
        });
      }

      if (ctxPay) {
        destroyChartSafe(adminCharts.paymentStatus);
        adminCharts.paymentStatus = new Chart(ctxPay, {
          type: 'doughnut',
          data: { labels: payLabels, datasets: [{ label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', data: payValues }] },
          options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });
      }

      // Insights
      const topService = topPairs.length ? `${topPairs[0][0]} (${topPairs[0][1]} ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå)` : '‚Äî';
      const paidRatio = totalOrders ? Math.round((paidCount / totalOrders) * 100) : 0;
      const avgValue = totalOrders ? Math.round(totalRevenueAll / totalOrders) : 0;

      if (insightsEl) {
        insightsEl.innerHTML = `
          <li class="flex items-start justify-between gap-3"><span>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</span><span class="font-semibold text-amber-300">${topService}</span></li>
          <li class="flex items-start justify-between gap-3"><span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏ß‡∏° (30 ‡∏ß‡∏±‡∏ô)</span><span class="font-semibold text-slate-50">${fmtBaht(totalOrders)}</span></li>
          <li class="flex items-start justify-between gap-3"><span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</span><span class="font-semibold text-emerald-300">${paidRatio}%</span></li>
          <li class="flex items-start justify-between gap-3"><span>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏° (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</span><span class="font-semibold text-sky-200">‡∏ø${fmtBaht(totalRevenueAll)}</span></li>
          <li class="flex items-start justify-between gap-3"><span>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span><span class="font-semibold text-slate-50">‡∏ø${fmtBaht(avgValue)}</span></li>
        `;
      }

      if (updatedAtEl) {
        const t = new Date();
        updatedAtEl.textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü: ${t.toLocaleString('th-TH')}`;
      }
    }

    async function fetchAllCustomers(limit = 500) {
      const { data, error } = await db
        .from('customers')
        .select('id, full_name, username, phone, points, created_at')
        .order('created_at', { ascending: false })
        .limit(limit);

      if (error || !data) return [];
      return data;
    }

    async function buildSpendMapFromOrders(orders) {
      const spend = new Map();
      for (const o of (orders || [])) {
        const u = o.customer_username || '';
        const price = Number(o.price || 0);
        spend.set(u, (spend.get(u) || 0) + price);
      }
      return spend;
    }

    function openAdminCustomerModal(customer, spend30d = 0) {
      const modal = document.getElementById('adminCustomerModal');
      const subtitle = document.getElementById('adminCustomerModalSubtitle');
      const phone = document.getElementById('adminEditCustomerPhone');
      const points = document.getElementById('adminEditCustomerPoints');
      const note = document.getElementById('adminEditCustomerNote');
      const err = document.getElementById('adminCustomerModalError');

      if (!modal || !customer) return;

      adminActiveCustomer = customer;

      if (subtitle) subtitle.textContent = `${customer.full_name || '(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠)'} ‚Ä¢ @${customer.username} ‚Ä¢ ‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ 30 ‡∏ß‡∏±‡∏ô ‡∏ø${fmtBaht(spend30d)}`;
      if (phone) phone.value = customer.phone || '';
      if (points) points.value = Number(customer.points || 0);
      if (note) note.value = '';
      if (err) { err.classList.add('hidden'); err.textContent = ''; }

      modal.classList.remove('hidden');
    }

    function closeAdminCustomerModal() {
      const modal = document.getElementById('adminCustomerModal');
      const err = document.getElementById('adminCustomerModalError');
      if (err) { err.classList.add('hidden'); err.textContent = ''; }
      if (modal) modal.classList.add('hidden');
      adminActiveCustomer = null;
    }

    async function saveAdminCustomerEdits() {
      const err = document.getElementById('adminCustomerModalError');
      const phone = document.getElementById('adminEditCustomerPhone');
      const points = document.getElementById('adminEditCustomerPoints');
      const note = document.getElementById('adminEditCustomerNote');

      if (!adminActiveCustomer) return;

      try {
        const payload = {
          phone: phone ? phone.value.trim() : null,
          points: points ? Number(points.value || 0) : 0
        };

        // Attempt to save note if the column exists (ignore if not)
        if (note && note.value.trim()) payload.note = note.value.trim();

        let q = db.from('customers').update(payload).eq('id', adminActiveCustomer.id);

        const { error } = await q;
        if (error) {
          // Retry without note if column missing
          if (payload.note) {
            delete payload.note;
            const { error: e2 } = await db.from('customers').update(payload).eq('id', adminActiveCustomer.id);
            if (e2) throw e2;
          } else {
            throw error;
          }
        }

        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');

        // refresh list
        adminCustomersCache = null;
        await renderAdminCustomers();
        closeAdminCustomerModal();
      } catch (e) {
        if (err) {
          err.textContent = e?.message || '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
          err.classList.remove('hidden');
        }
      }
    }

    async function renderAdminCustomers() {
      const tbody = document.getElementById('adminCustomersTbody');
      const summary = document.getElementById('adminCustomersSummary');
      const searchEl = document.getElementById('adminCustomerSearch');
      const sortEl = document.getElementById('adminCustomerSort');

      if (!tbody) return;

      if (!adminCustomersCache) adminCustomersCache = await fetchAllCustomers(500);

      // Spend map uses cached 30d orders if available; otherwise fetch lightweight
      let orders30d = adminOrders30dCache;
      if (!orders30d) {
        orders30d = await fetchOrdersLastNDays(30);
        adminOrders30dCache = orders30d;
      }
      const spendMap = await buildSpendMapFromOrders(orders30d);

      let list = [...adminCustomersCache];

      const q = (searchEl?.value || '').trim().toLowerCase();
      if (q) {
        list = list.filter(c => {
          const name = (c.full_name || '').toLowerCase();
          const user = (c.username || '').toLowerCase();
          const phone = (c.phone || '').toLowerCase();
          return name.includes(q) || user.includes(q) || phone.includes(q);
        });
      }

      const sort = sortEl?.value || 'newest';
      if (sort === 'points') {
        list.sort((a, b) => Number(b.points || 0) - Number(a.points || 0));
      } else if (sort === 'spend') {
        list.sort((a, b) => Number(spendMap.get(b.username) || 0) - Number(spendMap.get(a.username) || 0));
      } // newest already

      tbody.innerHTML = '';
      for (const c of list) {
        const spend30d = Number(spendMap.get(c.username) || 0);

        const tr = document.createElement('tr');
        tr.className = 'hover:bg-slate-950/40';
        tr.innerHTML = `
          <td class="px-3 py-2">
            <div class="font-semibold text-slate-100">${c.full_name || '(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠)'}</div>
            <div class="text-[11px] text-slate-400">@${c.username}</div>
          </td>
          <td class="px-3 py-2 text-slate-200">${c.phone || '<span class="text-slate-500">‚Äî</span>'}</td>
          <td class="px-3 py-2 text-right font-semibold text-amber-300">${fmtBaht(c.points || 0)}</td>
          <td class="px-3 py-2 text-right text-slate-100">‡∏ø${fmtBaht(spend30d)}</td>
          <td class="px-3 py-2 text-right">
            <div class="flex items-center justify-end gap-2">
              <button class="adminEditCustomerBtn px-3 py-1.5 rounded-full bg-amber-500 text-white hover:bg-amber-600 text-[11px]">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="adminViewCustomerOrdersBtn px-3 py-1.5 rounded-full border border-slate-600 text-slate-200 hover:bg-slate-800 text-[11px]">‡∏î‡∏π‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</button>
            </div>
          </td>
        `;

        tr.querySelector('.adminEditCustomerBtn')?.addEventListener('click', () => openAdminCustomerModal(c, spend30d));
        tr.querySelector('.adminViewCustomerOrdersBtn')?.addEventListener('click', () => {
          const input = document.getElementById('adminSearchInput');
          if (input) input.value = c.username;
          setAdminTab('orders');
          renderAdminOrders().catch(() => {});
        });

        tbody.appendChild(tr);
      }

      if (summary) summary.textContent = `‡πÅ‡∏™‡∏î‡∏á ${list.length.toLocaleString('th-TH')} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${adminCustomersCache.length.toLocaleString('th-TH')})`;
    }

    function exportRowsToCsv(filename, rows) {
      const csv = rows.map(r =>
        r.map(v => {
          const s = (v ?? '').toString().replace(/"/g, '""');
          return `"${s}"`;
        }).join(',')
      ).join('\n');

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    async function exportAdminOrdersCsv() {
      const statusFilter = document.getElementById('adminStatusFilter')?.value || 'all';
      const payFilter = document.getElementById('adminPaymentFilter')?.value || 'all';
      const searchTerm = (document.getElementById('adminSearchInput')?.value || '').trim().toLowerCase();

      const orders = await fetchOrdersForAdmin(statusFilter);
      let filtered = orders;

      if (payFilter !== 'all') {
        filtered = filtered.filter(o => (o.payment_status || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞') === payFilter);
      }

      if (searchTerm) {
        filtered = filtered.filter(o => {
          const id = String(o.id || '');
          const u = (o.customer_username || '').toLowerCase();
          return id.includes(searchTerm) || u.includes(searchTerm);
        });
      }

      const rows = [
        ['id', 'customer_username', 'service_type', 'status', 'payment_status', 'price', 'created_at'],
        ...filtered.map(o => [
          o.id,
          o.customer_username,
          o.service_type,
          o.status,
          o.payment_status,
          o.price,
          o.created_at
        ])
      ];

      const stamp = new Date().toISOString().slice(0, 10);
      exportRowsToCsv(`orders_${statusFilter}_${stamp}.csv`, rows);
      showToast('Export CSV ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');
    }

// =============================
// Admin: Services & Pricing (localStorage)
// =============================
let adminServicesBound = false;
let adminEditingServiceId = null;

function slugifyServiceId(input) {
  return String(input || '')
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '_')
    .replace(/[^a-z0-9_]/g, '_')
    .replace(/_+/g, '_')
    .replace(/^_+|_+$/g, '');
}

function updateAdminServicesSummary() {
  const summary = document.getElementById('adminServicesSummary');
  if (!summary) return;
  const total = SERVICES.length;
  const active = SERVICES.filter(s => s && s.active !== false).length;
  summary.textContent = `‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ ${active} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
}

function renderAdminServices() {
  const tbody = document.getElementById('adminServicesTbody');
  if (!tbody) return;

  updateAdminServicesSummary();

  const rows = SERVICES.map(s => {
    const etaMin = (s.etaHours && s.etaHours.min) ? s.etaHours.min : 24;
    const etaMax = (s.etaHours && s.etaHours.max) ? s.etaHours.max : 36;

    return `
      <tr class="hover:bg-slate-900/40">
        <td class="px-3 py-2">
          <div class="flex items-start gap-3">
            <div class="w-9 h-9 rounded-xl bg-white/10 border border-white/10 flex items-center justify-center text-lg">
              ${s.icon || 'üß∫'}
            </div>
            <div>
              <div class="text-slate-50 font-semibold leading-tight">${escHtml(s.title || '')}</div>
              <div class="text-[11px] text-slate-400 font-mono">${escHtml(s.id || '')}</div>
              <div class="text-[11px] text-slate-500">${escHtml(s.shortDesc || '')}</div>
            </div>
          </div>
        </td>

        <td class="px-3 py-2 text-right">
          <input data-svc-id="${escAttr(s.id)}" data-field="basePrice" type="number" min="0" step="1"
                 class="w-[110px] text-right px-3 py-1.5 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400"
                 value="${Number(s.basePrice || 0)}" />
        </td>

        <td class="px-3 py-2">
          <input data-svc-id="${escAttr(s.id)}" data-field="unitLabel" type="text"
                 class="w-[110px] px-3 py-1.5 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400"
                 value="${escAttr(s.unitLabel || '')}" />
        </td>

        <td class="px-3 py-2">
          <div class="flex items-center gap-2">
            <input data-svc-id="${escAttr(s.id)}" data-field="etaMin" type="number" min="1" step="1"
                   class="w-[70px] text-center px-2 py-1.5 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400"
                   value="${Number(etaMin)}" />
            <span class="text-slate-500">‚Äì</span>
            <input data-svc-id="${escAttr(s.id)}" data-field="etaMax" type="number" min="1" step="1"
                   class="w-[70px] text-center px-2 py-1.5 rounded-xl border border-slate-600 bg-slate-950/40 text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400"
                   value="${Number(etaMax)}" />
          </div>
        </td>

        <td class="px-3 py-2 text-center">
          <input data-svc-id="${escAttr(s.id)}" data-field="active" type="checkbox"
                 class="w-4 h-4 accent-sky-500"
                 ${s.active === false ? '' : 'checked'} />
        </td>

        <td class="px-3 py-2 text-right whitespace-nowrap">
          <button type="button" data-action="edit" data-svc-id="${escAttr(s.id)}"
                  class="px-3 py-1.5 rounded-full bg-slate-800 text-slate-100 hover:bg-slate-700 text-[11px] border border-slate-600">
            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
          </button>
          <button type="button" data-action="delete" data-svc-id="${escAttr(s.id)}"
                  class="ml-1 px-3 py-1.5 rounded-full bg-rose-600/90 text-white hover:bg-rose-700 text-[11px]">
            üóëÔ∏è ‡∏•‡∏ö
          </button>
        </td>
      </tr>
    `;
  }).join('');

  tbody.innerHTML = rows || `
    <tr>
      <td colspan="6" class="px-3 py-6 text-center text-slate-400 text-sm">
        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ ‚Äî ‡∏Å‡∏î ‚Äú‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‚Äù
      </td>
    </tr>
  `;

  if (!adminServicesBound) {
    adminServicesBound = true;

    // Inline edits (event delegation)
    tbody.addEventListener('change', (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;

      const svcId = t.getAttribute('data-svc-id');
      const field = t.getAttribute('data-field');
      if (!svcId || !field) return;

      const idx = SERVICES.findIndex(s => s && s.id === svcId);
      if (idx < 0) return;

      if (field === 'active') {
        SERVICES[idx].active = (t instanceof HTMLInputElement) ? t.checked : true;
        saveServicesCatalog(SERVICES);
        rerenderServicesEverywhere();
        updateAdminServicesSummary();
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');
        return;
      }

      if (field === 'basePrice') {
        const v = Number((t instanceof HTMLInputElement) ? t.value : '0');
        SERVICES[idx].basePrice = Number.isFinite(v) ? Math.max(0, Math.round(v)) : 0;
      }

      if (field === 'unitLabel') {
        SERVICES[idx].unitLabel = String((t instanceof HTMLInputElement) ? t.value : '').trim();
      }

      if (field === 'etaMin' || field === 'etaMax') {
        const minEl = tbody.querySelector(`input[data-svc-id="${cssEscape(svcId)}"][data-field="etaMin"]`);
        const maxEl = tbody.querySelector(`input[data-svc-id="${cssEscape(svcId)}"][data-field="etaMax"]`);
        const etaMin = Number((minEl instanceof HTMLInputElement) ? minEl.value : '24');
        const etaMax = Number((maxEl instanceof HTMLInputElement) ? maxEl.value : '36');
        SERVICES[idx].etaHours = {
          min: Number.isFinite(etaMin) ? Math.max(1, Math.round(etaMin)) : 24,
          max: Number.isFinite(etaMax) ? Math.max(Math.round(etaMax), Math.round(etaMin) || 24) : 36
        };
      }

      saveServicesCatalog(SERVICES);
      rerenderServicesEverywhere();
      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');
    });

    // Edit/Delete buttons (event delegation)
    tbody.addEventListener('click', (e) => {
      const btn = e.target && (e.target.closest ? e.target.closest('button') : null);
      if (!btn) return;

      const action = btn.getAttribute('data-action');
      const svcId = btn.getAttribute('data-svc-id');
      if (!action || !svcId) return;

      if (action === 'edit') {
        openAdminServiceModal(svcId);
      } else if (action === 'delete') {
        deleteServiceById(svcId);
      }
    });
  }
}

function cssEscape(s) {
  try { return CSS.escape(String(s)); } catch (_) { return String(s).replace(/"/g, '\\"'); }
}

// basic escaping helpers for injected HTML
function escHtml(str) {
  return String(str || '')
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}
function escAttr(str) { return escHtml(str); }

function openAdminServiceModal(serviceId = null) {
  const modal = document.getElementById('adminServiceModal');
  if (!modal) return;

  const titleEl = document.getElementById('adminServiceModalTitle');
  const idEl = document.getElementById('adminServiceId');
  const nameEl = document.getElementById('adminServiceTitle');
  const iconEl = document.getElementById('adminServiceIcon');
  const priceEl = document.getElementById('adminServiceBasePrice');
  const unitEl = document.getElementById('adminServiceUnitLabel');
  const shortEl = document.getElementById('adminServiceShortDesc');
  const etaMinEl = document.getElementById('adminServiceEtaMin');
  const etaMaxEl = document.getElementById('adminServiceEtaMax');
  const activeEl = document.getElementById('adminServiceActive');
  const cardBgEl = document.getElementById('adminServiceCardBg');
  const qtyLabelEl = document.getElementById('adminServiceQtyLabel');
  const heroDescEl = document.getElementById('adminServiceHeroDesc');
  const primaryEl = document.getElementById('adminServicePrimaryAddons');
  const extraEl = document.getElementById('adminServiceExtraAddons');
  const errEl = document.getElementById('adminServiceModalError');
  const delBtn = document.getElementById('adminServiceDeleteBtn');

  const existing = serviceId ? (SERVICES.find(s => s && s.id === serviceId) || null) : null;
  adminEditingServiceId = existing ? existing.id : null;

  if (errEl) errEl.classList.add('hidden');

  if (existing) {
    if (titleEl) titleEl.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£';
    if (idEl) { idEl.value = existing.id; idEl.disabled = true; idEl.classList.add('opacity-60'); }
    if (nameEl) nameEl.value = existing.title || '';
    if (iconEl) iconEl.value = existing.icon || 'üß∫';
    if (priceEl) priceEl.value = String(existing.basePrice ?? 0);
    if (unitEl) unitEl.value = existing.unitLabel || '';
    if (shortEl) shortEl.value = existing.shortDesc || '';
    if (etaMinEl) etaMinEl.value = String(existing.etaHours?.min ?? 24);
    if (etaMaxEl) etaMaxEl.value = String(existing.etaHours?.max ?? 36);
    if (activeEl) activeEl.checked = existing.active !== false;

    if (cardBgEl) cardBgEl.value = existing.cardBg || '';
    if (qtyLabelEl) qtyLabelEl.value = existing.qtyLabel || '';
    if (heroDescEl) heroDescEl.value = existing.heroDesc || '';
    if (primaryEl) primaryEl.value = JSON.stringify(existing.primaryAddons || [], null, 2);
    if (extraEl) extraEl.value = JSON.stringify(existing.extraAddons || [], null, 2);

    if (delBtn) delBtn.classList.remove('hidden');
  } else {
    if (titleEl) titleEl.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
    if (idEl) { idEl.value = ''; idEl.disabled = false; idEl.classList.remove('opacity-60'); }
    if (nameEl) nameEl.value = '';
    if (iconEl) iconEl.value = 'üß∫';
    if (priceEl) priceEl.value = '0';
    if (unitEl) unitEl.value = '‡∏´‡∏ô‡πà‡∏ß‡∏¢';
    if (shortEl) shortEl.value = '';
    if (etaMinEl) etaMinEl.value = '24';
    if (etaMaxEl) etaMaxEl.value = '36';
    if (activeEl) activeEl.checked = true;

    if (cardBgEl) cardBgEl.value = 'bg-gradient-to-br from-sky-400 to-sky-600';
    if (qtyLabelEl) qtyLabelEl.value = '';
    if (heroDescEl) heroDescEl.value = '';
    if (primaryEl) primaryEl.value = '[]';
    if (extraEl) extraEl.value = '[]';

    if (delBtn) delBtn.classList.add('hidden');
  }

  modal.classList.remove('hidden');
}

function closeAdminServiceModal() {
  const modal = document.getElementById('adminServiceModal');
  if (modal) modal.classList.add('hidden');
  adminEditingServiceId = null;
}

function deleteServiceById(serviceId) {
  const existing = SERVICES.find(s => s && s.id === serviceId);
  if (!existing) return;

  const ok = confirm(`‡∏•‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ "${existing.title}" ?\n\n* ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ service_type = ${existing.id} ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£`);
  if (!ok) return;

  SERVICES = SERVICES.filter(s => s && s.id !== serviceId);
  saveServicesCatalog(SERVICES);
  rerenderServicesEverywhere();
  renderAdminServices();
  showToast('‡∏•‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');
}

function downloadJson(filename, obj) {
  try {
    const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 800);
  } catch (_) {}
}

function exportServicesJson() {
  const stamp = new Date().toISOString().slice(0, 10);
  downloadJson(`services_${stamp}.json`, SERVICES);
  showToast('Export JSON ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');
}

function importServicesJsonFromFile(file) {
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const parsed = JSON.parse(String(reader.result || '[]'));
      if (!Array.isArray(parsed)) throw new Error('‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON Array');
      const normalized = parsed.map(normalizeService).filter(Boolean);
      if (!normalized.length) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ');

      SERVICES = normalized;
      saveServicesCatalog(SERVICES);
      rerenderServicesEverywhere();
      renderAdminServices();
      showToast('Import ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ', 'success');
    } catch (err) {
      showToast('Import ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (err && err.message ? err.message : '‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'), 'error');
    }
  };
  reader.onerror = () => showToast('‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
  reader.readAsText(file);
}

function saveAdminServiceFromModal() {
  const idEl = document.getElementById('adminServiceId');
  const nameEl = document.getElementById('adminServiceTitle');
  const iconEl = document.getElementById('adminServiceIcon');
  const priceEl = document.getElementById('adminServiceBasePrice');
  const unitEl = document.getElementById('adminServiceUnitLabel');
  const shortEl = document.getElementById('adminServiceShortDesc');
  const etaMinEl = document.getElementById('adminServiceEtaMin');
  const etaMaxEl = document.getElementById('adminServiceEtaMax');
  const activeEl = document.getElementById('adminServiceActive');

  const cardBgEl = document.getElementById('adminServiceCardBg');
  const qtyLabelEl = document.getElementById('adminServiceQtyLabel');
  const heroDescEl = document.getElementById('adminServiceHeroDesc');
  const primaryEl = document.getElementById('adminServicePrimaryAddons');
  const extraEl = document.getElementById('adminServiceExtraAddons');

  const errEl = document.getElementById('adminServiceModalError');
  const showErr = (msg) => {
    if (!errEl) return;
    errEl.textContent = msg;
    errEl.classList.remove('hidden');
  };

  const title = String(nameEl?.value || '').trim();
  if (!title) return showErr('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');

  let id = String(idEl?.value || '').trim();
  if (!adminEditingServiceId) {
    id = slugifyServiceId(id || title);
  }
  if (!id) return showErr('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà/‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (id)');

  const basePrice = Number(priceEl?.value || 0);
  const unitLabel = String(unitEl?.value || '').trim() || '‡∏´‡∏ô‡πà‡∏ß‡∏¢';
  const shortDesc = String(shortEl?.value || '').trim();
  const etaMin = Number(etaMinEl?.value || 24);
  const etaMax = Number(etaMaxEl?.value || 36);
  const active = !!(activeEl && activeEl.checked);

  let primaryAddons = [];
  let extraAddons = [];
  try { primaryAddons = JSON.parse(String(primaryEl?.value || '[]')); if (!Array.isArray(primaryAddons)) primaryAddons = []; } catch (_) { primaryAddons = []; }
  try { extraAddons = JSON.parse(String(extraEl?.value || '[]')); if (!Array.isArray(extraAddons)) extraAddons = []; } catch (_) { extraAddons = []; }

  // prevent duplicates on create
  if (!adminEditingServiceId && SERVICES.some(s => s && s.id === id)) {
    return showErr('‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (id) ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô');
  }

  const obj = normalizeService({
    id,
    title,
    icon: String(iconEl?.value || 'üß∫'),
    basePrice,
    unitLabel,
    shortDesc,
    etaHours: { min: etaMin, max: etaMax },
    active,
    cardBg: String(cardBgEl?.value || ''),
    qtyLabel: String(qtyLabelEl?.value || ''),
    heroDesc: String(heroDescEl?.value || ''),
    primaryAddons,
    extraAddons
  });

  if (!obj) return showErr('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');

  if (adminEditingServiceId) {
    const idx = SERVICES.findIndex(s => s && s.id === adminEditingServiceId);
    if (idx >= 0) {
      // keep id same if editing (id input disabled)
      obj.id = adminEditingServiceId;
      SERVICES[idx] = obj;
    }
  } else {
    SERVICES.unshift(obj);
  }

  saveServicesCatalog(SERVICES);
  rerenderServicesEverywhere();
  renderAdminServices();
  closeAdminServiceModal();
  showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'success');
}



    function bindAdminEnhancementsOnce() {
      const btnOverview = document.getElementById('adminTabBtnOverview');
      const btnOrders = document.getElementById('adminTabBtnOrders');
      const btnCustomers = document.getElementById('adminTabBtnCustomers');
      const btnServices = document.getElementById('adminTabBtnServices');
      const btnRefreshCharts = document.getElementById('adminRefreshChartsBtn');

      const btnCustomersReload = document.getElementById('adminCustomersReloadBtn');
      const searchCustomers = document.getElementById('adminCustomerSearch');
      const sortCustomers = document.getElementById('adminCustomerSort');

      const modalClose = document.getElementById('adminCustomerCloseBtn');
      const modalSave = document.getElementById('adminCustomerSaveBtn');

      const exportBtn = document.getElementById('adminExportCsvBtn');
      const adminSearchInputEl = document.getElementById('adminSearchInput');

// Services & Pricing controls
const btnAddService = document.getElementById('adminAddServiceBtn');
const btnResetServices = document.getElementById('adminResetServicesBtn');
const btnExportServices = document.getElementById('adminExportServicesBtn');
const btnImportServices = document.getElementById('adminImportServicesBtn');
const importFile = document.getElementById('adminServicesImportFile');

const serviceModal = document.getElementById('adminServiceModal');
const btnServiceClose = document.getElementById('adminServiceCloseBtn');
const btnServiceCancel = document.getElementById('adminServiceCancelBtn');
const btnServiceSave = document.getElementById('adminServiceSaveBtn');
const btnServiceDelete = document.getElementById('adminServiceDeleteBtn');


      btnOverview?.addEventListener('click', () => setAdminTab('overview'));
      btnOrders?.addEventListener('click', () => setAdminTab('orders'));
      btnCustomers?.addEventListener('click', () => setAdminTab('customers'));
      btnServices?.addEventListener('click', () => setAdminTab('services'));

      btnRefreshCharts?.addEventListener('click', () => renderAdminCharts().catch(() => {}));

      btnCustomersReload?.addEventListener('click', async () => {
        adminCustomersCache = null;
        await renderAdminCustomers();
      });

      searchCustomers?.addEventListener('input', () => renderAdminCustomers().catch(() => {}));
      sortCustomers?.addEventListener('change', () => renderAdminCustomers().catch(() => {}));

      modalClose?.addEventListener('click', closeAdminCustomerModal);
      document.getElementById('adminCustomerModal')?.addEventListener('click', (e) => {
        if (e.target && e.target.id === 'adminCustomerModal') closeAdminCustomerModal();
      });
      modalSave?.addEventListener('click', () => saveAdminCustomerEdits().catch(() => {}));

      exportBtn?.addEventListener('click', () => exportAdminOrdersCsv().catch(() => {}));

// Services tab actions
btnAddService?.addEventListener('click', () => openAdminServiceModal(null));
btnResetServices?.addEventListener('click', () => {
  const ok = confirm('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ‚Äú‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£/‡∏£‡∏≤‡∏Ñ‡∏≤‚Äù ‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô?\n\n* ‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ');
  if (ok) resetServicesCatalog();
});
btnExportServices?.addEventListener('click', () => exportServicesJson());
btnImportServices?.addEventListener('click', () => importFile && importFile.click());

importFile?.addEventListener('change', () => {
  const f = importFile.files && importFile.files[0];
  if (f) importServicesJsonFromFile(f);
  try { importFile.value = ''; } catch (_) {}
});

btnServiceClose?.addEventListener('click', closeAdminServiceModal);
btnServiceCancel?.addEventListener('click', closeAdminServiceModal);
btnServiceSave?.addEventListener('click', saveAdminServiceFromModal);

btnServiceDelete?.addEventListener('click', () => {
  if (!adminEditingServiceId) return;
  const id = adminEditingServiceId;
  closeAdminServiceModal();
  deleteServiceById(id);
});

serviceModal?.addEventListener('click', (e) => {
  if (e.target && e.target.id === 'adminServiceModal') closeAdminServiceModal();
});


      adminSearchInputEl?.addEventListener('input', () => renderAdminOrders().catch(() => {}));
    }

    // Bind once after DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      bindAdminEnhancementsOnce();

      // Default tab for admin dashboard (if already in admin view)
      // ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
    });

</script>


<script>
  // ===========================
  // Login Promo Slider (Vanilla)
  // ===========================
  (function () {
    const slider = document.getElementById('loginPromoSlider');
    if (!slider) return;

    const track = slider.querySelector('.lg-track');
    const slides = Array.from(slider.querySelectorAll('.lg-slide'));
    const dots = Array.from(slider.querySelectorAll('.lg-dot'));
    const btnPrev = slider.querySelector('.lg-arrow.prev');
    const btnNext = slider.querySelector('.lg-arrow.next');

    // Apply background images if provided via data-bg
    let hasImage = false;
    slides.forEach((s) => {
      const bg = s.getAttribute('data-bg');
      if (bg && bg.trim()) {
        s.querySelector('.lg-bg').style.backgroundImage = `url("${bg.trim()}")`;
        hasImage = true;
      }
    });
    slider.setAttribute('data-has-image', hasImage ? '1' : '0');

    let index = 0;
    let timer = null;

    function clamp(i) {
      const n = slides.length;
      return (i % n + n) % n;
    }

    function goTo(i, opts = { focus: false }) {
      index = clamp(i);
      const pct = index * 100;
      track.style.transform = `translateX(-${pct}%)`;

      dots.forEach((d, di) => d.setAttribute('aria-current', di === index ? 'true' : 'false'));

      if (opts.focus) dots[index]?.focus?.();
    }

    function next() { goTo(index + 1); }
    function prev() { goTo(index - 1); }

    function start() {
      stop();
      timer = window.setInterval(next, 6500);
    }
    function stop() {
      if (timer) window.clearInterval(timer);
      timer = null;
    }

    btnNext?.addEventListener('click', () => { next(); start(); });
    btnPrev?.addEventListener('click', () => { prev(); start(); });

    dots.forEach((d, di) => {
      d.addEventListener('click', () => { goTo(di); start(); });
    });

    // Pause on hover / focus (better UX)
    slider.addEventListener('mouseenter', stop);
    slider.addEventListener('mouseleave', start);
    slider.addEventListener('focusin', stop);
    slider.addEventListener('focusout', start);

    // Keyboard arrows when focused in slider
    slider.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') { e.preventDefault(); next(); start(); }
      if (e.key === 'ArrowLeft')  { e.preventDefault(); prev(); start(); }
    });

    // Touch swipe (mobile)
    let x0 = null;
    slider.addEventListener('touchstart', (e) => { x0 = e.touches?.[0]?.clientX ?? null; }, { passive: true });
    slider.addEventListener('touchmove',  (e) => {
      if (x0 == null) return;
      const x1 = e.touches?.[0]?.clientX ?? null;
      if (x1 == null) return;
      const dx = x1 - x0;
      if (Math.abs(dx) > 48) {
        dx < 0 ? next() : prev();
        start();
        x0 = null;
      }
    }, { passive: true });

    // Respect reduced motion
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      stop();
    } else {
      start();
    }

    // Initialize
    goTo(0);
  })();
</script>


  <!-- Google Maps JS -->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCl5dIHMKGalvv7IVvbMd7y-EMyQEDKFwk&callback=initLaundryMap">
</script>

</body>
</html>
